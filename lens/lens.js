!function t(e,n,r){function o(s,a){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return o(n?n:t)},l,l.exports,t,e,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e){window.Lens=e("./src/app")},{"./src/app":178}],2:[function(e,t){!function(e,n){"object"==typeof t&&"object"==typeof t.exports?t.exports=e.document?n(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return n(e)}:n(e)}("undefined"!=typeof window?window:this,function(e,t){function n(e){var t=e.length,n=K.type(e);return"function"===n||K.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e}function r(e,t,n){if(K.isFunction(t))return K.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return K.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(at.test(t))return K.filter(t,e,n);t=K.filter(t,e)}return K.grep(e,function(e){return z.call(t,e)>=0!==n})}function o(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function i(e){var t=ft[e]={};return K.each(e.match(dt)||[],function(e,n){t[n]=!0}),t}function s(){Z.removeEventListener("DOMContentLoaded",s,!1),e.removeEventListener("load",s,!1),K.ready()}function a(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=K.expando+a.uid++}function c(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(wt,"-$1").toLowerCase(),n=e.getAttribute(r),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:bt.test(n)?K.parseJSON(n):n}catch(o){}vt.set(e,t,n)}else n=void 0;return n}function u(){return!0}function l(){return!1}function p(){try{return Z.activeElement}catch(e){}}function h(e,t){return K.nodeName(e,"table")&&K.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function d(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function f(e){var t=Lt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function g(e,t){for(var n=0,r=e.length;r>n;n++)mt.set(e[n],"globalEval",!t||mt.get(t[n],"globalEval"))}function y(e,t){var n,r,o,i,s,a,c,u;if(1===t.nodeType){if(mt.hasData(e)&&(i=mt.access(e),s=mt.set(t,i),u=i.events)){delete s.handle,s.events={};for(o in u)for(n=0,r=u[o].length;r>n;n++)K.event.add(t,o,u[o][n])}vt.hasData(e)&&(a=vt.access(e),c=K.extend({},a),vt.set(t,c))}}function m(e,t){var n=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&K.nodeName(e,t)?K.merge([e],n):n}function v(e,t){var n=t.nodeName.toLowerCase();"input"===n&&Pt.test(e.type)?t.checked=e.checked:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}function b(t,n){var r,o=K(n.createElement(t)).appendTo(n.body),i=e.getDefaultComputedStyle&&(r=e.getDefaultComputedStyle(o[0]))?r.display:K.css(o[0],"display");return o.detach(),i}function w(e){var t=Z,n=Mt[e];return n||(n=b(e,t),"none"!==n&&n||(Rt=(Rt||K("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=Rt[0].contentDocument,t.write(),t.close(),n=b(e,t),Rt.detach()),Mt[e]=n),n}function x(e,t,n){var r,o,i,s,a=e.style;return n=n||Bt(e),n&&(s=n.getPropertyValue(t)||n[t]),n&&(""!==s||K.contains(e.ownerDocument,e)||(s=K.style(e,t)),Ht.test(s)&&Ft.test(t)&&(r=a.width,o=a.minWidth,i=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=n.width,a.width=r,a.minWidth=o,a.maxWidth=i)),void 0!==s?s+"":s}function _(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function C(e,t){if(t in e)return t;for(var n=t[0].toUpperCase()+t.slice(1),r=t,o=Jt.length;o--;)if(t=Jt[o]+n,t in e)return t;return r}function P(e,t,n){var r=Wt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function T(e,t,n,r,o){for(var i=n===(r?"border":"content")?4:"width"===t?1:0,s=0;4>i;i+=2)"margin"===n&&(s+=K.css(e,n+_t[i],!0,o)),r?("content"===n&&(s-=K.css(e,"padding"+_t[i],!0,o)),"margin"!==n&&(s-=K.css(e,"border"+_t[i]+"Width",!0,o))):(s+=K.css(e,"padding"+_t[i],!0,o),"padding"!==n&&(s+=K.css(e,"border"+_t[i]+"Width",!0,o)));return s}function k(e,t,n){var r=!0,o="width"===t?e.offsetWidth:e.offsetHeight,i=Bt(e),s="border-box"===K.css(e,"boxSizing",!1,i);if(0>=o||null==o){if(o=x(e,t,i),(0>o||null==o)&&(o=e.style[t]),Ht.test(o))return o;r=s&&(Y.boxSizingReliable()||o===e.style[t]),o=parseFloat(o)||0}return o+T(e,t,n||(s?"border":"content"),r,i)+"px"}function N(e,t){for(var n,r,o,i=[],s=0,a=e.length;a>s;s++)r=e[s],r.style&&(i[s]=mt.get(r,"olddisplay"),n=r.style.display,t?(i[s]||"none"!==n||(r.style.display=""),""===r.style.display&&Ct(r)&&(i[s]=mt.access(r,"olddisplay",w(r.nodeName)))):(o=Ct(r),"none"===n&&o||mt.set(r,"olddisplay",o?n:K.css(r,"display"))));for(s=0;a>s;s++)r=e[s],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?i[s]||"":"none"));return e}function S(e,t,n,r,o){return new S.prototype.init(e,t,n,r,o)}function A(){return setTimeout(function(){Yt=void 0}),Yt=K.now()}function E(e,t){var n,r=0,o={height:e};for(t=t?1:0;4>r;r+=2-t)n=_t[r],o["margin"+n]=o["padding"+n]=e;return t&&(o.opacity=o.width=e),o}function j(e,t,n){for(var r,o=(nn[t]||[]).concat(nn["*"]),i=0,s=o.length;s>i;i++)if(r=o[i].call(n,t,e))return r}function D(e,t,n){var r,o,i,s,a,c,u,l,p=this,h={},d=e.style,f=e.nodeType&&Ct(e),g=mt.get(e,"fxshow");n.queue||(a=K._queueHooks(e,"fx"),null==a.unqueued&&(a.unqueued=0,c=a.empty.fire,a.empty.fire=function(){a.unqueued||c()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,K.queue(e,"fx").length||a.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[d.overflow,d.overflowX,d.overflowY],u=K.css(e,"display"),l="none"===u?mt.get(e,"olddisplay")||w(e.nodeName):u,"inline"===l&&"none"===K.css(e,"float")&&(d.display="inline-block")),n.overflow&&(d.overflow="hidden",p.always(function(){d.overflow=n.overflow[0],d.overflowX=n.overflow[1],d.overflowY=n.overflow[2]}));for(r in t)if(o=t[r],Qt.exec(o)){if(delete t[r],i=i||"toggle"===o,o===(f?"hide":"show")){if("show"!==o||!g||void 0===g[r])continue;f=!0}h[r]=g&&g[r]||K.style(e,r)}else u=void 0;if(K.isEmptyObject(h))"inline"===("none"===u?w(e.nodeName):u)&&(d.display=u);else{g?"hidden"in g&&(f=g.hidden):g=mt.access(e,"fxshow",{}),i&&(g.hidden=!f),f?K(e).show():p.done(function(){K(e).hide()}),p.done(function(){var t;mt.remove(e,"fxshow");for(t in h)K.style(e,t,h[t])});for(r in h)s=j(f?g[r]:0,r,p),r in g||(g[r]=s.start,f&&(s.end=s.start,s.start="width"===r||"height"===r?1:0))}}function V(e,t){var n,r,o,i,s;for(n in e)if(r=K.camelCase(n),o=t[r],i=e[n],K.isArray(i)&&(o=i[1],i=e[n]=i[0]),n!==r&&(e[r]=i,delete e[n]),s=K.cssHooks[r],s&&"expand"in s){i=s.expand(i),delete e[r];for(n in i)n in e||(e[n]=i[n],t[n]=o)}else t[r]=o}function $(e,t,n){var r,o,i=0,s=tn.length,a=K.Deferred().always(function(){delete c.elem}),c=function(){if(o)return!1;for(var t=Yt||A(),n=Math.max(0,u.startTime+u.duration-t),r=n/u.duration||0,i=1-r,s=0,c=u.tweens.length;c>s;s++)u.tweens[s].run(i);return a.notifyWith(e,[u,i,n]),1>i&&c?n:(a.resolveWith(e,[u]),!1)},u=a.promise({elem:e,props:K.extend({},t),opts:K.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Yt||A(),duration:n.duration,tweens:[],createTween:function(t,n){var r=K.Tween(e,u.opts,t,n,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(r),r},stop:function(t){var n=0,r=t?u.tweens.length:0;if(o)return this;for(o=!0;r>n;n++)u.tweens[n].run(1);return t?a.resolveWith(e,[u,t]):a.rejectWith(e,[u,t]),this}}),l=u.props;for(V(l,u.opts.specialEasing);s>i;i++)if(r=tn[i].call(u,e,l,u.opts))return r;return K.map(l,j,u),K.isFunction(u.opts.start)&&u.opts.start.call(e,u),K.fx.timer(K.extend(c,{elem:e,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}function q(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,o=0,i=t.toLowerCase().match(dt)||[];if(K.isFunction(n))for(;r=i[o++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function L(e,t,n,r){function o(a){var c;return i[a]=!0,K.each(e[a]||[],function(e,a){var u=a(t,n,r);return"string"!=typeof u||s||i[u]?s?!(c=u):void 0:(t.dataTypes.unshift(u),o(u),!1)}),c}var i={},s=e===wn;return o(t.dataTypes[0])||!i["*"]&&o("*")}function I(e,t){var n,r,o=K.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((o[n]?e:r||(r={}))[n]=t[n]);return r&&K.extend(!0,e,r),e}function O(e,t,n){for(var r,o,i,s,a=e.contents,c=e.dataTypes;"*"===c[0];)c.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(o in a)if(a[o]&&a[o].test(r)){c.unshift(o);break}if(c[0]in n)i=c[0];else{for(o in n){if(!c[0]||e.converters[o+" "+c[0]]){i=o;break}s||(s=o)}i=i||s}return i?(i!==c[0]&&c.unshift(i),n[i]):void 0}function R(e,t,n,r){var o,i,s,a,c,u={},l=e.dataTypes.slice();if(l[1])for(s in e.converters)u[s.toLowerCase()]=e.converters[s];for(i=l.shift();i;)if(e.responseFields[i]&&(n[e.responseFields[i]]=t),!c&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),c=i,i=l.shift())if("*"===i)i=c;else if("*"!==c&&c!==i){if(s=u[c+" "+i]||u["* "+i],!s)for(o in u)if(a=o.split(" "),a[1]===i&&(s=u[c+" "+a[0]]||u["* "+a[0]])){s===!0?s=u[o]:u[o]!==!0&&(i=a[0],l.unshift(a[1]));break}if(s!==!0)if(s&&e["throws"])t=s(t);else try{t=s(t)}catch(p){return{state:"parsererror",error:s?p:"No conversion from "+c+" to "+i}}}return{state:"success",data:t}}function M(e,t,n,r){var o;if(K.isArray(t))K.each(t,function(t,o){n||Tn.test(e)?r(e,o):M(e+"["+("object"==typeof o?t:"")+"]",o,n,r)});else if(n||"object"!==K.type(t))r(e,t);else for(o in t)M(e+"["+o+"]",t[o],n,r)}function F(e){return K.isWindow(e)?e:9===e.nodeType&&e.defaultView}var H=[],B=H.slice,U=H.concat,W=H.push,z=H.indexOf,G={},X=G.toString,J=G.hasOwnProperty,Y={},Z=e.document,Q="2.1.3",K=function(e,t){return new K.fn.init(e,t)},et=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,tt=/^-ms-/,nt=/-([\da-z])/gi,rt=function(e,t){return t.toUpperCase()};K.fn=K.prototype={jquery:Q,constructor:K,selector:"",length:0,toArray:function(){return B.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:B.call(this)},pushStack:function(e){var t=K.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return K.each(this,e,t)},map:function(e){return this.pushStack(K.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(B.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:W,sort:H.sort,splice:H.splice},K.extend=K.fn.extend=function(){var e,t,n,r,o,i,s=arguments[0]||{},a=1,c=arguments.length,u=!1;for("boolean"==typeof s&&(u=s,s=arguments[a]||{},a++),"object"==typeof s||K.isFunction(s)||(s={}),a===c&&(s=this,a--);c>a;a++)if(null!=(e=arguments[a]))for(t in e)n=s[t],r=e[t],s!==r&&(u&&r&&(K.isPlainObject(r)||(o=K.isArray(r)))?(o?(o=!1,i=n&&K.isArray(n)?n:[]):i=n&&K.isPlainObject(n)?n:{},s[t]=K.extend(u,i,r)):void 0!==r&&(s[t]=r));return s},K.extend({expando:"jQuery"+(Q+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===K.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!K.isArray(e)&&e-parseFloat(e)+1>=0},isPlainObject:function(e){return"object"!==K.type(e)||e.nodeType||K.isWindow(e)?!1:e.constructor&&!J.call(e.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?G[X.call(e)]||"object":typeof e},globalEval:function(e){var t,n=eval;e=K.trim(e),e&&(1===e.indexOf("use strict")?(t=Z.createElement("script"),t.text=e,Z.head.appendChild(t).parentNode.removeChild(t)):n(e))},camelCase:function(e){return e.replace(tt,"ms-").replace(nt,rt)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,r){var o,i=0,s=e.length,a=n(e);if(r){if(a)for(;s>i&&(o=t.apply(e[i],r),o!==!1);i++);else for(i in e)if(o=t.apply(e[i],r),o===!1)break}else if(a)for(;s>i&&(o=t.call(e[i],i,e[i]),o!==!1);i++);else for(i in e)if(o=t.call(e[i],i,e[i]),o===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(et,"")},makeArray:function(e,t){var r=t||[];return null!=e&&(n(Object(e))?K.merge(r,"string"==typeof e?[e]:e):W.call(r,e)),r},inArray:function(e,t,n){return null==t?-1:z.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,o=e.length;n>r;r++)e[o++]=t[r];return e.length=o,e},grep:function(e,t,n){for(var r,o=[],i=0,s=e.length,a=!n;s>i;i++)r=!t(e[i],i),r!==a&&o.push(e[i]);return o},map:function(e,t,r){var o,i=0,s=e.length,a=n(e),c=[];if(a)for(;s>i;i++)o=t(e[i],i,r),null!=o&&c.push(o);else for(i in e)o=t(e[i],i,r),null!=o&&c.push(o);return U.apply([],c)},guid:1,proxy:function(e,t){var n,r,o;return"string"==typeof t&&(n=e[t],t=e,e=n),K.isFunction(e)?(r=B.call(arguments,2),o=function(){return e.apply(t||this,r.concat(B.call(arguments)))},o.guid=e.guid=e.guid||K.guid++,o):void 0},now:Date.now,support:Y}),K.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){G["[object "+t+"]"]=t.toLowerCase()});var ot=function(e){function t(e,t,n,r){var o,i,s,a,c,u,p,d,f,g;if((t?t.ownerDocument||t:M)!==D&&j(t),t=t||D,n=n||[],a=t.nodeType,"string"!=typeof e||!e||1!==a&&9!==a&&11!==a)return n;if(!r&&$){if(11!==a&&(o=vt.exec(e)))if(s=o[1]){if(9===a){if(i=t.getElementById(s),!i||!i.parentNode)return n;if(i.id===s)return n.push(i),n}else if(t.ownerDocument&&(i=t.ownerDocument.getElementById(s))&&O(t,i)&&i.id===s)return n.push(i),n}else{if(o[2])return Q.apply(n,t.getElementsByTagName(e)),n;if((s=o[3])&&x.getElementsByClassName)return Q.apply(n,t.getElementsByClassName(s)),n}if(x.qsa&&(!q||!q.test(e))){if(d=p=R,f=t,g=1!==a&&e,1===a&&"object"!==t.nodeName.toLowerCase()){for(u=T(e),(p=t.getAttribute("id"))?d=p.replace(wt,"\\$&"):t.setAttribute("id",d),d="[id='"+d+"'] ",c=u.length;c--;)u[c]=d+h(u[c]);f=bt.test(e)&&l(t.parentNode)||t,g=u.join(",")}if(g)try{return Q.apply(n,f.querySelectorAll(g)),n}catch(y){}finally{p||t.removeAttribute("id")}}}return N(e.replace(ct,"$1"),t,n,r)}function n(){function e(n,r){return t.push(n+" ")>_.cacheLength&&delete e[t.shift()],e[n+" "]=r}var t=[];return e}function r(e){return e[R]=!0,e}function o(e){var t=D.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function i(e,t){for(var n=e.split("|"),r=e.length;r--;)_.attrHandle[n[r]]=t}function s(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||G)-(~e.sourceIndex||G);if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function a(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function c(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function u(e){return r(function(t){return t=+t,r(function(n,r){for(var o,i=e([],n.length,t),s=i.length;s--;)n[o=i[s]]&&(n[o]=!(r[o]=n[o]))})})}function l(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function p(){}function h(e){for(var t=0,n=e.length,r="";n>t;t++)r+=e[t].value;return r}function d(e,t,n){var r=t.dir,o=n&&"parentNode"===r,i=H++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||o)return e(t,n,i)}:function(t,n,s){var a,c,u=[F,i];if(s){for(;t=t[r];)if((1===t.nodeType||o)&&e(t,n,s))return!0}else for(;t=t[r];)if(1===t.nodeType||o){if(c=t[R]||(t[R]={}),(a=c[r])&&a[0]===F&&a[1]===i)return u[2]=a[2];if(c[r]=u,u[2]=e(t,n,s))return!0}}}function f(e){return e.length>1?function(t,n,r){for(var o=e.length;o--;)if(!e[o](t,n,r))return!1;return!0}:e[0]}function g(e,n,r){for(var o=0,i=n.length;i>o;o++)t(e,n[o],r);return r}function y(e,t,n,r,o){for(var i,s=[],a=0,c=e.length,u=null!=t;c>a;a++)(i=e[a])&&(!n||n(i,r,o))&&(s.push(i),u&&t.push(a));return s}function m(e,t,n,o,i,s){return o&&!o[R]&&(o=m(o)),i&&!i[R]&&(i=m(i,s)),r(function(r,s,a,c){var u,l,p,h=[],d=[],f=s.length,m=r||g(t||"*",a.nodeType?[a]:a,[]),v=!e||!r&&t?m:y(m,h,e,a,c),b=n?i||(r?e:f||o)?[]:s:v;if(n&&n(v,b,a,c),o)for(u=y(b,d),o(u,[],a,c),l=u.length;l--;)(p=u[l])&&(b[d[l]]=!(v[d[l]]=p));if(r){if(i||e){if(i){for(u=[],l=b.length;l--;)(p=b[l])&&u.push(v[l]=p);i(null,b=[],u,c)}for(l=b.length;l--;)(p=b[l])&&(u=i?et(r,p):h[l])>-1&&(r[u]=!(s[u]=p))}}else b=y(b===s?b.splice(f,b.length):b),i?i(null,s,b,c):Q.apply(s,b)})}function v(e){for(var t,n,r,o=e.length,i=_.relative[e[0].type],s=i||_.relative[" "],a=i?1:0,c=d(function(e){return e===t},s,!0),u=d(function(e){return et(t,e)>-1},s,!0),l=[function(e,n,r){var o=!i&&(r||n!==S)||((t=n).nodeType?c(e,n,r):u(e,n,r));return t=null,o}];o>a;a++)if(n=_.relative[e[a].type])l=[d(f(l),n)];else{if(n=_.filter[e[a].type].apply(null,e[a].matches),n[R]){for(r=++a;o>r&&!_.relative[e[r].type];r++);return m(a>1&&f(l),a>1&&h(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(ct,"$1"),n,r>a&&v(e.slice(a,r)),o>r&&v(e=e.slice(r)),o>r&&h(e))}l.push(n)}return f(l)}function b(e,n){var o=n.length>0,i=e.length>0,s=function(r,s,a,c,u){var l,p,h,d=0,f="0",g=r&&[],m=[],v=S,b=r||i&&_.find.TAG("*",u),w=F+=null==v?1:Math.random()||.1,x=b.length;for(u&&(S=s!==D&&s);f!==x&&null!=(l=b[f]);f++){if(i&&l){for(p=0;h=e[p++];)if(h(l,s,a)){c.push(l);break}u&&(F=w)}o&&((l=!h&&l)&&d--,r&&g.push(l))}if(d+=f,o&&f!==d){for(p=0;h=n[p++];)h(g,m,s,a);if(r){if(d>0)for(;f--;)g[f]||m[f]||(m[f]=Y.call(c));m=y(m)}Q.apply(c,m),u&&!r&&m.length>0&&d+n.length>1&&t.uniqueSort(c)}return u&&(F=w,S=v),g};return o?r(s):s}var w,x,_,C,P,T,k,N,S,A,E,j,D,V,$,q,L,I,O,R="sizzle"+1*new Date,M=e.document,F=0,H=0,B=n(),U=n(),W=n(),z=function(e,t){return e===t&&(E=!0),0},G=1<<31,X={}.hasOwnProperty,J=[],Y=J.pop,Z=J.push,Q=J.push,K=J.slice,et=function(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1},tt="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",nt="[\\x20\\t\\r\\n\\f]",rt="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ot=rt.replace("w","w#"),it="\\["+nt+"*("+rt+")(?:"+nt+"*([*^$|!~]?=)"+nt+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+ot+"))|)"+nt+"*\\]",st=":("+rt+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+it+")*)|.*)\\)|)",at=new RegExp(nt+"+","g"),ct=new RegExp("^"+nt+"+|((?:^|[^\\\\])(?:\\\\.)*)"+nt+"+$","g"),ut=new RegExp("^"+nt+"*,"+nt+"*"),lt=new RegExp("^"+nt+"*([>+~]|"+nt+")"+nt+"*"),pt=new RegExp("="+nt+"*([^\\]'\"]*?)"+nt+"*\\]","g"),ht=new RegExp(st),dt=new RegExp("^"+ot+"$"),ft={ID:new RegExp("^#("+rt+")"),CLASS:new RegExp("^\\.("+rt+")"),TAG:new RegExp("^("+rt.replace("w","w*")+")"),ATTR:new RegExp("^"+it),PSEUDO:new RegExp("^"+st),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+nt+"*(even|odd|(([+-]|)(\\d*)n|)"+nt+"*(?:([+-]|)"+nt+"*(\\d+)|))"+nt+"*\\)|)","i"),bool:new RegExp("^(?:"+tt+")$","i"),needsContext:new RegExp("^"+nt+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+nt+"*((?:-\\d)?\\d*)"+nt+"*\\)|)(?=[^-]|$)","i")},gt=/^(?:input|select|textarea|button)$/i,yt=/^h\d$/i,mt=/^[^{]+\{\s*\[native \w/,vt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,bt=/[+~]/,wt=/'|\\/g,xt=new RegExp("\\\\([\\da-f]{1,6}"+nt+"?|("+nt+")|.)","ig"),_t=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},Ct=function(){j()};try{Q.apply(J=K.call(M.childNodes),M.childNodes),J[M.childNodes.length].nodeType}catch(Pt){Q={apply:J.length?function(e,t){Z.apply(e,K.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}x=t.support={},P=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},j=t.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:M;return r!==D&&9===r.nodeType&&r.documentElement?(D=r,V=r.documentElement,n=r.defaultView,n&&n!==n.top&&(n.addEventListener?n.addEventListener("unload",Ct,!1):n.attachEvent&&n.attachEvent("onunload",Ct)),$=!P(r),x.attributes=o(function(e){return e.className="i",!e.getAttribute("className")}),x.getElementsByTagName=o(function(e){return e.appendChild(r.createComment("")),!e.getElementsByTagName("*").length}),x.getElementsByClassName=mt.test(r.getElementsByClassName),x.getById=o(function(e){return V.appendChild(e).id=R,!r.getElementsByName||!r.getElementsByName(R).length}),x.getById?(_.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&$){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},_.filter.ID=function(e){var t=e.replace(xt,_t);return function(e){return e.getAttribute("id")===t}}):(delete _.find.ID,_.filter.ID=function(e){var t=e.replace(xt,_t);return function(e){var n="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}}),_.find.TAG=x.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):x.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],o=0,i=t.getElementsByTagName(e);if("*"===e){for(;n=i[o++];)1===n.nodeType&&r.push(n);return r}return i},_.find.CLASS=x.getElementsByClassName&&function(e,t){return $?t.getElementsByClassName(e):void 0},L=[],q=[],(x.qsa=mt.test(r.querySelectorAll))&&(o(function(e){V.appendChild(e).innerHTML="<a id='"+R+"'></a><select id='"+R+"-\f]' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+nt+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||q.push("\\["+nt+"*(?:value|"+tt+")"),e.querySelectorAll("[id~="+R+"-]").length||q.push("~="),e.querySelectorAll(":checked").length||q.push(":checked"),e.querySelectorAll("a#"+R+"+*").length||q.push(".#.+[+~]")}),o(function(e){var t=r.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&q.push("name"+nt+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),q.push(",.*:")})),(x.matchesSelector=mt.test(I=V.matches||V.webkitMatchesSelector||V.mozMatchesSelector||V.oMatchesSelector||V.msMatchesSelector))&&o(function(e){x.disconnectedMatch=I.call(e,"div"),I.call(e,"[s!='']:x"),L.push("!=",st)}),q=q.length&&new RegExp(q.join("|")),L=L.length&&new RegExp(L.join("|")),t=mt.test(V.compareDocumentPosition),O=t||mt.test(V.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},z=t?function(e,t){if(e===t)return E=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n?n:(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&n||!x.sortDetached&&t.compareDocumentPosition(e)===n?e===r||e.ownerDocument===M&&O(M,e)?-1:t===r||t.ownerDocument===M&&O(M,t)?1:A?et(A,e)-et(A,t):0:4&n?-1:1)}:function(e,t){if(e===t)return E=!0,0;var n,o=0,i=e.parentNode,a=t.parentNode,c=[e],u=[t];if(!i||!a)return e===r?-1:t===r?1:i?-1:a?1:A?et(A,e)-et(A,t):0;if(i===a)return s(e,t);for(n=e;n=n.parentNode;)c.unshift(n);for(n=t;n=n.parentNode;)u.unshift(n);for(;c[o]===u[o];)o++;return o?s(c[o],u[o]):c[o]===M?-1:u[o]===M?1:0},r):D},t.matches=function(e,n){return t(e,null,null,n)},t.matchesSelector=function(e,n){if((e.ownerDocument||e)!==D&&j(e),n=n.replace(pt,"='$1']"),!(!x.matchesSelector||!$||L&&L.test(n)||q&&q.test(n)))try{var r=I.call(e,n);if(r||x.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(o){}return t(n,D,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==D&&j(e),O(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==D&&j(e);var n=_.attrHandle[t.toLowerCase()],r=n&&X.call(_.attrHandle,t.toLowerCase())?n(e,t,!$):void 0;return void 0!==r?r:x.attributes||!$?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,n=[],r=0,o=0;if(E=!x.detectDuplicates,A=!x.sortStable&&e.slice(0),e.sort(z),E){for(;t=e[o++];)t===e[o]&&(r=n.push(o));for(;r--;)e.splice(n[r],1)}return A=null,e},C=t.getText=function(e){var t,n="",r=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=C(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[r++];)n+=C(t);return n},_=t.selectors={cacheLength:50,createPseudo:r,match:ft,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(xt,_t),e[3]=(e[3]||e[4]||e[5]||"").replace(xt,_t),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return ft.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&ht.test(n)&&(t=T(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(xt,_t).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=B[e+" "];return t||(t=new RegExp("(^|"+nt+")"+e+"("+nt+"|$)"))&&B(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,n,r){return function(o){var i=t.attr(o,e);return null==i?"!="===n:n?(i+="","="===n?i===r:"!="===n?i!==r:"^="===n?r&&0===i.indexOf(r):"*="===n?r&&i.indexOf(r)>-1:"$="===n?r&&i.slice(-r.length)===r:"~="===n?(" "+i.replace(at," ")+" ").indexOf(r)>-1:"|="===n?i===r||i.slice(0,r.length+1)===r+"-":!1):!0}},CHILD:function(e,t,n,r,o){var i="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===r&&0===o?function(e){return!!e.parentNode}:function(t,n,c){var u,l,p,h,d,f,g=i!==s?"nextSibling":"previousSibling",y=t.parentNode,m=a&&t.nodeName.toLowerCase(),v=!c&&!a;if(y){if(i){for(;g;){for(p=t;p=p[g];)if(a?p.nodeName.toLowerCase()===m:1===p.nodeType)return!1;f=g="only"===e&&!f&&"nextSibling"}return!0}if(f=[s?y.firstChild:y.lastChild],s&&v){for(l=y[R]||(y[R]={}),u=l[e]||[],d=u[0]===F&&u[1],h=u[0]===F&&u[2],p=d&&y.childNodes[d];p=++d&&p&&p[g]||(h=d=0)||f.pop();)if(1===p.nodeType&&++h&&p===t){l[e]=[F,d,h];break}}else if(v&&(u=(t[R]||(t[R]={}))[e])&&u[0]===F)h=u[1];else for(;(p=++d&&p&&p[g]||(h=d=0)||f.pop())&&((a?p.nodeName.toLowerCase()!==m:1!==p.nodeType)||!++h||(v&&((p[R]||(p[R]={}))[e]=[F,h]),p!==t)););return h-=o,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,n){var o,i=_.pseudos[e]||_.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return i[R]?i(n):i.length>1?(o=[e,e,"",n],_.setFilters.hasOwnProperty(e.toLowerCase())?r(function(e,t){for(var r,o=i(e,n),s=o.length;s--;)r=et(e,o[s]),e[r]=!(t[r]=o[s])}):function(e){return i(e,0,o)}):i}},pseudos:{not:r(function(e){var t=[],n=[],o=k(e.replace(ct,"$1"));return o[R]?r(function(e,t,n,r){for(var i,s=o(e,null,r,[]),a=e.length;a--;)(i=s[a])&&(e[a]=!(t[a]=i))}):function(e,r,i){return t[0]=e,o(t,null,i,n),t[0]=null,!n.pop()}}),has:r(function(e){return function(n){return t(e,n).length>0}}),contains:r(function(e){return e=e.replace(xt,_t),function(t){return(t.textContent||t.innerText||C(t)).indexOf(e)>-1}}),lang:r(function(e){return dt.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(xt,_t).toLowerCase(),function(t){var n;do if(n=$?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===V},focus:function(e){return e===D.activeElement&&(!D.hasFocus||D.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!_.pseudos.empty(e)},header:function(e){return yt.test(e.nodeName)},input:function(e){return gt.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:u(function(){return[0]}),last:u(function(e,t){return[t-1]}),eq:u(function(e,t,n){return[0>n?n+t:n]}),even:u(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:u(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:u(function(e,t,n){for(var r=0>n?n+t:n;--r>=0;)e.push(r);return e}),gt:u(function(e,t,n){for(var r=0>n?n+t:n;++r<t;)e.push(r);return e})}},_.pseudos.nth=_.pseudos.eq;for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})_.pseudos[w]=a(w);for(w in{submit:!0,reset:!0})_.pseudos[w]=c(w);return p.prototype=_.filters=_.pseudos,_.setFilters=new p,T=t.tokenize=function(e,n){var r,o,i,s,a,c,u,l=U[e+" "];if(l)return n?0:l.slice(0);for(a=e,c=[],u=_.preFilter;a;){(!r||(o=ut.exec(a)))&&(o&&(a=a.slice(o[0].length)||a),c.push(i=[])),r=!1,(o=lt.exec(a))&&(r=o.shift(),i.push({value:r,type:o[0].replace(ct," ")}),a=a.slice(r.length));for(s in _.filter)!(o=ft[s].exec(a))||u[s]&&!(o=u[s](o))||(r=o.shift(),i.push({value:r,type:s,matches:o}),a=a.slice(r.length));if(!r)break}return n?a.length:a?t.error(e):U(e,c).slice(0)},k=t.compile=function(e,t){var n,r=[],o=[],i=W[e+" "];if(!i){for(t||(t=T(e)),n=t.length;n--;)i=v(t[n]),i[R]?r.push(i):o.push(i);i=W(e,b(o,r)),i.selector=e}return i},N=t.select=function(e,t,n,r){var o,i,s,a,c,u="function"==typeof e&&e,p=!r&&T(e=u.selector||e);if(n=n||[],1===p.length){if(i=p[0]=p[0].slice(0),i.length>2&&"ID"===(s=i[0]).type&&x.getById&&9===t.nodeType&&$&&_.relative[i[1].type]){if(t=(_.find.ID(s.matches[0].replace(xt,_t),t)||[])[0],!t)return n;u&&(t=t.parentNode),e=e.slice(i.shift().value.length)}for(o=ft.needsContext.test(e)?0:i.length;o--&&(s=i[o],!_.relative[a=s.type]);)if((c=_.find[a])&&(r=c(s.matches[0].replace(xt,_t),bt.test(i[0].type)&&l(t.parentNode)||t))){if(i.splice(o,1),e=r.length&&h(i),!e)return Q.apply(n,r),n;break}}return(u||k(e,p))(r,t,!$,n,bt.test(e)&&l(t.parentNode)||t),n},x.sortStable=R.split("").sort(z).join("")===R,x.detectDuplicates=!!E,j(),x.sortDetached=o(function(e){return 1&e.compareDocumentPosition(D.createElement("div"))}),o(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||i("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),x.attributes&&o(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||i("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),o(function(e){return null==e.getAttribute("disabled")})||i(tt,function(e,t,n){var r;return n?void 0:e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null
}),t}(e);K.find=ot,K.expr=ot.selectors,K.expr[":"]=K.expr.pseudos,K.unique=ot.uniqueSort,K.text=ot.getText,K.isXMLDoc=ot.isXML,K.contains=ot.contains;var it=K.expr.match.needsContext,st=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,at=/^.[^:#\[\.,]*$/;K.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?K.find.matchesSelector(r,e)?[r]:[]:K.find.matches(e,K.grep(t,function(e){return 1===e.nodeType}))},K.fn.extend({find:function(e){var t,n=this.length,r=[],o=this;if("string"!=typeof e)return this.pushStack(K(e).filter(function(){for(t=0;n>t;t++)if(K.contains(o[t],this))return!0}));for(t=0;n>t;t++)K.find(e,o[t],r);return r=this.pushStack(n>1?K.unique(r):r),r.selector=this.selector?this.selector+" "+e:e,r},filter:function(e){return this.pushStack(r(this,e||[],!1))},not:function(e){return this.pushStack(r(this,e||[],!0))},is:function(e){return!!r(this,"string"==typeof e&&it.test(e)?K(e):e||[],!1).length}});var ct,ut=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,lt=K.fn.init=function(e,t){var n,r;if(!e)return this;if("string"==typeof e){if(n="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:ut.exec(e),!n||!n[1]&&t)return!t||t.jquery?(t||ct).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof K?t[0]:t,K.merge(this,K.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:Z,!0)),st.test(n[1])&&K.isPlainObject(t))for(n in t)K.isFunction(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}return r=Z.getElementById(n[2]),r&&r.parentNode&&(this.length=1,this[0]=r),this.context=Z,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):K.isFunction(e)?"undefined"!=typeof ct.ready?ct.ready(e):e(K):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),K.makeArray(e,this))};lt.prototype=K.fn,ct=K(Z);var pt=/^(?:parents|prev(?:Until|All))/,ht={children:!0,contents:!0,next:!0,prev:!0};K.extend({dir:function(e,t,n){for(var r=[],o=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(o&&K(e).is(n))break;r.push(e)}return r},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}}),K.fn.extend({has:function(e){var t=K(e,this),n=t.length;return this.filter(function(){for(var e=0;n>e;e++)if(K.contains(this,t[e]))return!0})},closest:function(e,t){for(var n,r=0,o=this.length,i=[],s=it.test(e)||"string"!=typeof e?K(e,t||this.context):0;o>r;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(s?s.index(n)>-1:1===n.nodeType&&K.find.matchesSelector(n,e))){i.push(n);break}return this.pushStack(i.length>1?K.unique(i):i)},index:function(e){return e?"string"==typeof e?z.call(K(e),this[0]):z.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(K.unique(K.merge(this.get(),K(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),K.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return K.dir(e,"parentNode")},parentsUntil:function(e,t,n){return K.dir(e,"parentNode",n)},next:function(e){return o(e,"nextSibling")},prev:function(e){return o(e,"previousSibling")},nextAll:function(e){return K.dir(e,"nextSibling")},prevAll:function(e){return K.dir(e,"previousSibling")},nextUntil:function(e,t,n){return K.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return K.dir(e,"previousSibling",n)},siblings:function(e){return K.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return K.sibling(e.firstChild)},contents:function(e){return e.contentDocument||K.merge([],e.childNodes)}},function(e,t){K.fn[e]=function(n,r){var o=K.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(o=K.filter(r,o)),this.length>1&&(ht[e]||K.unique(o),pt.test(e)&&o.reverse()),this.pushStack(o)}});var dt=/\S+/g,ft={};K.Callbacks=function(e){e="string"==typeof e?ft[e]||i(e):K.extend({},e);var t,n,r,o,s,a,c=[],u=!e.once&&[],l=function(i){for(t=e.memory&&i,n=!0,a=o||0,o=0,s=c.length,r=!0;c&&s>a;a++)if(c[a].apply(i[0],i[1])===!1&&e.stopOnFalse){t=!1;break}r=!1,c&&(u?u.length&&l(u.shift()):t?c=[]:p.disable())},p={add:function(){if(c){var n=c.length;!function i(t){K.each(t,function(t,n){var r=K.type(n);"function"===r?e.unique&&p.has(n)||c.push(n):n&&n.length&&"string"!==r&&i(n)})}(arguments),r?s=c.length:t&&(o=n,l(t))}return this},remove:function(){return c&&K.each(arguments,function(e,t){for(var n;(n=K.inArray(t,c,n))>-1;)c.splice(n,1),r&&(s>=n&&s--,a>=n&&a--)}),this},has:function(e){return e?K.inArray(e,c)>-1:!(!c||!c.length)},empty:function(){return c=[],s=0,this},disable:function(){return c=u=t=void 0,this},disabled:function(){return!c},lock:function(){return u=void 0,t||p.disable(),this},locked:function(){return!u},fireWith:function(e,t){return!c||n&&!u||(t=t||[],t=[e,t.slice?t.slice():t],r?u.push(t):l(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!n}};return p},K.extend({Deferred:function(e){var t=[["resolve","done",K.Callbacks("once memory"),"resolved"],["reject","fail",K.Callbacks("once memory"),"rejected"],["notify","progress",K.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return o.done(arguments).fail(arguments),this},then:function(){var e=arguments;return K.Deferred(function(n){K.each(t,function(t,i){var s=K.isFunction(e[t])&&e[t];o[i[1]](function(){var e=s&&s.apply(this,arguments);e&&K.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[i[0]+"With"](this===r?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?K.extend(e,r):r}},o={};return r.pipe=r.then,K.each(t,function(e,i){var s=i[2],a=i[3];r[i[1]]=s.add,a&&s.add(function(){n=a},t[1^e][2].disable,t[2][2].lock),o[i[0]]=function(){return o[i[0]+"With"](this===o?r:this,arguments),this},o[i[0]+"With"]=s.fireWith}),r.promise(o),e&&e.call(o,o),o},when:function(e){var t,n,r,o=0,i=B.call(arguments),s=i.length,a=1!==s||e&&K.isFunction(e.promise)?s:0,c=1===a?e:K.Deferred(),u=function(e,n,r){return function(o){n[e]=this,r[e]=arguments.length>1?B.call(arguments):o,r===t?c.notifyWith(n,r):--a||c.resolveWith(n,r)}};if(s>1)for(t=new Array(s),n=new Array(s),r=new Array(s);s>o;o++)i[o]&&K.isFunction(i[o].promise)?i[o].promise().done(u(o,r,i)).fail(c.reject).progress(u(o,n,t)):--a;return a||c.resolveWith(r,i),c.promise()}});var gt;K.fn.ready=function(e){return K.ready.promise().done(e),this},K.extend({isReady:!1,readyWait:1,holdReady:function(e){e?K.readyWait++:K.ready(!0)},ready:function(e){(e===!0?--K.readyWait:K.isReady)||(K.isReady=!0,e!==!0&&--K.readyWait>0||(gt.resolveWith(Z,[K]),K.fn.triggerHandler&&(K(Z).triggerHandler("ready"),K(Z).off("ready"))))}}),K.ready.promise=function(t){return gt||(gt=K.Deferred(),"complete"===Z.readyState?setTimeout(K.ready):(Z.addEventListener("DOMContentLoaded",s,!1),e.addEventListener("load",s,!1))),gt.promise(t)},K.ready.promise();var yt=K.access=function(e,t,n,r,o,i,s){var a=0,c=e.length,u=null==n;if("object"===K.type(n)){o=!0;for(a in n)K.access(e,t,a,n[a],!0,i,s)}else if(void 0!==r&&(o=!0,K.isFunction(r)||(s=!0),u&&(s?(t.call(e,r),t=null):(u=t,t=function(e,t,n){return u.call(K(e),n)})),t))for(;c>a;a++)t(e[a],n,s?r:r.call(e[a],a,t(e[a],n)));return o?e:u?t.call(e):c?t(e[0],n):i};K.acceptData=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType},a.uid=1,a.accepts=K.acceptData,a.prototype={key:function(e){if(!a.accepts(e))return 0;var t={},n=e[this.expando];if(!n){n=a.uid++;try{t[this.expando]={value:n},Object.defineProperties(e,t)}catch(r){t[this.expando]=n,K.extend(e,t)}}return this.cache[n]||(this.cache[n]={}),n},set:function(e,t,n){var r,o=this.key(e),i=this.cache[o];if("string"==typeof t)i[t]=n;else if(K.isEmptyObject(i))K.extend(this.cache[o],t);else for(r in t)i[r]=t[r];return i},get:function(e,t){var n=this.cache[this.key(e)];return void 0===t?n:n[t]},access:function(e,t,n){var r;return void 0===t||t&&"string"==typeof t&&void 0===n?(r=this.get(e,t),void 0!==r?r:this.get(e,K.camelCase(t))):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r,o,i=this.key(e),s=this.cache[i];if(void 0===t)this.cache[i]={};else{K.isArray(t)?r=t.concat(t.map(K.camelCase)):(o=K.camelCase(t),t in s?r=[t,o]:(r=o,r=r in s?[r]:r.match(dt)||[])),n=r.length;for(;n--;)delete s[r[n]]}},hasData:function(e){return!K.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}};var mt=new a,vt=new a,bt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,wt=/([A-Z])/g;K.extend({hasData:function(e){return vt.hasData(e)||mt.hasData(e)},data:function(e,t,n){return vt.access(e,t,n)},removeData:function(e,t){vt.remove(e,t)},_data:function(e,t,n){return mt.access(e,t,n)},_removeData:function(e,t){mt.remove(e,t)}}),K.fn.extend({data:function(e,t){var n,r,o,i=this[0],s=i&&i.attributes;if(void 0===e){if(this.length&&(o=vt.get(i),1===i.nodeType&&!mt.get(i,"hasDataAttrs"))){for(n=s.length;n--;)s[n]&&(r=s[n].name,0===r.indexOf("data-")&&(r=K.camelCase(r.slice(5)),c(i,r,o[r])));mt.set(i,"hasDataAttrs",!0)}return o}return"object"==typeof e?this.each(function(){vt.set(this,e)}):yt(this,function(t){var n,r=K.camelCase(e);if(i&&void 0===t){if(n=vt.get(i,e),void 0!==n)return n;if(n=vt.get(i,r),void 0!==n)return n;if(n=c(i,r,void 0),void 0!==n)return n}else this.each(function(){var n=vt.get(this,r);vt.set(this,r,t),-1!==e.indexOf("-")&&void 0!==n&&vt.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){vt.remove(this,e)})}}),K.extend({queue:function(e,t,n){var r;return e?(t=(t||"fx")+"queue",r=mt.get(e,t),n&&(!r||K.isArray(n)?r=mt.access(e,t,K.makeArray(n)):r.push(n)),r||[]):void 0},dequeue:function(e,t){t=t||"fx";var n=K.queue(e,t),r=n.length,o=n.shift(),i=K._queueHooks(e,t),s=function(){K.dequeue(e,t)};"inprogress"===o&&(o=n.shift(),r--),o&&("fx"===t&&n.unshift("inprogress"),delete i.stop,o.call(e,s,i)),!r&&i&&i.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return mt.get(e,n)||mt.access(e,n,{empty:K.Callbacks("once memory").add(function(){mt.remove(e,[t+"queue",n])})})}}),K.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?K.queue(this[0],e):void 0===t?this:this.each(function(){var n=K.queue(this,e,t);K._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&K.dequeue(this,e)})},dequeue:function(e){return this.each(function(){K.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,o=K.Deferred(),i=this,s=this.length,a=function(){--r||o.resolveWith(i,[i])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)n=mt.get(i[s],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(a));return a(),o.promise(t)}});var xt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,_t=["Top","Right","Bottom","Left"],Ct=function(e,t){return e=t||e,"none"===K.css(e,"display")||!K.contains(e.ownerDocument,e)},Pt=/^(?:checkbox|radio)$/i;!function(){var e=Z.createDocumentFragment(),t=e.appendChild(Z.createElement("div")),n=Z.createElement("input");n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),t.appendChild(n),Y.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",Y.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var Tt="undefined";Y.focusinBubbles="onfocusin"in e;var kt=/^key/,Nt=/^(?:mouse|pointer|contextmenu)|click/,St=/^(?:focusinfocus|focusoutblur)$/,At=/^([^.]*)(?:\.(.+)|)$/;K.event={global:{},add:function(e,t,n,r,o){var i,s,a,c,u,l,p,h,d,f,g,y=mt.get(e);if(y)for(n.handler&&(i=n,n=i.handler,o=i.selector),n.guid||(n.guid=K.guid++),(c=y.events)||(c=y.events={}),(s=y.handle)||(s=y.handle=function(t){return typeof K!==Tt&&K.event.triggered!==t.type?K.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(dt)||[""],u=t.length;u--;)a=At.exec(t[u])||[],d=g=a[1],f=(a[2]||"").split(".").sort(),d&&(p=K.event.special[d]||{},d=(o?p.delegateType:p.bindType)||d,p=K.event.special[d]||{},l=K.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:o,needsContext:o&&K.expr.match.needsContext.test(o),namespace:f.join(".")},i),(h=c[d])||(h=c[d]=[],h.delegateCount=0,p.setup&&p.setup.call(e,r,f,s)!==!1||e.addEventListener&&e.addEventListener(d,s,!1)),p.add&&(p.add.call(e,l),l.handler.guid||(l.handler.guid=n.guid)),o?h.splice(h.delegateCount++,0,l):h.push(l),K.event.global[d]=!0)},remove:function(e,t,n,r,o){var i,s,a,c,u,l,p,h,d,f,g,y=mt.hasData(e)&&mt.get(e);if(y&&(c=y.events)){for(t=(t||"").match(dt)||[""],u=t.length;u--;)if(a=At.exec(t[u])||[],d=g=a[1],f=(a[2]||"").split(".").sort(),d){for(p=K.event.special[d]||{},d=(r?p.delegateType:p.bindType)||d,h=c[d]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=i=h.length;i--;)l=h[i],!o&&g!==l.origType||n&&n.guid!==l.guid||a&&!a.test(l.namespace)||r&&r!==l.selector&&("**"!==r||!l.selector)||(h.splice(i,1),l.selector&&h.delegateCount--,p.remove&&p.remove.call(e,l));s&&!h.length&&(p.teardown&&p.teardown.call(e,f,y.handle)!==!1||K.removeEvent(e,d,y.handle),delete c[d])}else for(d in c)K.event.remove(e,d+t[u],n,r,!0);K.isEmptyObject(c)&&(delete y.handle,mt.remove(e,"events"))}},trigger:function(t,n,r,o){var i,s,a,c,u,l,p,h=[r||Z],d=J.call(t,"type")?t.type:t,f=J.call(t,"namespace")?t.namespace.split("."):[];if(s=a=r=r||Z,3!==r.nodeType&&8!==r.nodeType&&!St.test(d+K.event.triggered)&&(d.indexOf(".")>=0&&(f=d.split("."),d=f.shift(),f.sort()),u=d.indexOf(":")<0&&"on"+d,t=t[K.expando]?t:new K.Event(d,"object"==typeof t&&t),t.isTrigger=o?2:3,t.namespace=f.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),n=null==n?[t]:K.makeArray(n,[t]),p=K.event.special[d]||{},o||!p.trigger||p.trigger.apply(r,n)!==!1)){if(!o&&!p.noBubble&&!K.isWindow(r)){for(c=p.delegateType||d,St.test(c+d)||(s=s.parentNode);s;s=s.parentNode)h.push(s),a=s;a===(r.ownerDocument||Z)&&h.push(a.defaultView||a.parentWindow||e)}for(i=0;(s=h[i++])&&!t.isPropagationStopped();)t.type=i>1?c:p.bindType||d,l=(mt.get(s,"events")||{})[t.type]&&mt.get(s,"handle"),l&&l.apply(s,n),l=u&&s[u],l&&l.apply&&K.acceptData(s)&&(t.result=l.apply(s,n),t.result===!1&&t.preventDefault());return t.type=d,o||t.isDefaultPrevented()||p._default&&p._default.apply(h.pop(),n)!==!1||!K.acceptData(r)||u&&K.isFunction(r[d])&&!K.isWindow(r)&&(a=r[u],a&&(r[u]=null),K.event.triggered=d,r[d](),K.event.triggered=void 0,a&&(r[u]=a)),t.result}},dispatch:function(e){e=K.event.fix(e);var t,n,r,o,i,s=[],a=B.call(arguments),c=(mt.get(this,"events")||{})[e.type]||[],u=K.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!u.preDispatch||u.preDispatch.call(this,e)!==!1){for(s=K.event.handlers.call(this,e,c),t=0;(o=s[t++])&&!e.isPropagationStopped();)for(e.currentTarget=o.elem,n=0;(i=o.handlers[n++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,r=((K.event.special[i.origType]||{}).handle||i.handler).apply(o.elem,a),void 0!==r&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,e),e.result}},handlers:function(e,t){var n,r,o,i,s=[],a=t.delegateCount,c=e.target;if(a&&c.nodeType&&(!e.button||"click"!==e.type))for(;c!==this;c=c.parentNode||this)if(c.disabled!==!0||"click"!==e.type){for(r=[],n=0;a>n;n++)i=t[n],o=i.selector+" ",void 0===r[o]&&(r[o]=i.needsContext?K(o,this).index(c)>=0:K.find(o,this,null,[c]).length),r[o]&&r.push(i);r.length&&s.push({elem:c,handlers:r})}return a<t.length&&s.push({elem:this,handlers:t.slice(a)}),s},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,o,i=t.button;return null==e.pageX&&null!=t.clientX&&(n=e.target.ownerDocument||Z,r=n.documentElement,o=n.body,e.pageX=t.clientX+(r&&r.scrollLeft||o&&o.scrollLeft||0)-(r&&r.clientLeft||o&&o.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||o&&o.scrollTop||0)-(r&&r.clientTop||o&&o.clientTop||0)),e.which||void 0===i||(e.which=1&i?1:2&i?3:4&i?2:0),e}},fix:function(e){if(e[K.expando])return e;var t,n,r,o=e.type,i=e,s=this.fixHooks[o];for(s||(this.fixHooks[o]=s=Nt.test(o)?this.mouseHooks:kt.test(o)?this.keyHooks:{}),r=s.props?this.props.concat(s.props):this.props,e=new K.Event(i),t=r.length;t--;)n=r[t],e[n]=i[n];return e.target||(e.target=Z),3===e.target.nodeType&&(e.target=e.target.parentNode),s.filter?s.filter(e,i):e},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==p()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===p()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&K.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(e){return K.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var o=K.extend(new K.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?K.event.trigger(o,null,t):K.event.dispatch.call(t,o),o.isDefaultPrevented()&&n.preventDefault()}},K.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},K.Event=function(e,t){return this instanceof K.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?u:l):this.type=e,t&&K.extend(this,t),this.timeStamp=e&&e.timeStamp||K.now(),void(this[K.expando]=!0)):new K.Event(e,t)},K.Event.prototype={isDefaultPrevented:l,isPropagationStopped:l,isImmediatePropagationStopped:l,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=u,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=u,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=u,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},K.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){K.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,o=e.relatedTarget,i=e.handleObj;return(!o||o!==r&&!K.contains(r,o))&&(e.type=i.origType,n=i.handler.apply(this,arguments),e.type=t),n}}}),Y.focusinBubbles||K.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){K.event.simulate(t,e.target,K.event.fix(e),!0)};K.event.special[t]={setup:function(){var r=this.ownerDocument||this,o=mt.access(r,t);o||r.addEventListener(e,n,!0),mt.access(r,t,(o||0)+1)},teardown:function(){var r=this.ownerDocument||this,o=mt.access(r,t)-1;o?mt.access(r,t,o):(r.removeEventListener(e,n,!0),mt.remove(r,t))}}}),K.fn.extend({on:function(e,t,n,r,o){var i,s;if("object"==typeof e){"string"!=typeof t&&(n=n||t,t=void 0);for(s in e)this.on(s,t,n,e[s],o);return this}if(null==n&&null==r?(r=t,n=t=void 0):null==r&&("string"==typeof t?(r=n,n=void 0):(r=n,n=t,t=void 0)),r===!1)r=l;else if(!r)return this;return 1===o&&(i=r,r=function(e){return K().off(e),i.apply(this,arguments)},r.guid=i.guid||(i.guid=K.guid++)),this.each(function(){K.event.add(this,e,r,n,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,n){var r,o;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,K(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(o in e)this.off(o,t,e[o]);return this}return(t===!1||"function"==typeof t)&&(n=t,t=void 0),n===!1&&(n=l),this.each(function(){K.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){K.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];return n?K.event.trigger(e,t,n,!0):void 0}});var Et=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,jt=/<([\w:]+)/,Dt=/<|&#?\w+;/,Vt=/<(?:script|style|link)/i,$t=/checked\s*(?:[^=]|=\s*.checked.)/i,qt=/^$|\/(?:java|ecma)script/i,Lt=/^true\/(.*)/,It=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ot={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ot.optgroup=Ot.option,Ot.tbody=Ot.tfoot=Ot.colgroup=Ot.caption=Ot.thead,Ot.th=Ot.td,K.extend({clone:function(e,t,n){var r,o,i,s,a=e.cloneNode(!0),c=K.contains(e.ownerDocument,e);if(!(Y.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||K.isXMLDoc(e)))for(s=m(a),i=m(e),r=0,o=i.length;o>r;r++)v(i[r],s[r]);if(t)if(n)for(i=i||m(e),s=s||m(a),r=0,o=i.length;o>r;r++)y(i[r],s[r]);else y(e,a);return s=m(a,"script"),s.length>0&&g(s,!c&&m(e,"script")),a},buildFragment:function(e,t,n,r){for(var o,i,s,a,c,u,l=t.createDocumentFragment(),p=[],h=0,d=e.length;d>h;h++)if(o=e[h],o||0===o)if("object"===K.type(o))K.merge(p,o.nodeType?[o]:o);else if(Dt.test(o)){for(i=i||l.appendChild(t.createElement("div")),s=(jt.exec(o)||["",""])[1].toLowerCase(),a=Ot[s]||Ot._default,i.innerHTML=a[1]+o.replace(Et,"<$1></$2>")+a[2],u=a[0];u--;)i=i.lastChild;K.merge(p,i.childNodes),i=l.firstChild,i.textContent=""}else p.push(t.createTextNode(o));for(l.textContent="",h=0;o=p[h++];)if((!r||-1===K.inArray(o,r))&&(c=K.contains(o.ownerDocument,o),i=m(l.appendChild(o),"script"),c&&g(i),n))for(u=0;o=i[u++];)qt.test(o.type||"")&&n.push(o);return l},cleanData:function(e){for(var t,n,r,o,i=K.event.special,s=0;void 0!==(n=e[s]);s++){if(K.acceptData(n)&&(o=n[mt.expando],o&&(t=mt.cache[o]))){if(t.events)for(r in t.events)i[r]?K.event.remove(n,r):K.removeEvent(n,r,t.handle);mt.cache[o]&&delete mt.cache[o]}delete vt.cache[n[vt.expando]]}}}),K.fn.extend({text:function(e){return yt(this,function(e){return void 0===e?K.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=e)})},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=h(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=h(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,r=e?K.filter(e,this):this,o=0;null!=(n=r[o]);o++)t||1!==n.nodeType||K.cleanData(m(n)),n.parentNode&&(t&&K.contains(n.ownerDocument,n)&&g(m(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(K.cleanData(m(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return K.clone(this,e,t)})},html:function(e){return yt(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Vt.test(e)&&!Ot[(jt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Et,"<$1></$2>");try{for(;r>n;n++)t=this[n]||{},1===t.nodeType&&(K.cleanData(m(t,!1)),t.innerHTML=e);t=0}catch(o){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,K.cleanData(m(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=U.apply([],e);var n,r,o,i,s,a,c=0,u=this.length,l=this,p=u-1,h=e[0],g=K.isFunction(h);if(g||u>1&&"string"==typeof h&&!Y.checkClone&&$t.test(h))return this.each(function(n){var r=l.eq(n);g&&(e[0]=h.call(this,n,r.html())),r.domManip(e,t)});if(u&&(n=K.buildFragment(e,this[0].ownerDocument,!1,this),r=n.firstChild,1===n.childNodes.length&&(n=r),r)){for(o=K.map(m(n,"script"),d),i=o.length;u>c;c++)s=n,c!==p&&(s=K.clone(s,!0,!0),i&&K.merge(o,m(s,"script"))),t.call(this[c],s,c);if(i)for(a=o[o.length-1].ownerDocument,K.map(o,f),c=0;i>c;c++)s=o[c],qt.test(s.type||"")&&!mt.access(s,"globalEval")&&K.contains(a,s)&&(s.src?K._evalUrl&&K._evalUrl(s.src):K.globalEval(s.textContent.replace(It,"")))}return this}}),K.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){K.fn[e]=function(e){for(var n,r=[],o=K(e),i=o.length-1,s=0;i>=s;s++)n=s===i?this:this.clone(!0),K(o[s])[t](n),W.apply(r,n.get());return this.pushStack(r)}});var Rt,Mt={},Ft=/^margin/,Ht=new RegExp("^("+xt+")(?!px)[a-z%]+$","i"),Bt=function(t){return t.ownerDocument.defaultView.opener?t.ownerDocument.defaultView.getComputedStyle(t,null):e.getComputedStyle(t,null)};!function(){function t(){s.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",s.innerHTML="",o.appendChild(i);var t=e.getComputedStyle(s,null);n="1%"!==t.top,r="4px"===t.width,o.removeChild(i)}var n,r,o=Z.documentElement,i=Z.createElement("div"),s=Z.createElement("div");s.style&&(s.style.backgroundClip="content-box",s.cloneNode(!0).style.backgroundClip="",Y.clearCloneStyle="content-box"===s.style.backgroundClip,i.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",i.appendChild(s),e.getComputedStyle&&K.extend(Y,{pixelPosition:function(){return t(),n},boxSizingReliable:function(){return null==r&&t(),r},reliableMarginRight:function(){var t,n=s.appendChild(Z.createElement("div"));return n.style.cssText=s.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",n.style.marginRight=n.style.width="0",s.style.width="1px",o.appendChild(i),t=!parseFloat(e.getComputedStyle(n,null).marginRight),o.removeChild(i),s.removeChild(n),t}}))}(),K.swap=function(e,t,n,r){var o,i,s={};for(i in t)s[i]=e.style[i],e.style[i]=t[i];o=n.apply(e,r||[]);for(i in t)e.style[i]=s[i];return o};var Ut=/^(none|table(?!-c[ea]).+)/,Wt=new RegExp("^("+xt+")(.*)$","i"),zt=new RegExp("^([+-])=("+xt+")","i"),Gt={position:"absolute",visibility:"hidden",display:"block"},Xt={letterSpacing:"0",fontWeight:"400"},Jt=["Webkit","O","Moz","ms"];K.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=x(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,i,s,a=K.camelCase(t),c=e.style;return t=K.cssProps[a]||(K.cssProps[a]=C(c,a)),s=K.cssHooks[t]||K.cssHooks[a],void 0===n?s&&"get"in s&&void 0!==(o=s.get(e,!1,r))?o:c[t]:(i=typeof n,"string"===i&&(o=zt.exec(n))&&(n=(o[1]+1)*o[2]+parseFloat(K.css(e,t)),i="number"),null!=n&&n===n&&("number"!==i||K.cssNumber[a]||(n+="px"),Y.clearCloneStyle||""!==n||0!==t.indexOf("background")||(c[t]="inherit"),s&&"set"in s&&void 0===(n=s.set(e,n,r))||(c[t]=n)),void 0)}},css:function(e,t,n,r){var o,i,s,a=K.camelCase(t);return t=K.cssProps[a]||(K.cssProps[a]=C(e.style,a)),s=K.cssHooks[t]||K.cssHooks[a],s&&"get"in s&&(o=s.get(e,!0,n)),void 0===o&&(o=x(e,t,r)),"normal"===o&&t in Xt&&(o=Xt[t]),""===n||n?(i=parseFloat(o),n===!0||K.isNumeric(i)?i||0:o):o}}),K.each(["height","width"],function(e,t){K.cssHooks[t]={get:function(e,n,r){return n?Ut.test(K.css(e,"display"))&&0===e.offsetWidth?K.swap(e,Gt,function(){return k(e,t,r)}):k(e,t,r):void 0},set:function(e,n,r){var o=r&&Bt(e);return P(e,n,r?T(e,t,r,"border-box"===K.css(e,"boxSizing",!1,o),o):0)}}}),K.cssHooks.marginRight=_(Y.reliableMarginRight,function(e,t){return t?K.swap(e,{display:"inline-block"},x,[e,"marginRight"]):void 0}),K.each({margin:"",padding:"",border:"Width"},function(e,t){K.cssHooks[e+t]={expand:function(n){for(var r=0,o={},i="string"==typeof n?n.split(" "):[n];4>r;r++)o[e+_t[r]+t]=i[r]||i[r-2]||i[0];return o}},Ft.test(e)||(K.cssHooks[e+t].set=P)}),K.fn.extend({css:function(e,t){return yt(this,function(e,t,n){var r,o,i={},s=0;if(K.isArray(t)){for(r=Bt(e),o=t.length;o>s;s++)i[t[s]]=K.css(e,t[s],!1,r);return i}return void 0!==n?K.style(e,t,n):K.css(e,t)},e,t,arguments.length>1)},show:function(){return N(this,!0)},hide:function(){return N(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Ct(this)?K(this).show():K(this).hide()})}}),K.Tween=S,S.prototype={constructor:S,init:function(e,t,n,r,o,i){this.elem=e,this.prop=n,this.easing=o||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=i||(K.cssNumber[n]?"":"px")},cur:function(){var e=S.propHooks[this.prop];return e&&e.get?e.get(this):S.propHooks._default.get(this)},run:function(e){var t,n=S.propHooks[this.prop];return this.pos=t=this.options.duration?K.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):S.propHooks._default.set(this),this}},S.prototype.init.prototype=S.prototype,S.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=K.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){K.fx.step[e.prop]?K.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[K.cssProps[e.prop]]||K.cssHooks[e.prop])?K.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},S.propHooks.scrollTop=S.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},K.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},K.fx=S.prototype.init,K.fx.step={};var Yt,Zt,Qt=/^(?:toggle|show|hide)$/,Kt=new RegExp("^(?:([+-])=|)("+xt+")([a-z%]*)$","i"),en=/queueHooks$/,tn=[D],nn={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),o=Kt.exec(t),i=o&&o[3]||(K.cssNumber[e]?"":"px"),s=(K.cssNumber[e]||"px"!==i&&+r)&&Kt.exec(K.css(n.elem,e)),a=1,c=20;if(s&&s[3]!==i){i=i||s[3],o=o||[],s=+r||1;do a=a||".5",s/=a,K.style(n.elem,e,s+i);while(a!==(a=n.cur()/r)&&1!==a&&--c)}return o&&(s=n.start=+s||+r||0,n.unit=i,n.end=o[1]?s+(o[1]+1)*o[2]:+o[2]),n}]};K.Animation=K.extend($,{tweener:function(e,t){K.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,r=0,o=e.length;o>r;r++)n=e[r],nn[n]=nn[n]||[],nn[n].unshift(t)},prefilter:function(e,t){t?tn.unshift(e):tn.push(e)}}),K.speed=function(e,t,n){var r=e&&"object"==typeof e?K.extend({},e):{complete:n||!n&&t||K.isFunction(e)&&e,duration:e,easing:n&&t||t&&!K.isFunction(t)&&t};return r.duration=K.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in K.fx.speeds?K.fx.speeds[r.duration]:K.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){K.isFunction(r.old)&&r.old.call(this),r.queue&&K.dequeue(this,r.queue)},r},K.fn.extend({fadeTo:function(e,t,n,r){return this.filter(Ct).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var o=K.isEmptyObject(e),i=K.speed(t,n,r),s=function(){var t=$(this,K.extend({},e),i);(o||mt.get(this,"finish"))&&t.stop(!0)};return s.finish=s,o||i.queue===!1?this.each(s):this.queue(i.queue,s)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,o=null!=e&&e+"queueHooks",i=K.timers,s=mt.get(this);
if(o)s[o]&&s[o].stop&&r(s[o]);else for(o in s)s[o]&&s[o].stop&&en.test(o)&&r(s[o]);for(o=i.length;o--;)i[o].elem!==this||null!=e&&i[o].queue!==e||(i[o].anim.stop(n),t=!1,i.splice(o,1));(t||!n)&&K.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=mt.get(this),r=n[e+"queue"],o=n[e+"queueHooks"],i=K.timers,s=r?r.length:0;for(n.finish=!0,K.queue(this,e,[]),o&&o.stop&&o.stop.call(this,!0),t=i.length;t--;)i[t].elem===this&&i[t].queue===e&&(i[t].anim.stop(!0),i.splice(t,1));for(t=0;s>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),K.each(["toggle","show","hide"],function(e,t){var n=K.fn[t];K.fn[t]=function(e,r,o){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(E(t,!0),e,r,o)}}),K.each({slideDown:E("show"),slideUp:E("hide"),slideToggle:E("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){K.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),K.timers=[],K.fx.tick=function(){var e,t=0,n=K.timers;for(Yt=K.now();t<n.length;t++)e=n[t],e()||n[t]!==e||n.splice(t--,1);n.length||K.fx.stop(),Yt=void 0},K.fx.timer=function(e){K.timers.push(e),e()?K.fx.start():K.timers.pop()},K.fx.interval=13,K.fx.start=function(){Zt||(Zt=setInterval(K.fx.tick,K.fx.interval))},K.fx.stop=function(){clearInterval(Zt),Zt=null},K.fx.speeds={slow:600,fast:200,_default:400},K.fn.delay=function(e,t){return e=K.fx?K.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},function(){var e=Z.createElement("input"),t=Z.createElement("select"),n=t.appendChild(Z.createElement("option"));e.type="checkbox",Y.checkOn=""!==e.value,Y.optSelected=n.selected,t.disabled=!0,Y.optDisabled=!n.disabled,e=Z.createElement("input"),e.value="t",e.type="radio",Y.radioValue="t"===e.value}();var rn,on,sn=K.expr.attrHandle;K.fn.extend({attr:function(e,t){return yt(this,K.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){K.removeAttr(this,e)})}}),K.extend({attr:function(e,t,n){var r,o,i=e.nodeType;if(e&&3!==i&&8!==i&&2!==i)return typeof e.getAttribute===Tt?K.prop(e,t,n):(1===i&&K.isXMLDoc(e)||(t=t.toLowerCase(),r=K.attrHooks[t]||(K.expr.match.bool.test(t)?on:rn)),void 0===n?r&&"get"in r&&null!==(o=r.get(e,t))?o:(o=K.find.attr(e,t),null==o?void 0:o):null!==n?r&&"set"in r&&void 0!==(o=r.set(e,n,t))?o:(e.setAttribute(t,n+""),n):void K.removeAttr(e,t))},removeAttr:function(e,t){var n,r,o=0,i=t&&t.match(dt);if(i&&1===e.nodeType)for(;n=i[o++];)r=K.propFix[n]||n,K.expr.match.bool.test(n)&&(e[r]=!1),e.removeAttribute(n)},attrHooks:{type:{set:function(e,t){if(!Y.radioValue&&"radio"===t&&K.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}}}),on={set:function(e,t,n){return t===!1?K.removeAttr(e,n):e.setAttribute(n,n),n}},K.each(K.expr.match.bool.source.match(/\w+/g),function(e,t){var n=sn[t]||K.find.attr;sn[t]=function(e,t,r){var o,i;return r||(i=sn[t],sn[t]=o,o=null!=n(e,t,r)?t.toLowerCase():null,sn[t]=i),o}});var an=/^(?:input|select|textarea|button)$/i;K.fn.extend({prop:function(e,t){return yt(this,K.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[K.propFix[e]||e]})}}),K.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var r,o,i,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return i=1!==s||!K.isXMLDoc(e),i&&(t=K.propFix[t]||t,o=K.propHooks[t]),void 0!==n?o&&"set"in o&&void 0!==(r=o.set(e,n,t))?r:e[t]=n:o&&"get"in o&&null!==(r=o.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||an.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),Y.optSelected||(K.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),K.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){K.propFix[this.toLowerCase()]=this});var cn=/[\t\r\n\f]/g;K.fn.extend({addClass:function(e){var t,n,r,o,i,s,a="string"==typeof e&&e,c=0,u=this.length;if(K.isFunction(e))return this.each(function(t){K(this).addClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(dt)||[];u>c;c++)if(n=this[c],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(cn," "):" ")){for(i=0;o=t[i++];)r.indexOf(" "+o+" ")<0&&(r+=o+" ");s=K.trim(r),n.className!==s&&(n.className=s)}return this},removeClass:function(e){var t,n,r,o,i,s,a=0===arguments.length||"string"==typeof e&&e,c=0,u=this.length;if(K.isFunction(e))return this.each(function(t){K(this).removeClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(dt)||[];u>c;c++)if(n=this[c],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(cn," "):"")){for(i=0;o=t[i++];)for(;r.indexOf(" "+o+" ")>=0;)r=r.replace(" "+o+" "," ");s=e?K.trim(r):"",n.className!==s&&(n.className=s)}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):this.each(K.isFunction(e)?function(n){K(this).toggleClass(e.call(this,n,this.className,t),t)}:function(){if("string"===n)for(var t,r=0,o=K(this),i=e.match(dt)||[];t=i[r++];)o.hasClass(t)?o.removeClass(t):o.addClass(t);else(n===Tt||"boolean"===n)&&(this.className&&mt.set(this,"__className__",this.className),this.className=this.className||e===!1?"":mt.get(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,r=this.length;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(cn," ").indexOf(t)>=0)return!0;return!1}});var un=/\r/g;K.fn.extend({val:function(e){var t,n,r,o=this[0];{if(arguments.length)return r=K.isFunction(e),this.each(function(n){var o;1===this.nodeType&&(o=r?e.call(this,n,K(this).val()):e,null==o?o="":"number"==typeof o?o+="":K.isArray(o)&&(o=K.map(o,function(e){return null==e?"":e+""})),t=K.valHooks[this.type]||K.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,o,"value")||(this.value=o))});if(o)return t=K.valHooks[o.type]||K.valHooks[o.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(n=t.get(o,"value"))?n:(n=o.value,"string"==typeof n?n.replace(un,""):null==n?"":n)}}}),K.extend({valHooks:{option:{get:function(e){var t=K.find.attr(e,"value");return null!=t?t:K.trim(K.text(e))}},select:{get:function(e){for(var t,n,r=e.options,o=e.selectedIndex,i="select-one"===e.type||0>o,s=i?null:[],a=i?o+1:r.length,c=0>o?a:i?o:0;a>c;c++)if(n=r[c],!(!n.selected&&c!==o||(Y.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&K.nodeName(n.parentNode,"optgroup"))){if(t=K(n).val(),i)return t;s.push(t)}return s},set:function(e,t){for(var n,r,o=e.options,i=K.makeArray(t),s=o.length;s--;)r=o[s],(r.selected=K.inArray(r.value,i)>=0)&&(n=!0);return n||(e.selectedIndex=-1),i}}}}),K.each(["radio","checkbox"],function(){K.valHooks[this]={set:function(e,t){return K.isArray(t)?e.checked=K.inArray(K(e).val(),t)>=0:void 0}},Y.checkOn||(K.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),K.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){K.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),K.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var ln=K.now(),pn=/\?/;K.parseJSON=function(e){return JSON.parse(e+"")},K.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{n=new DOMParser,t=n.parseFromString(e,"text/xml")}catch(r){t=void 0}return(!t||t.getElementsByTagName("parsererror").length)&&K.error("Invalid XML: "+e),t};var hn=/#.*$/,dn=/([?&])_=[^&]*/,fn=/^(.*?):[ \t]*([^\r\n]*)$/gm,gn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,yn=/^(?:GET|HEAD)$/,mn=/^\/\//,vn=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,bn={},wn={},xn="*/".concat("*"),_n=e.location.href,Cn=vn.exec(_n.toLowerCase())||[];K.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:_n,type:"GET",isLocal:gn.test(Cn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":xn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":K.parseJSON,"text xml":K.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?I(I(e,K.ajaxSettings),t):I(K.ajaxSettings,e)},ajaxPrefilter:q(bn),ajaxTransport:q(wn),ajax:function(e,t){function n(e,t,n,s){var c,l,m,v,w,_=t;2!==b&&(b=2,a&&clearTimeout(a),r=void 0,i=s||"",x.readyState=e>0?4:0,c=e>=200&&300>e||304===e,n&&(v=O(p,x,n)),v=R(p,v,x,c),c?(p.ifModified&&(w=x.getResponseHeader("Last-Modified"),w&&(K.lastModified[o]=w),w=x.getResponseHeader("etag"),w&&(K.etag[o]=w)),204===e||"HEAD"===p.type?_="nocontent":304===e?_="notmodified":(_=v.state,l=v.data,m=v.error,c=!m)):(m=_,(e||!_)&&(_="error",0>e&&(e=0))),x.status=e,x.statusText=(t||_)+"",c?f.resolveWith(h,[l,_,x]):f.rejectWith(h,[x,_,m]),x.statusCode(y),y=void 0,u&&d.trigger(c?"ajaxSuccess":"ajaxError",[x,p,c?l:m]),g.fireWith(h,[x,_]),u&&(d.trigger("ajaxComplete",[x,p]),--K.active||K.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var r,o,i,s,a,c,u,l,p=K.ajaxSetup({},t),h=p.context||p,d=p.context&&(h.nodeType||h.jquery)?K(h):K.event,f=K.Deferred(),g=K.Callbacks("once memory"),y=p.statusCode||{},m={},v={},b=0,w="canceled",x={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!s)for(s={};t=fn.exec(i);)s[t[1].toLowerCase()]=t[2];t=s[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?i:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=v[n]=v[n]||e,m[e]=t),this},overrideMimeType:function(e){return b||(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)y[t]=[y[t],e[t]];else x.always(e[x.status]);return this},abort:function(e){var t=e||w;return r&&r.abort(t),n(0,t),this}};if(f.promise(x).complete=g.add,x.success=x.done,x.error=x.fail,p.url=((e||p.url||_n)+"").replace(hn,"").replace(mn,Cn[1]+"//"),p.type=t.method||t.type||p.method||p.type,p.dataTypes=K.trim(p.dataType||"*").toLowerCase().match(dt)||[""],null==p.crossDomain&&(c=vn.exec(p.url.toLowerCase()),p.crossDomain=!(!c||c[1]===Cn[1]&&c[2]===Cn[2]&&(c[3]||("http:"===c[1]?"80":"443"))===(Cn[3]||("http:"===Cn[1]?"80":"443")))),p.data&&p.processData&&"string"!=typeof p.data&&(p.data=K.param(p.data,p.traditional)),L(bn,p,t,x),2===b)return x;u=K.event&&p.global,u&&0===K.active++&&K.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!yn.test(p.type),o=p.url,p.hasContent||(p.data&&(o=p.url+=(pn.test(o)?"&":"?")+p.data,delete p.data),p.cache===!1&&(p.url=dn.test(o)?o.replace(dn,"$1_="+ln++):o+(pn.test(o)?"&":"?")+"_="+ln++)),p.ifModified&&(K.lastModified[o]&&x.setRequestHeader("If-Modified-Since",K.lastModified[o]),K.etag[o]&&x.setRequestHeader("If-None-Match",K.etag[o])),(p.data&&p.hasContent&&p.contentType!==!1||t.contentType)&&x.setRequestHeader("Content-Type",p.contentType),x.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+xn+"; q=0.01":""):p.accepts["*"]);for(l in p.headers)x.setRequestHeader(l,p.headers[l]);if(p.beforeSend&&(p.beforeSend.call(h,x,p)===!1||2===b))return x.abort();w="abort";for(l in{success:1,error:1,complete:1})x[l](p[l]);if(r=L(wn,p,t,x)){x.readyState=1,u&&d.trigger("ajaxSend",[x,p]),p.async&&p.timeout>0&&(a=setTimeout(function(){x.abort("timeout")},p.timeout));try{b=1,r.send(m,n)}catch(_){if(!(2>b))throw _;n(-1,_)}}else n(-1,"No Transport");return x},getJSON:function(e,t,n){return K.get(e,t,n,"json")},getScript:function(e,t){return K.get(e,void 0,t,"script")}}),K.each(["get","post"],function(e,t){K[t]=function(e,n,r,o){return K.isFunction(n)&&(o=o||r,r=n,n=void 0),K.ajax({url:e,type:t,dataType:o,data:n,success:r})}}),K._evalUrl=function(e){return K.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},K.fn.extend({wrapAll:function(e){var t;return K.isFunction(e)?this.each(function(t){K(this).wrapAll(e.call(this,t))}):(this[0]&&(t=K(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return this.each(K.isFunction(e)?function(t){K(this).wrapInner(e.call(this,t))}:function(){var t=K(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=K.isFunction(e);return this.each(function(n){K(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){K.nodeName(this,"body")||K(this).replaceWith(this.childNodes)}).end()}}),K.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},K.expr.filters.visible=function(e){return!K.expr.filters.hidden(e)};var Pn=/%20/g,Tn=/\[\]$/,kn=/\r?\n/g,Nn=/^(?:submit|button|image|reset|file)$/i,Sn=/^(?:input|select|textarea|keygen)/i;K.param=function(e,t){var n,r=[],o=function(e,t){t=K.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=K.ajaxSettings&&K.ajaxSettings.traditional),K.isArray(e)||e.jquery&&!K.isPlainObject(e))K.each(e,function(){o(this.name,this.value)});else for(n in e)M(n,e[n],t,o);return r.join("&").replace(Pn,"+")},K.fn.extend({serialize:function(){return K.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=K.prop(this,"elements");return e?K.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!K(this).is(":disabled")&&Sn.test(this.nodeName)&&!Nn.test(e)&&(this.checked||!Pt.test(e))}).map(function(e,t){var n=K(this).val();return null==n?null:K.isArray(n)?K.map(n,function(e){return{name:t.name,value:e.replace(kn,"\r\n")}}):{name:t.name,value:n.replace(kn,"\r\n")}}).get()}}),K.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var An=0,En={},jn={0:200,1223:204},Dn=K.ajaxSettings.xhr();e.attachEvent&&e.attachEvent("onunload",function(){for(var e in En)En[e]()}),Y.cors=!!Dn&&"withCredentials"in Dn,Y.ajax=Dn=!!Dn,K.ajaxTransport(function(e){var t;return Y.cors||Dn&&!e.crossDomain?{send:function(n,r){var o,i=e.xhr(),s=++An;if(i.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(o in e.xhrFields)i[o]=e.xhrFields[o];e.mimeType&&i.overrideMimeType&&i.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(o in n)i.setRequestHeader(o,n[o]);t=function(e){return function(){t&&(delete En[s],t=i.onload=i.onerror=null,"abort"===e?i.abort():"error"===e?r(i.status,i.statusText):r(jn[i.status]||i.status,i.statusText,"string"==typeof i.responseText?{text:i.responseText}:void 0,i.getAllResponseHeaders()))}},i.onload=t(),i.onerror=t("error"),t=En[s]=t("abort");try{i.send(e.hasContent&&e.data||null)}catch(a){if(t)throw a}},abort:function(){t&&t()}}:void 0}),K.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return K.globalEval(e),e}}}),K.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),K.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(r,o){t=K("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&o("error"===e.type?404:200,e.type)}),Z.head.appendChild(t[0])},abort:function(){n&&n()}}}});var Vn=[],$n=/(=)\?(?=&|$)|\?\?/;K.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Vn.pop()||K.expando+"_"+ln++;return this[e]=!0,e}}),K.ajaxPrefilter("json jsonp",function(t,n,r){var o,i,s,a=t.jsonp!==!1&&($n.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&$n.test(t.data)&&"data");return a||"jsonp"===t.dataTypes[0]?(o=t.jsonpCallback=K.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace($n,"$1"+o):t.jsonp!==!1&&(t.url+=(pn.test(t.url)?"&":"?")+t.jsonp+"="+o),t.converters["script json"]=function(){return s||K.error(o+" was not called"),s[0]},t.dataTypes[0]="json",i=e[o],e[o]=function(){s=arguments},r.always(function(){e[o]=i,t[o]&&(t.jsonpCallback=n.jsonpCallback,Vn.push(o)),s&&K.isFunction(i)&&i(s[0]),s=i=void 0}),"script"):void 0}),K.parseHTML=function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||Z;var r=st.exec(e),o=!n&&[];return r?[t.createElement(r[1])]:(r=K.buildFragment([e],t,o),o&&o.length&&K(o).remove(),K.merge([],r.childNodes))};var qn=K.fn.load;K.fn.load=function(e,t,n){if("string"!=typeof e&&qn)return qn.apply(this,arguments);var r,o,i,s=this,a=e.indexOf(" ");return a>=0&&(r=K.trim(e.slice(a)),e=e.slice(0,a)),K.isFunction(t)?(n=t,t=void 0):t&&"object"==typeof t&&(o="POST"),s.length>0&&K.ajax({url:e,type:o,dataType:"html",data:t}).done(function(e){i=arguments,s.html(r?K("<div>").append(K.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){s.each(n,i||[e.responseText,t,e])}),this},K.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){K.fn[t]=function(e){return this.on(t,e)}}),K.expr.filters.animated=function(e){return K.grep(K.timers,function(t){return e===t.elem}).length};var Ln=e.document.documentElement;K.offset={setOffset:function(e,t,n){var r,o,i,s,a,c,u,l=K.css(e,"position"),p=K(e),h={};"static"===l&&(e.style.position="relative"),a=p.offset(),i=K.css(e,"top"),c=K.css(e,"left"),u=("absolute"===l||"fixed"===l)&&(i+c).indexOf("auto")>-1,u?(r=p.position(),s=r.top,o=r.left):(s=parseFloat(i)||0,o=parseFloat(c)||0),K.isFunction(t)&&(t=t.call(e,n,a)),null!=t.top&&(h.top=t.top-a.top+s),null!=t.left&&(h.left=t.left-a.left+o),"using"in t?t.using.call(e,h):p.css(h)}},K.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){K.offset.setOffset(this,e,t)});var t,n,r=this[0],o={top:0,left:0},i=r&&r.ownerDocument;if(i)return t=i.documentElement,K.contains(t,r)?(typeof r.getBoundingClientRect!==Tt&&(o=r.getBoundingClientRect()),n=F(i),{top:o.top+n.pageYOffset-t.clientTop,left:o.left+n.pageXOffset-t.clientLeft}):o},position:function(){if(this[0]){var e,t,n=this[0],r={top:0,left:0};return"fixed"===K.css(n,"position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),K.nodeName(e[0],"html")||(r=e.offset()),r.top+=K.css(e[0],"borderTopWidth",!0),r.left+=K.css(e[0],"borderLeftWidth",!0)),{top:t.top-r.top-K.css(n,"marginTop",!0),left:t.left-r.left-K.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||Ln;e&&!K.nodeName(e,"html")&&"static"===K.css(e,"position");)e=e.offsetParent;return e||Ln})}}),K.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,n){var r="pageYOffset"===n;K.fn[t]=function(o){return yt(this,function(t,o,i){var s=F(t);return void 0===i?s?s[n]:t[o]:void(s?s.scrollTo(r?e.pageXOffset:i,r?i:e.pageYOffset):t[o]=i)},t,o,arguments.length,null)}}),K.each(["top","left"],function(e,t){K.cssHooks[t]=_(Y.pixelPosition,function(e,n){return n?(n=x(e,t),Ht.test(n)?K(e).position()[t]+"px":n):void 0})}),K.each({Height:"height",Width:"width"},function(e,t){K.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){K.fn[r]=function(r,o){var i=arguments.length&&(n||"boolean"!=typeof r),s=n||(r===!0||o===!0?"margin":"border");return yt(this,function(t,n,r){var o;return K.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===r?K.css(t,n,s):K.style(t,n,r,s)},t,i?r:void 0,i,null)}})}),K.fn.size=function(){return this.length},K.fn.andSelf=K.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return K});var In=e.jQuery,On=e.$;return K.noConflict=function(t){return e.$===K&&(e.$=On),t&&e.jQuery===K&&(e.jQuery=In),K},typeof t===Tt&&(e.jQuery=e.$=K),K})},{}],3:[function(e,t){"use strict";var n=e("underscore"),r=e("substance-util"),o=e("substance-document"),i=function(e){e=i.prepareOptions(e),o.call(this,e),this.bySourceId=this.addIndex("by_source_id",{property:"source_id"}),this.nodeTypes=e.nodeTypes,void 0===e.seed&&(this.create({id:"document",type:"document",guid:e.id,creator:e.creator,created_at:e.created_at,views:i.views,title:"","abstract":"",authors:[]}),n.each(i.views,function(e){this.create({id:e,type:"view",nodes:[]})},this))};i.Prototype=function(){this.fromSnapshot=function(e,t){return i.fromSnapshot(e,t)},this.getNodeBySourceId=function(e){var t=this.bySourceId.get(e),n=Object.keys(t)[0],r=t[n];return r},this.getHeadings=function(){var e=n.filter(this.get("content").getNodes(),function(e){return"heading"===e.type});return e},this.getTocNodes=function(){var e=n.filter(this.get("content").getNodes(),function(e){return e.includeInToc()});return e}},i.prepareOptions=function(e){return e=e||{},e.nodeTypes=n.extend(i.nodeTypes,e.nodeTypes),e.schema=i.getSchema(e.nodeTypes),e},i.getSchema=function(e){var t=r.deepclone(o.schema);return t.id="lens-article",t.version="0.3.0",n.each(e,function(e,n){t.types[n]=e.Model.type}),t},i.fromSnapshot=function(e,t){return t=t||{},t.seed=e,new i(t)},i.views=["content","figures","citations","definitions","info"],i.nodeTypes=e("./nodes"),i.ViewFactory=e("./view_factory"),i.ResourceView=e("./resource_view");var s={id:"lens_article",nodes:{document:{type:"document",id:"document",views:["content"],title:"The Anatomy of a Lens Article",authors:["contributor_1","contributor_2","contributor_3"],guid:"lens_article"},content:{type:"view",id:"content",nodes:["cover"]},cover:{id:"cover",type:"cover"},contributor_1:{id:"contributor_1",type:"contributor",name:"Michael Aufreiter"},contributor_2:{id:"contributor_2",type:"contributor",name:"Ivan Grubisic"},contributor_3:{id:"contributor_3",type:"contributor",name:"Rebecca Close"}}};i.describe=function(){var e=new i({seed:s}),t=0;return n.each(i.nodeTypes,function(r){r=r.Model;var o="heading_"+r.type.id;e.create({id:o,type:"heading",content:r.description.name,level:1});var i=r.description.remarks.join(" "),s="text_"+r.type.id+"_intro";e.create({id:s,type:"text",content:i}),e.show("content",[o,s],-1),e.create({id:o+"_properties",type:"text",content:r.description.name+" uses the following properties:"}),e.show("content",[o+"_properties"],-1);var a=[];n.each(r.description.properties,function(n,r){var o="text_"+ ++t;e.create({id:o,type:"text",content:r+": "+n}),e.create({id:t+"_annotation",type:"code",path:[o,"content"],range:[0,r.length]}),a.push(o)}),e.create({id:o+"_property_list",type:"list",items:a,ordered:!1}),e.show("content",[o+"_property_list"],-1),e.create({id:o+"_example",type:"text",content:"Here's an example:"}),e.create({id:o+"_example_codeblock",type:"codeblock",content:JSON.stringify(r.example,null,"  ")}),e.show("content",[o+"_example",o+"_example_codeblock"],-1)}),e},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,i.prototype.constructor=i,Object.defineProperties(i.prototype,{id:{get:function(){return this.get("document").guid},set:function(e){this.get("document").guid=e}},creator:{get:function(){return this.get("document").creator},set:function(e){this.get("document").creator=e}},created_at:{get:function(){return this.get("document").created_at},set:function(e){this.get("document").created_at=e}},title:{get:function(){return this.get("document").title},set:function(e){this.get("document").title=e}},"abstract":{get:function(){return this.get("document")["abstract"]},set:function(e){this.get("document")["abstract"]=e}},on_behalf_of:{get:function(){return this.get("document").on_behalf_of},set:function(e){this.get("document").on_behalf_of=e}},authors:{get:function(){var e=this.get("document");return e.authors?n.map(e.authors,function(e){return this.get(e)},this):""},set:function(e){var t=this.get("document");t.authors=n.clone(e)}},views:{get:function(){return this.get("document").views.slice(0)}}}),t.exports=i},{"./nodes":74,"./resource_view":118,"./view_factory":119,"substance-document":162,"substance-util":169,underscore:177}],4:[function(e,t){var n={1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},r={};r.formatDate=function(e){var t=e.split("-");if(t.length>=3){var r=new Date(t[0],t[1]-1,t[2]);return r.toUTCString().slice(0,16)}if(2===t.length){var o=t[1].replace(/^0/,""),i=t[0];return n[o]+" "+i}return i},t.exports=r},{}],5:[function(e,t){"use strict";var n=e("./article");t.exports=n},{"./article":3}],6:[function(e,t){"use strict";var n=e("substance-document"),r=function(e,t){n.Node.call(this,e,t)};r.type={id:"affiliation",parent:"content",properties:{source_id:"string",city:"string",country:"string",department:"string",institution:"string",label:"string"}},r.description={name:"Affiliation",description:"Person affiliation",remarks:["Name of a institution or organization, such as a university or corporation, that is the affiliation for a contributor such as an author or an editor."],properties:{institution:"Name of institution",department:"Department name",country:"Country where institution is located",city:"City of institution",label:"Affilation label. Usually a number counting up"}},r.example={id:"affiliation_1",source_id:"aff1",city:"Jena",country:"Germany",department:"Department of Molecular Ecology",institution:"Max Planck Institute for Chemical Ecology",label:"1",type:"affiliation"},r.Prototype=function(){},r.Prototype.prototype=n.Node.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.Node.defineProperties(r),t.exports=r},{"substance-document":162}],7:[function(e,t){"use strict";t.exports={Model:e("./affiliation")}},{"./affiliation":6}],8:[function(e,t){var n=e("substance-document"),r=function(e,t){n.Node.call(this,e,t)};r.type={id:"annotation",properties:{path:["array","string"],range:["array","number"]}},r.Prototype=function(){this.getLevel=function(){return this.constructor.fragmentation}},r.Prototype.prototype=n.Node.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,r.NEVER=1,r.OK=2,r.DONT_CARE=3,r.fragmentation=r.DONT_CARE,n.Node.defineProperties(r),t.exports=r},{"substance-document":162}],9:[function(e,t){"use strict";var n=function(e,t){this.node=e,this.viewFactory=t,this.el=this.createElement(),this.el.dataset.id=e.id,this.$el=$(this.el),this.setClasses()};n.Prototype=function(){this.createElement=function(){return document.createElement("span")},this.setClasses=function(){this.$el.addClass("annotation").addClass(this.node.type)},this.render=function(){return this}},n.prototype=new n.Prototype,t.exports=n},{}],10:[function(e,t){t.exports={Model:e("./annotation.js"),View:e("./annotation_view.js")}},{"./annotation.js":8,"./annotation_view.js":9}],11:[function(e,t){var n=e("substance-document"),r=e("../annotation/annotation"),o=function(e,t){r.call(this,e,t)};o.type={id:"emphasis",parent:"annotation",properties:{style:"string"}},o.Prototype=function(){},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,o.fragmentation=r.DONT_CARE,n.Node.defineProperties(o),t.exports=o},{"../annotation/annotation":8,"substance-document":162}],12:[function(e,t){var n=e("../annotation").View,r=function(e){n.call(this,e)};r.Prototype=function(){this.setClasses=function(){n.prototype.setClasses.call(this),this.$el.addClass(this.node.style)}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,t.exports=r},{"../annotation":10}],13:[function(e,t){t.exports={Model:e("./author_callout.js"),View:e("./author_callout_view.js")}},{"./author_callout.js":11,"./author_callout_view.js":12}],14:[function(e,t){"use strict";var n=e("substance-document"),r=n.Composite,o=function(e,t){r.call(this,e,t)};o.type={id:"box",parent:"content",properties:{source_id:"string",label:"string",children:["array","paragraph"]}},o.description={name:"Box",remarks:["A box type."],properties:{label:"string",children:"0..n Paragraph nodes"}},o.example={id:"box_1",type:"box",label:"Box 1",children:["paragraph_1","paragraph_2"]},o.Prototype=function(){this.getChildrenIds=function(){return this.properties.children}},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,n.Node.defineProperties(o),t.exports=o},{"substance-document":162}],15:[function(e,t){"use strict";var n=e("../node").View,r=e("../composite").View,o=e("substance-application").$$,i=function(e,t){r.call(this,e,t)};i.Prototype=function(){this.render=function(){if(n.prototype.render.call(this),this.node.label){var e=o(".label",{text:this.node.label});this.content.appendChild(e)}return this.renderChildren(),this.el.appendChild(this.content),this}},i.Prototype.prototype=r.prototype,i.prototype=new i.Prototype,t.exports=i},{"../composite":31,"../node":86,"substance-application":151}],16:[function(e,t){"use strict";t.exports={Model:e("./box"),View:e("./box_view")}},{"./box":14,"./box_view":15}],17:[function(e,t){"use strict";var n=e("substance-document"),r=function(e,t){n.Composite.call(this,e,t)};r.type={id:"caption",parent:"content",properties:{source_id:"string",title:"paragraph",children:["array","paragraph"]}},r.description={name:"Caption",remarks:["Container element for the textual description that is associated with a Figure, Table, Video node etc.","This is the title for the figure or the description of the figure that prints or displays with the figure."],properties:{title:"Caption title (optional)",children:"0..n Paragraph nodes"}},r.example={id:"caption_1",children:["paragraph_1","paragraph_2"]},r.Prototype=function(){this.getChildrenIds=function(){return this.properties.children||[]},this.hasTitle=function(){return!!this.properties.title},this.getTitle=function(){return this.properties.title?this.document.get(this.properties.title):void 0}},r.Prototype.prototype=n.Composite.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.Node.defineProperties(r),t.exports=r},{"substance-document":162}],18:[function(e,t){"use strict";var n=e("../composite").View,r=e("substance-application").$$,o=function(e,t){n.call(this,e,t)};o.Prototype=function(){this.render=function(){this.content=r("div.content");var e=this.node.getTitle();if(e){var t=this.createChildView(this.node.title),n=t.render().el;n.classList.add("caption-title"),this.content.appendChild(n)}return this.renderChildren(),this.el.appendChild(this.content),this}},o.Prototype.prototype=n.prototype,o.prototype=new o.Prototype,t.exports=o},{"../composite":31,"substance-application":151}],19:[function(e,t){"use strict";t.exports={Model:e("./caption"),View:e("./caption_view")}},{"./caption":17,"./caption_view":18}],20:[function(e,t){var n=e("underscore"),r=e("substance-document"),o=function(e,t){r.Node.call(this,e,t)};o.type={id:"article_citation",parent:"content",properties:{source_id:"string",title:"string",label:"string",authors:["array","string"],doi:"string",source:"string",volume:"string",citation_type:"string",publisher_name:"string",publisher_location:"string",fpage:"string",lpage:"string",year:"string",comment:"string",citation_urls:["array","object"]}},o.description={name:"Citation",remarks:["A journal citation.","This element can be used to describe all kinds of citations."],properties:{title:"The article's title",label:"Optional label (could be a number for instance)",doi:"DOI reference",source:"Usually the journal name",volume:"Issue number",citation_type:"Citation Type",publisher_name:"Publisher Name",publisher_location:"Publisher Location",fpage:"First page",lpage:"Last page",year:"The year of publication",comment:"Author comment.",citation_urls:"A list of links for accessing the article on the web"}},o.example={id:"article_nature08160",type:"article_citation",label:"5",title:"The genome of the blood fluke Schistosoma mansoni",authors:["M Berriman","BJ Haas","PT LoVerde"],citation_type:"Journal Article",doi:"http://dx.doi.org/10.1038/nature08160",source:"Nature",volume:"460",fpage:"352",lpage:"8",year:"1984",comment:"This is a comment.",citation_urls:[{name:"PubMed",url:"http://www.ncbi.nlm.nih.gov/pubmed/19606141"}]},o.Prototype=function(){this.urls=function(){return this.properties.citation_urls.length>0?this.properties.citation_urls:[this.properties.doi]
},this.getHeader=function(){return n.compact([this.properties.label,this.properties.citation_type||"Citation"]).join(" - ")}},o.Prototype.prototype=r.Node.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,r.Node.defineProperties(o),t.exports=o},{"substance-document":162,underscore:177}],21:[function(e,t){"use strict";var n=e("underscore"),r=e("substance-application").$$,o=e("../node").View,i=e("../../resource_view"),s=function(e,t,n){o.apply(this,arguments),i.call(this,n)};s.Prototype=function(){n.extend(this,i.prototype),this.renderBody=function(){var e=document.createDocumentFragment(),t=this.node,o=this.createTextPropertyView([t.id,"title"],{classes:"title"});e.appendChild(o.render().el),e.appendChild(r(".authors",{html:t.authors.join(", ")}));var i="",s="",a="",c="";t.source&&""===t.volume?s=t.source:t.source&&t.volume&&(s=[t.source,t.volume].join(", ")),t.fpage&&t.lpage&&(a=[t.fpage,t.lpage].join("-"));var u=[];if(t.publisher_name&&t.publisher_location&&(u.push(t.publisher_name),u.push(t.publisher_location)),t.year&&u.push(t.year),c=u.join(", "),i=s,s&&(a||c)&&(i+=": "),a&&c?i+=[a,c].join(", "):(i+=a,i+=c),e.appendChild(r(".source",{html:i})),t.comment){var l=this.createTextView({path:[t.id,"comment"],classes:"comment"});e.appendChild(l.render().el)}t.doi&&e.appendChild(r(".doi",{children:[r("b",{text:"DOI: "}),r("a",{href:t.doi,target:"_new",text:t.doi})]}));var p=r(".citation-urls");n.each(t.citation_urls,function(e){p.appendChild(r("a.url",{href:e.url,text:e.name,target:"_blank"}))}),e.appendChild(p),this.content.appendChild(e)}},s.Prototype.prototype=o.prototype,s.prototype=new s.Prototype,s.prototype.constructor=s,t.exports=s},{"../../resource_view":118,"../node":86,"substance-application":151,underscore:177}],22:[function(e,t){"use strict";t.exports={Model:e("./citation"),View:e("./citation_view")}},{"./citation":20,"./citation_view":21}],23:[function(e,t){var n=e("substance-document"),r=e("../annotation/annotation"),o=e("../resource_reference/resource_reference"),i=function(e,t){o.call(this,e,t)};i.type={id:"citation_reference",parent:"resource_reference",properties:{target:"citation"}},i.Prototype=function(){},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,i.prototype.constructor=i,i.fragmentation=r.NEVER,n.Node.defineProperties(i),t.exports=i},{"../annotation/annotation":8,"../resource_reference/resource_reference":96,"substance-document":162}],24:[function(e,t){t.exports={Model:e("./citation_reference.js"),View:e("../resource_reference/resource_reference_view.js")}},{"../resource_reference/resource_reference_view.js":97,"./citation_reference.js":23}],25:[function(e,t){var n=e("../annotation/annotation"),r=function(e,t){n.call(this,e,t)};r.type={id:"underline",parent:"annotation",properties:{}},r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,r.fragmentation=n.DONT_CARE,t.exports=r},{"../annotation/annotation":8}],26:[function(e,t){t.exports={Model:e("./code.js"),View:e("../annotation/annotation_view.js")}},{"../annotation/annotation_view.js":9,"./code.js":25}],27:[function(e,t){"use strict";var n=e("../text").Model,r=function(e,t){n.call(this,e,t)};r.type={id:"codeblock",parent:"content",properties:{source_id:"string",content:"string"}},r.config={zoomable:!0},r.description={name:"Codeblock",remarks:["Text in a codeblock is displayed in a fixed-width font, and it preserves both spaces and line breaks"],properties:{content:"Content"}},r.example={type:"codeblock",id:"codeblock_1",content:'var text = "Sun";\nvar op1 = null;\ntext = op2.apply(op1.apply(text));\nconsole.log(text);'},r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,t.exports=r},{"../text":107}],28:[function(e,t){"use strict";var n=e("../text/text_view"),r=function(e){n.call(this,e)};r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,t.exports=r},{"../text/text_view":110}],29:[function(e,t){"use strict";t.exports={Model:e("./codeblock"),View:e("./codeblock_view")}},{"./codeblock":27,"./codeblock_view":28}],30:[function(e,t){"use strict";var n=e("../node").View,r=function(e,t){n.call(this,e,t),this.childrenViews=[]};r.Prototype=function(){this.render=function(){return n.prototype.render.call(this),this.renderChildren(),this},this.renderChildren=function(){for(var e=this.node.getChildrenIds(),t=0;t<e.length;t++){var n=this.createChildView(e[t]),r=n.render().el;this.content.appendChild(r)}},this.dispose=function(){n.prototype.dispose.call(this);for(var e=0;e<this.childrenViews.length;e++)this.childrenViews[e].dispose()},this["delete"]=function(){},this.getCharPosition=function(){return 0},this.getDOMPosition=function(){var e=this.$(".content")[0],t=document.createRange();return t.setStartBefore(e.childNodes[0]),t},this.createChildView=function(e){var t=this.createView(e);return this.childrenViews.push(t),t}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,t.exports=r},{"../node":86}],31:[function(e,t){"use strict";var n=e("substance-document");t.exports={Model:n.Composite,View:e("./composite_view")}},{"./composite_view":30,"substance-document":162}],32:[function(e,t){var n=e("underscore"),r=e("substance-document"),o=function(e,t){r.Node.call(this,e,t)};o.type={id:"contributor",parent:"content",properties:{source_id:"string",name:"string",role:"string",contributor_type:"string",affiliations:["array","affiliation"],present_address:["string"],fundings:["array","string"],image:"string",emails:["array","string"],contribution:"string",bio:["array","paragraph"],deceased:"boolean",members:["array","string"],orcid:"string",equal_contrib:["array","string"],competing_interests:["array","string"]}},o.description={name:"Contributor",remarks:["A contributor entity."],properties:{name:"Full name",affiliations:"A list of affiliation ids",present_address:"Present address of the contributor",role:"Role of contributor (e.g. Author, Editor)",fundings:"A list of funding descriptions",deceased:!1,emails:"A list of emails",orcid:"ORCID",contribution:"Description of contribution",equal_contrib:"A list of people who contributed equally",competing_interests:"A list of conflicts",members:"a list of group members"}},o.example={id:"person_1",type:"contributor",name:"John Doe",affiliations:["affiliation_1","affiliation_2"],role:"Author",fundings:["Funding Organisation 1"],emails:["a@b.com"],contribution:"Revising the article, data cleanup",equal_contrib:["John Doe","Jane Doe"]},o.Prototype=function(){this.getAffiliations=function(){return n.map(this.properties.affiliations,function(e){return this.document.get(e)},this)},this.getHeader=function(){return this.properties.contributor_type||"Author"}},o.Prototype.prototype=r.Node.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,r.Node.defineProperties(o),t.exports=o},{"substance-document":162,underscore:177}],33:[function(e,t){"use strict";var n=e("underscore"),r=e("../node").View,o=e("substance-application").$$,i=e("../../resource_view"),s=function(e,t,n){r.call(this,e,t),i.call(this,n)};s.Prototype=function(){n.extend(this,i.prototype),this.renderBody=function(){if(this.content.appendChild(o(".contributor-name",{text:this.node.name})),this.node.role&&this.content.appendChild(o(".role",{text:this.node.role})),this.content.appendChild(o(".affiliations",{children:n.map(this.node.getAffiliations(),function(e){var t=n.compact([e.department,e.institution,e.city,e.country]).join(", ");return o(".affiliation",{text:t})})})),this.node.present_address&&(this.content.appendChild(o(".label",{text:"Present address"})),this.content.appendChild(o(".contribution",{text:this.node.present_address}))),this.node.contribution&&(this.content.appendChild(o(".label",{text:"Contribution"})),this.content.appendChild(o(".contribution",{text:this.node.contribution}))),this.node.equal_contrib&&this.node.equal_contrib.length>0&&(this.content.appendChild(o(".label",{text:"Contributed equally with"})),this.content.appendChild(o(".equal-contribution",{text:this.node.equal_contrib}))),this.node.emails.length>0&&(this.content.appendChild(o(".label",{text:"For correspondence"})),this.content.appendChild(o(".emails",{children:n.map(this.node.emails,function(e){return o("a",{href:"mailto:"+e,text:e})})}))),this.node.fundings.length>0&&(this.content.appendChild(o(".label",{text:"Funding"})),this.content.appendChild(o(".fundings",{children:n.map(this.node.fundings,function(e){return o(".funding",{text:e})})}))),this.node.competing_interests.length>0&&(this.content.appendChild(o(".label",{text:"Competing Interests"})),this.content.appendChild(o(".competing-interests",{children:n.map(this.node.competing_interests,function(e){return o(".conflict",{text:e})})}))),this.node.orcid&&(this.content.appendChild(o(".label",{text:"ORCID"})),this.content.appendChild(o("a.orcid",{href:this.node.orcid,text:this.node.orcid}))),this.node.members.length>0&&(this.content.appendChild(o(".label",{text:"Group Members"})),this.content.appendChild(o(".members",{children:n.map(this.node.members,function(e){return o(".member",{text:e})})}))),this.node.image||this.node.bio&&this.node.bio.length>0){var e=o(".bio"),t=[o("img",{src:this.node.image}),e];n.each(this.node.bio,function(t){e.appendChild(this.createView(t).render().el)},this),this.content.appendChild(o(".contributor-bio.container",{children:t}))}this.node.deceased&&this.content.appendChild(o(".label",{text:"* Deceased"}))}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,t.exports=s},{"../../resource_view":118,"../node":86,"substance-application":151,underscore:177}],34:[function(e,t){"use strict";t.exports={Model:e("./contributor"),View:e("./contributor_view")}},{"./contributor":32,"./contributor_view":33}],35:[function(e,t){var n=e("substance-document"),r=e("../annotation/annotation"),o=e("../resource_reference/resource_reference"),i=function(e,t){o.call(this,e,t)};i.type={id:"contributor_reference",parent:"resource_reference",properties:{target:"contributor"}},i.Prototype=function(){},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,i.prototype.constructor=i,i.fragmentation=r.NEVER,n.Node.defineProperties(i),t.exports=i},{"../annotation/annotation":8,"../resource_reference/resource_reference":96,"substance-document":162}],36:[function(e,t){t.exports={Model:e("./contributor_reference.js"),View:e("../resource_reference/resource_reference_view.js")}},{"../resource_reference/resource_reference_view.js":97,"./contributor_reference.js":35}],37:[function(e,t){var n=e("underscore"),r=e("substance-document"),o=function(e,t){r.Node.call(this,e,t)};o.type={id:"cover",parent:"content",properties:{source_id:"string",authors:["array","paragraph"],breadcrumbs:"object"}},o.description={name:"Cover",remarks:["Virtual view on the title and authors of the paper."],properties:{authors:"A paragraph that has the authors names plus references to the person cards"}},o.example={id:"cover",type:"cover"},o.Prototype=function(){this.getAuthors=function(){return n.map(this.properties.authors,function(e){return this.document.get(e)},this)},this.getTitle=function(){return this.document.title}},o.Prototype.prototype=r.Node.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,r.Node.defineProperties(o),t.exports=o},{"substance-document":162,underscore:177}],38:[function(e,t){"use strict";var n=e("underscore"),r=e("../node").View,o=e("substance-application").$$,i=e("../../article_util"),s=function(e,t){r.call(this,e,t)};s.Prototype=function(){this.render=function(){r.prototype.render.call(this);var e=this.node,t=this.node.document.get("publication_info");if(e.breadcrumbs&&e.breadcrumbs.length>0){var s=o(".breadcrumbs",{children:n.map(e.breadcrumbs,function(e){var t;return t=e.image?'<img src="'+e.image+'" title="'+e.name+'"/>':e.name,o("a",{href:e.url,html:t})})});this.content.appendChild(s)}if(t){var a=t.published_on;if(a){var c=[i.formatDate(a)];t.journal&&!e.breadcrumbs&&c.push(" in <i>"+t.journal+"</i>"),this.content.appendChild(o(".published-on",{html:c.join("")}))}}var u=this.createTextPropertyView(["document","title"],{classes:"title"});this.content.appendChild(u.render().el);var l=o(".authors",{children:n.map(e.getAuthors(),function(e){var t=this.viewFactory.createView(e),n=t.render().el;return this.content.appendChild(n),n},this)});if(l.appendChild(o(".content-node.text.plain",{children:[o(".content",{text:this.node.document.on_behalf_of})]})),this.content.appendChild(l),t&&t.links.length>0){var p=o(".links");n.each(t.links,function(e){if("json"===e.type&&""===e.url){var t=JSON.stringify(this.node.document.toJSON(),null,"  "),n=new Blob([t],{type:"application/json"});p.appendChild(o("a.json",{href:window.URL?window.URL.createObjectURL(n):"#",html:'<i class="fa fa-external-link-square"></i> '+e.name,target:"_blank"}))}else p.appendChild(o("a."+e.type,{href:e.url,html:'<i class="fa fa-external-link-square"></i> '+e.name,target:"_blank"}))},this),this.content.appendChild(p)}if(t){var h=t.doi;h&&this.content.appendChild(o(".doi",{html:'DOI: <a href="http://dx.doi.org/'+h+'">'+h+"</a>"}))}return this}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,t.exports=s},{"../../article_util":4,"../node":86,"substance-application":151,underscore:177}],39:[function(e,t){"use strict";t.exports={Model:e("./cover"),View:e("./cover_view")}},{"./cover":37,"./cover_view":38}],40:[function(e,t){var n=e("substance-document"),r=e("../annotation/annotation"),o=function(e,t){r.call(this,e,t)};o.type={id:"cross_reference",parent:"annotation",properties:{target:"node"}},o.Prototype=function(){},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,o.fragmentation=r.NEVER,n.Node.defineProperties(o),t.exports=o},{"../annotation/annotation":8,"substance-document":162}],41:[function(e,t){t.exports={Model:e("./cross_reference.js"),View:e("../resource_reference/resource_reference_view.js")}},{"../resource_reference/resource_reference_view.js":97,"./cross_reference.js":40}],42:[function(e,t){var n=e("substance-document"),r=e("../annotation/annotation"),o=function(e,t){r.call(this,e,t)};o.type={id:"custom_annotation",parent:"annotation",properties:{name:"string"}},o.Prototype=function(){},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,o.fragmentation=r.DONT_CARE,n.Node.defineProperties(o),t.exports=o},{"../annotation/annotation":8,"substance-document":162}],43:[function(e,t){var n=e("../annotation").View,r=function(e){n.call(this,e)};r.Prototype=function(){this.setClasses=function(){n.prototype.setClasses.call(this),this.$el.addClass(this.node.name)}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,t.exports=r},{"../annotation":10}],44:[function(e,t){t.exports={Model:e("./custom_annotation.js"),View:e("./custom_annotation_view.js")}},{"./custom_annotation.js":42,"./custom_annotation_view.js":43}],45:[function(e,t){var n=e("substance-document"),r=function(e){n.Node.call(this,e)};r.type={id:"definition",parent:"content",properties:{source_id:"string",title:"string",description:"string"}},r.description={name:"Definition",remarks:["A journal citation.","This element can be used to describe all kinds of citations."],properties:{title:"The article's title",description:"Definition description"}},r.example={id:"definition_def1",type:"Definition",title:"IAP",description:"Integrated Analysis Platform"},r.Prototype=function(){this.urls=function(){return this.properties.citation_urls.length>0?this.properties.citation_urls:[this.properties.doi]},this.getHeader=function(){return this.properties.label?[this.properties.label,this.properties.title].join(". "):this.properties.title}},r.Prototype.prototype=n.Node.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.Node.defineProperties(r),t.exports=r},{"substance-document":162}],46:[function(e,t){"use strict";var n=e("underscore"),r=e("../node").View,o=e("substance-application").$$,i=e("../../resource_view"),s=function(e,t,n){r.call(this,e,t),i.call(this,n)};s.Prototype=function(){n.extend(this,i.prototype),this.renderBody=function(){this.content.appendChild(o(".description",{text:this.node.description}))}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,s.prototype.constructor=s,t.exports=s},{"../../resource_view":118,"../node":86,"substance-application":151,underscore:177}],47:[function(e,t){"use strict";t.exports={Model:e("./definition"),View:e("./definition_view")}},{"./definition":45,"./definition_view":46}],48:[function(e,t){var n=e("substance-document"),r=e("../annotation/annotation"),o=e("../resource_reference/resource_reference"),i=function(e,t){o.call(this,e,t)};i.type={id:"definition_reference",parent:"resource_reference",properties:{target:"definition"}},i.Prototype=function(){},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,i.prototype.constructor=i,i.fragmentation=r.NEVER,n.Node.defineProperties(i),t.exports=i},{"../annotation/annotation":8,"../resource_reference/resource_reference":96,"substance-document":162}],49:[function(e,t){t.exports={Model:e("./definition_reference.js"),View:e("../resource_reference/resource_reference_view.js")}},{"../resource_reference/resource_reference_view.js":97,"./definition_reference.js":48}],50:[function(e,t){"use strict";var n=e("substance-document"),r=function(e,t){n.Node.call(this,e,t)};r.type={id:"document",parent:"content",properties:{views:["array","view"],guid:"string",creator:"string",title:"string",authors:["array","contributor"],on_behalf_of:"string","abstract":"string"}},r.Prototype=function(){},r.Prototype.prototype=n.Node.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.Node.defineProperties(r),t.exports=r},{"substance-document":162}],51:[function(e,t){"use strict";t.exports={Model:e("./document_node")}},{"./document_node":50}],52:[function(e,t){var n=e("../annotation/annotation"),r=function(e,t){n.call(this,e,t)};r.type={id:"emphasis",parent:"annotation",properties:{}},r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,r.fragmentation=n.DONT_CARE,t.exports=r},{"../annotation/annotation":8}],53:[function(e,t){t.exports={Model:e("./emphasis.js"),View:e("../annotation/annotation_view.js")}},{"../annotation/annotation_view.js":9,"./emphasis.js":52}],54:[function(e,t){"use strict";var n=e("substance-document"),r=function(e,t){n.Composite.call(this,e,t)};r.type={parent:"content",properties:{source_id:"string",label:"string",url:"string",caption:"caption",attrib:"string"}},r.config={zoomable:!0},r.description={name:"Figure",remarks:["A figure is a figure is figure."],properties:{label:"Label used as header for the figure cards",url:"Image url",caption:"A reference to a caption node that describes the figure",attrib:"Figure attribution"}},r.example={id:"figure_1",label:"Figure 1",url:"http://example.com/fig1.png",caption:"caption_1"},r.Prototype=function(){this.hasCaption=function(){return!!this.properties.caption},this.getChildrenIds=function(){var e=[];return this.properties.caption&&e.push(this.properties.caption),e},this.getCaption=function(){return this.properties.caption?this.document.get(this.properties.caption):void 0},this.getHeader=function(){return this.properties.label}},r.Prototype.prototype=n.Composite.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.Node.defineProperties(r.prototype,Object.keys(r.type.properties)),t.exports=r},{"substance-document":162}],55:[function(e,t){"use strict";var n=e("underscore"),r=e("../composite").View,o=e("substance-application").$$,i=e("../../resource_view"),s=function(e,t,n){r.call(this,e,t),i.call(this,n)};s.Prototype=function(){n.extend(this,i.prototype),this.isZoomable=!0,this.renderBody=function(){if(this.node.url){var e=o(".image-wrapper",{children:[o("a",{href:this.node.url,target:"_blank",children:[o("img",{src:this.node.url})]})]});this.content.appendChild(e)}this.renderChildren(),this.node.attrib&&this.content.appendChild(o(".figure-attribution",{text:this.node.attrib}))},this.renderLabel=function(){var e=o("a.name.action-toggle-resource",{href:"#"});return this.renderAnnotatedText([this.node.id,"label"],e),e}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,t.exports=s},{"../../resource_view":118,"../composite":31,"substance-application":151,underscore:177}],56:[function(e,t){"use strict";t.exports={Model:e("./figure"),View:e("./figure_view")}},{"./figure":54,"./figure_view":55}],57:[function(e,t){var n=e("substance-document"),r=e("../annotation/annotation"),o=e("../resource_reference/resource_reference"),i=function(e,t){o.call(this,e,t)};i.type={id:"figure_reference",parent:"resource_reference",properties:{target:"figure"}},i.Prototype=function(){},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,i.prototype.constructor=i,i.fragmentation=r.NEVER,n.Node.defineProperties(i),t.exports=i},{"../annotation/annotation":8,"../resource_reference/resource_reference":96,"substance-document":162}],58:[function(e,t){t.exports={Model:e("./figure_reference.js"),View:e("../resource_reference/resource_reference_view.js")}},{"../resource_reference/resource_reference_view.js":97,"./figure_reference.js":57}],59:[function(e,t){"use strict";var n=e("substance-document"),r=n.Node,o=e("../paragraph").Model,i=function(e,t){o.call(this,e,t)};i.type={id:"footnote",parent:"paragraph",properties:{label:"string"}},i.description={name:"Footnote",remarks:["A Footnote is basically a Paragraph with a label."],properties:{label:"A string used as label"}},i.example={type:"footnote",id:"footnote_1",label:"a","children ":["text_1","image_1","text_2"]},i.Prototype=function(){},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,i.prototype.constructor=i,r.defineProperties(i),t.exports=i},{"../paragraph":89,"substance-document":162}],60:[function(e,t){"use strict";var n=e("../paragraph").View,r=function(e,t){n.call(this,e,t)};r.Prototype=function(){this.render=function(){n.prototype.render.call(this);var e=document.createElement("span");return e.classList.add("label"),e.innerHTML=this.node.label,this.el.insertBefore(e,this.content),this}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,t.exports=r},{"../paragraph":89}],61:[function(e,t){"use strict";t.exports={Model:e("./footnote"),View:e("./footnote_view")}},{"./footnote":59,"./footnote_view":60}],62:[function(e,t){var n=e("substance-document"),r=function(e){n.Node.call(this,e)};r.type={id:"formula",parent:"content",properties:{source_id:"string",inline:"boolean",label:"string",format:["array","string"],data:["array","string"]}},r.description={name:"Formula",remarks:["Can either be expressed in MathML format or using an image url"],properties:{label:"Formula label (4)",data:"Formula data, either MathML or image url",format:"Can either be `mathml` or `image`"}},r.example={type:"formula",id:"formula_eqn1",label:"(1)",content:"<mml:mrow>...</mml:mrow>",format:"mathml"},r.Prototype=function(){this.inline=!1},r.Prototype.prototype=n.Node.prototype,r.prototype=new r.Prototype,r.prototype.constuctor=r,n.Node.defineProperties(r),t.exports=r},{"substance-document":162}],63:[function(e,t){"use strict";var n=e("../node").View,r=function(e,t){n.call(this,e,t)};r.Prototype=function(){var e={latex:"math/tex",mathml:"math/mml"},t={image:0,mathml:1,latex:2};this.render=function(){this.node.inline&&this.$el.addClass("inline");var n,r=[];for(n=0;n<this.node.data.length;n++)r.push({format:this.node.format[n],data:this.node.data[n]});if(r.sort(function(e,n){return t[e.format]-t[n.format]}),r.length>0){var o=!1,i=!1;for(n=0;n<r.length;n++){var s=r[n].format,a=r[n].data;switch(s){case"mathml":i||(this.$el.append($(a)),i=!0,o&&(this.$preview.hide(),o=!0));break;case"latex":if(!i){var c=e[s];this.node.inline||(c+="; mode=display");var u=$("<script>").attr("type",c).html(a);this.$el.append(u),i=!0}break;case"image":if(!o){var l=$("<div>").addClass("MathJax_Preview");l.append($("<img>").attr("src",a)),this.$el.append(l),this.$preview=l,o=!0}break;default:console.error("Unknown formula format:",s)}}}return this.node.label&&this.$el.append($('<div class="label">').html(this.node.label)),this}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,t.exports=r},{"../node":86}],64:[function(e,t){"use strict";t.exports={Model:e("./formula"),View:e("./formula_view")}},{"./formula":62,"./formula_view":63}],65:[function(e,t){"use strict";var n=e("substance-document").Node,r=e("../text/text_node"),o=function(e,t){r.call(this,e,t)};o.type={id:"heading",parent:"content",properties:{source_id:"string",content:"string",label:"string",level:"number"}},o.example={type:"heading",id:"heading_1",content:"Introduction",level:1},o.description={name:"Heading",remarks:["Denotes a section or sub section in your article."],properties:{content:"Heading title",label:"Heading label",level:"Heading level. Ranges from 1..4"}},o.Prototype=function(){this.splitInto="paragraph",this.includeInToc=function(){return!0},this.getLevel=function(){return this.level}},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,n.defineProperties(o),t.exports=o},{"../text/text_node":108,"substance-document":162}],66:[function(e,t){"use strict";var n=e("../node").View,r=e("substance-application").$$,o=function(e,t){n.call(this,e,t),this.$el.addClass("level-"+this.node.level)};o.Prototype=function(){this.render=function(){n.prototype.render.call(this);var e=this.createTextPropertyView([this.node.id,"content"],{classes:"title"});if(this.node.label){var t=r(".label",{text:this.node.label});this.content.appendChild(t)}return this.content.appendChild(e.render().el),this},this.renderTocItem=function(){var e=r("div");if(this.node.label){var t=r(".label",{text:this.node.label});e.appendChild(t)}var n=r("span");return this.renderAnnotatedText([this.node.id,"content"],n),e.appendChild(n),e}},o.Prototype.prototype=n.prototype,o.prototype=new o.Prototype,t.exports=o},{"../node":86,"substance-application":151}],67:[function(e,t){"use strict";t.exports={Model:e("./heading"),View:e("./heading_view")}},{"./heading":65,"./heading_view":66}],68:[function(e,t){var n=(e("underscore"),e("substance-document")),r=function(e,t){n.Node.call(this,e,t)};r.type={id:"html_table",parent:"content",properties:{source_id:"string",label:"string",content:"string",footers:["array","string"],caption:"caption"}},r.config={zoomable:!0},r.description={name:"HTMLTable",remarks:["A table figure which is expressed in HTML notation"],properties:{source_id:"string",label:"Label shown in the resource header.",title:"Full table title",content:"HTML data",footers:"HTMLTable footers expressed as an array strings",caption:"References a caption node, that has all the content"}},r.example={id:"html_table_1",type:"html_table",label:"HTMLTable 1.",title:"Lorem ipsum table",content:"<table>...</table>",footers:[],caption:"caption_1"},r.Prototype=function(){this.getCaption=function(){return this.properties.caption?this.document.get(this.properties.caption):void 0},this.getHeader=function(){return this.properties.label}},r.Prototype.prototype=n.Node.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.Node.defineProperties(r),t.exports=r},{"substance-document":162,underscore:177}],69:[function(e,t){"use strict";var n=e("underscore"),r=e("../node").View,o=e("substance-application").$$,i=e("../../resource_view"),s=function(e,t,n){r.call(this,e,t),i.call(this,n)};s.Prototype=function(){n.extend(this,i.prototype),this.isZoomable=!0,this.renderBody=function(){var e=o(".table-wrapper",{html:this.node.content});this.content.appendChild(e);var t=o(".footers",{children:n.map(this.node.footers,function(e){return o(".footer",{html:"<b>"+e.label+"</b> "+e.content})})});if(this.node.caption){var r=this.createView(this.node.caption);this.content.appendChild(r.render().el)}this.content.appendChild(t)}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,t.exports=s},{"../../resource_view":118,"../node":86,"substance-application":151,underscore:177}],70:[function(e,t){"use strict";t.exports={Model:e("./html_table"),View:e("./html_table_view")}},{"./html_table":68,"./html_table_view":69}],71:[function(e,t){"use strict";var n=(e("substance-document").Node,e("../web_resource").Model),r=function(e,t){n.call(this,e,t)};r.type={id:"image",parent:"webresource",properties:{source_id:"string"}},r.example={type:"image",id:"image_1",url:"http://substance.io/image_1.png"},r.description={name:"Image",remarks:["Represents a web-resource for an image."],properties:{}},r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,t.exports=r},{"../web_resource":116,"substance-document":162}],72:[function(e,t){"use strict";var n=e("../node").View,r=function(e,t){n.call(this,e,t)};r.Prototype=function(){var e=Array.prototype.indexOf;this.render=function(){var t=document.createElement("div");t.className="content";var n=document.createElement("div");n.className="image-char",this._imgChar=n;var r=document.createElement("img");return r.src=this.node.url,r.alt="alt text",r.title="alt text",n.appendChild(r),t.appendChild(n),this.el.appendChild(t),this._imgPos=e.call(n.childNodes,r),this},this["delete"]=function(e,t){for(var n=this.$(".content")[0],r=n.childNodes,o=t-1;o>=0;o--)n.removeChild(r[e+o])},this.getCharPosition=function(e,t){return e===this._imgChar?t>this._imgPos?1:0:void console.log("Errhhh..")},this.getDOMPosition=function(e){var t=this.$(".content")[0],n=document.createRange();return 0===e?n.setStartBefore(t.childNodes[0]):n.setStartAfter(t.childNodes[0]),n}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,t.exports=r},{"../node":86}],73:[function(e,t){"use strict";t.exports={Model:e("./image"),View:e("./image_view")}},{"./image":71,"./image_view":72}],74:[function(e,t){"use strict";t.exports={node:e("./node"),composite:e("./composite"),annotation:e("./annotation"),emphasis:e("./emphasis"),strong:e("./strong"),subscript:e("./subscript"),superscript:e("./superscript"),underline:e("./underline"),code:e("./code"),author_callout:e("./author_callout"),custom_annotation:e("./custom_annotation"),"inline-formula":e("./inline_formula"),resource_reference:e("./resource_reference"),contributor_reference:e("./contributor_reference"),figure_reference:e("./figure_reference"),citation_reference:e("./citation_reference"),definition_reference:e("./definition_reference"),cross_reference:e("./cross_reference"),publication_info:e("./publication_info"),link:e("./link"),inline_image:e("./inline_image"),document:e("./document"),text:e("./text"),paragraph:e("./paragraph"),heading:e("./heading"),box:e("./box"),cover:e("./cover"),figure:e("./figure"),caption:e("./caption"),image:e("./image"),webresource:e("./web_resource"),html_table:e("./html_table"),supplement:e("./supplement"),video:e("./video"),contributor:e("./contributor"),definition:e("./definition"),citation:e("./citation"),formula:e("./formula"),list:e("./list"),codeblock:e("./codeblock"),affiliation:e("./_affiliation"),footnote:e("./footnote")}},{"./_affiliation":7,"./annotation":10,"./author_callout":13,"./box":16,"./caption":19,"./citation":22,"./citation_reference":24,"./code":26,"./codeblock":29,"./composite":31,"./contributor":34,"./contributor_reference":36,"./cover":39,"./cross_reference":41,"./custom_annotation":44,"./definition":47,"./definition_reference":49,"./document":51,"./emphasis":53,"./figure":56,"./figure_reference":58,"./footnote":61,"./formula":64,"./heading":67,"./html_table":70,"./image":73,"./inline_formula":75,"./inline_image":78,"./link":80,"./list":83,"./node":86,"./paragraph":89,"./publication_info":92,"./resource_reference":95,"./strong":98,"./subscript":100,"./superscript":102,"./supplement":104,"./text":107,"./underline":111,"./video":113,"./web_resource":116}],75:[function(e,t){t.exports={Model:e("./inline_formula.js"),View:e("./inline_formula_view.js")}
},{"./inline_formula.js":76,"./inline_formula_view.js":77}],76:[function(e,t){var n=e("substance-document"),r=e("../annotation/annotation"),o=function(e,t){r.call(this,e,t)};o.type={id:"inline-formula",parent:"annotation",properties:{target:"formula"}},o.Prototype=function(){},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,o.fragmentation=r.NEVER,n.Node.defineProperties(o),t.exports=o},{"../annotation/annotation":8,"substance-document":162}],77:[function(e,t){"use strict";var n=e("../resource_reference").View,r=function(e,t){n.call(this,e,t),$(this.el).removeClass("resource-reference")};r.Prototype=function(){this.createElement=function(){var e=document.createElement("span");return e},this.render=function(){var e=this.node.document.get(this.node.target),t=this.viewFactory.createView(e);return this.el.innerHTML=t.render().el.innerHTML,this}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,t.exports=r},{"../resource_reference":95}],78:[function(e,t){t.exports={Model:e("./inline_image.js"),View:e("../annotation/annotation_view.js")}},{"../annotation/annotation_view.js":9,"./inline_image.js":79}],79:[function(e,t){var n=e("substance-document"),r=e("../annotation/annotation"),o=function(e,t){r.call(this,e,t)};o.type={id:"inline-image",parent:"annotation",properties:{target:"image"}},o.Prototype=function(){},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,o.fragmentation=r.NEVER,n.Node.defineProperties(o),t.exports=o},{"../annotation/annotation":8,"substance-document":162}],80:[function(e,t){t.exports={Model:e("./link.js"),View:e("./link_view.js")}},{"./link.js":81,"./link_view.js":82}],81:[function(e,t){var n=e("substance-document"),r=e("../annotation/annotation"),o=function(e,t){r.call(this,e,t)};o.type={id:"link",parent:"annotation",properties:{url:"string"}},o.Prototype=function(){},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,o.fragmentation=r.NEVER,n.Node.defineProperties(o),t.exports=o},{"../annotation/annotation":8,"substance-document":162}],82:[function(e,t){var n=e("../annotation").View,r=function(e){n.call(this,e)};r.Prototype=function(){this.createElement=function(){var e=document.createElement("a");return e.setAttribute("href",this.node.url),e},this.setClasses=function(){this.$el.addClass("link")}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,t.exports=r},{"../annotation":10}],83:[function(e,t){"use strict";t.exports={Model:e("./list"),View:e("./list_view")}},{"./list":84,"./list_view":85}],84:[function(e,t){"use strict";var n=e("underscore"),r=e("substance-document"),o=r.Node,i=r.Composite,s=function(e,t){i.call(this,e,t)};s.type={id:"list",parent:"content",properties:{source_id:"string",items:["array","paragraph"],ordered:"boolean"}},s.description={name:"List",remarks:["Lists can either be numbered or bullet lists"],properties:{ordered:"Specifies wheter the list is ordered or not",items:"An array of paragraph references"}},s.example={type:"list",id:"list_1","items ":["paragraph_listitem_1","paragraph_listitem_2"]},s.Prototype=function(){this.getLength=function(){return this.properties.items.length},this.getChildrenIds=function(){return n.clone(this.items)},this.getItems=function(){return n.map(this.properties.items,function(e){return this.document.get(e)},this)},this.getChangePosition=function(e){if("items"===e.path[1])if("update"===e.type){var t=e.diff;if(t.isInsert())return e.diff.pos+1;if(t.isDelete())return e.diff.pos;if(t.isMove())return e.diff.target}else if("set"===e.type)return this.properties.items.length-1;return-1},this.isMutable=function(){return!0},this.insertChild=function(e,t,n){e.update([this.id,"items"],["+",t,n])},this.deleteChild=function(e,t){var n=this.items.indexOf(t);e.update([this.id,"items"],["-",n,t]),e["delete"](t)},this.canJoin=function(e){return"list"===e.type},this.isBreakable=function(){return!0},this["break"]=function(e,t,n){var r=this.properties.items.indexOf(t);if(0>r)throw new Error("Unknown child "+t);var o=e.get(t),i=o["break"](e,n);return e.update([this.id,"items"],["+",r+1,i.id]),i}},s.Prototype.prototype=i.prototype,s.prototype=new s.Prototype,s.prototype.constructor=s,o.defineProperties(s.prototype,["items","ordered"]),t.exports=s},{"substance-document":162,underscore:177}],85:[function(e,t){"use strict";var n=e("../composite/composite_view"),r=e("./list"),o=function(e,t){n.call(this,e,t)};o.whoami="SubstanceListView",o.Prototype=function(){this.render=function(){this.el.innerHTML="";var e=this.node.ordered?"OL":"UL";this.content=document.createElement(e),this.content.classList.add("content");var t;for(t=0;t<this.childrenViews.length;t++)this.childrenViews[t].dispose();var n=this.node.getNodes();for(t=0;t<n.length;t++){var o,i=this.node.document.get(n[t]),s=this.viewFactory.createView(i);i instanceof r?o=s.render().el:(o=document.createElement("LI"),o.appendChild(s.render().el)),this.content.appendChild(o),this.childrenViews.push(s)}return this.el.appendChild(this.content),this},this.onNodeUpdate=function(e){e.path[0]===this.node.id&&"items"===e.path[1]&&this.render()}},o.Prototype.prototype=n.prototype,o.prototype=new o.Prototype,t.exports=o},{"../composite/composite_view":30,"./list":84}],86:[function(e,t){"use strict";t.exports={Model:e("./node"),View:e("./node_view")}},{"./node":87,"./node_view":88}],87:[function(e,t){"use strict";var n=e("substance-document"),r=n.Node;r.description={name:"Node",remarks:["Abstract node type."],properties:{source_id:"Useful for document conversion where the original id of an element should be remembered."}},t.exports=r},{"substance-document":162}],88:[function(e,t){"use strict";var n=e("substance-application").View,r=e("../text/text_property_view"),o=function(e,t,r){if(n.call(this,r),this.node=e,this.viewFactory=t,!t)throw new Error('Illegal argument. Argument "viewFactory" is mandatory.');this.$el.addClass("content-node").addClass(e.type.replace("_","-")),this.el.dataset.id=this.node.id};o.Prototype=function(){this.render=function(){return this.content=document.createElement("DIV"),this.content.classList.add("content"),this.focusHandle=document.createElement("DIV"),this.focusHandle.classList.add("focus-handle"),this.el.appendChild(this.content),this.el.appendChild(this.focusHandle),this},this.dispose=function(){this.stopListening()},this.createView=function(e){var t=this.node.document.get(e),n=this.viewFactory.createView(t);return n},this.createTextView=function(e){console.error("FIXME: NodeView.createTextView() is deprecated. Use NodeView.createTextPropertyView() instead.");var t=this.viewFactory.createView(this.node,e,"text");return t},this.createTextPropertyView=function(e,t){var n=new r(this.node.document,e,this.viewFactory,t);return n},this.renderAnnotatedText=function(e,t){var n=this.node.document.resolve(e),o=r.renderAnnotatedText(this.node.document,n,t,this.viewFactory);return o}},o.Prototype.prototype=n.prototype,o.prototype=new o.Prototype,t.exports=o},{"../text/text_property_view":109,"substance-application":151}],89:[function(e,t){"use strict";t.exports={Model:e("./paragraph"),View:e("./paragraph_view")}},{"./paragraph":90,"./paragraph_view":91}],90:[function(e,t){"use strict";var n=e("underscore"),r=e("substance-document"),o=r.Node,i=r.Composite,s=function(e,t){i.call(this,e,t)};s.type={id:"paragraph",parent:"content",properties:{children:["array","content"]}},s.description={name:"Paragraph",remarks:["A Paragraph can have inline elements such as images."],properties:{children:"An array of content node references"}},s.example={type:"paragraph",id:"paragraph_1","children ":["text_1","image_1","text_2"]},s.Prototype=function(){this.getLength=function(){return this.properties.children.length},this.getChildrenIds=function(){return n.clone(this.properties.children)},this.getChildren=function(){return n.map(this.properties.children,function(e){return this.document.get(e)},this)}},s.Prototype.prototype=i.prototype,s.prototype=new s.Prototype,s.prototype.constructor=s,o.defineProperties(s.prototype,["children"]),t.exports=s},{"substance-document":162,underscore:177}],91:[function(e,t){"use strict";var n=e("../composite/composite_view"),r=function(e,t){n.call(this,e,t)};r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,t.exports=r},{"../composite/composite_view":30}],92:[function(e,t){"use strict";t.exports={Model:e("./publication_info"),View:e("./publication_info_view")}},{"./publication_info":93,"./publication_info_view":94}],93:[function(e,t){"use strict";var n=e("substance-document"),r=function(e,t){n.Node.call(this,e,t)};r.type={id:"publication_info",parent:"content",properties:{history:["array","object"],published_on:"string",journal:"string",provider:"string",article_type:"string",keywords:["array","string"],research_organisms:["array","string"],subjects:["array","string"],links:["array","objects"],doi:"string",related_article:"string",article_info:"paragraph"}},r.description={name:"PublicationInfo",description:"PublicationInfo Node",remarks:["Summarizes the article's meta information. Meant to be customized by publishers"],properties:{received_on:"Submission received",accepted_on:"Paper accepted on",published_on:"Paper published on",history:"History of the submission cycle",journal:"The Journal",provider:"Who is hosting this article",article_type:"Research Article vs. Insight, vs. Correction etc.",keywords:"Article's keywords",research_organisms:"Research Organisms",subjects:"Article Subjects",doi:"Article DOI",related_article:"DOI of related article if there is any"}},r.example={id:"publication_info",published_on:"2012-11-13",history:[{type:"received",date:"2012-06-20"},{type:"accepted",date:"2012-09-05"}],journal:"eLife",provider:"eLife",article_type:"Research Article",keywords:["innate immunity","histones","lipid droplet","anti-bacterial"],research_organisms:["B. subtilis","D. melanogaster","E. coli","Mouse"],subjects:["Immunology","Microbiology and infectious disease"],doi:"http://dx.doi.org/10.7554/eLife.00003"},r.Prototype=function(){this.getArticleInfo=function(){return this.document.get("articleinfo")}},r.Prototype.prototype=n.Node.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.Node.defineProperties(r),t.exports=r},{"substance-document":162}],94:[function(e,t){"use strict";var n=e("../node").View,r=e("substance-application").$$,o=e("../../article_util"),i={received:"received",accepted:"accepted",revised:"revised",corrected:"corrected","rev-recd":"revised","rev-request":"returned for modification",published:"published","default":"updated"},s=function(e,t){n.call(this,e,t)};s.Prototype=function(){this.render=function(){n.prototype.render.call(this);var e=r(".meta-data");if(this.node.article_type){var t=r(".article-type.container",{children:[r("div.label",{text:"Article Type"}),r("div.value",{text:this.node.article_type})]});e.appendChild(t)}if(this.node.subjects&&this.node.subjects.length>0){var o=r(".subject.container",{children:[r("div.label",{text:"Subject"}),r("div.value",{text:this.node.subjects.join(", ")})]});e.appendChild(o)}if(this.node.research_organisms&&this.node.research_organisms.length>0){var i=r(".subject.container",{children:[r("div.label",{text:"Organism"}),r("div.value",{text:this.node.research_organisms.join(", ")})]});e.appendChild(i)}if(this.node.keywords&&this.node.keywords.length>0){var s=r(".keywords.container",{children:[r("div.label",{text:"Keywords"}),r("div.value",{text:this.node.keywords.join(", ")})]});e.appendChild(s)}if(this.node.doi){var a=r(".doi.container",{children:[r("div.label",{text:"DOI"}),r("div.value",{children:[r("a",{href:"http://dx.doi.org/"+this.node.doi,text:this.node.doi,target:"_blank"})]})]});e.appendChild(a)}if(this.node.related_article){var c=r(".related-article.container",{children:[r("div.label",{text:"Related Article"}),r("div.value",{children:[r("a",{href:this.node.related_article,text:this.node.related_article})]})]});e.appendChild(c)}var u=this.describePublicationHistory();e.appendChild(u),this.content.appendChild(e);var l=this.node.getArticleInfo(),p=this.viewFactory.createView(l),h=p.render().el;return this.content.appendChild(h),this},this.describePublicationHistory=function(){var e,t=r(".dates"),n=[];if(this.node.history&&this.node.history.length>0&&(n=n.concat(this.node.history)),this.node.published_on&&n.push({type:"published",date:this.node.published_on}),n.length>0){for(t.appendChild(document.createTextNode("The article was ")),e=0;e<n.length;e++){e>0&&(t.appendChild(document.createTextNode(", ")),e===n.length-1&&t.appendChild(document.createTextNode("and ")));var s=n[e];t.appendChild(document.createTextNode((i[s.type]||i["default"])+" on ")),t.appendChild(r("b",{text:o.formatDate(s.date)}))}t.appendChild(document.createTextNode("."))}return t},this.dispose=function(){n.prototype.dispose.call(this)}},s.Prototype.prototype=n.prototype,s.prototype=new s.Prototype,t.exports=s},{"../../article_util":4,"../node":86,"substance-application":151}],95:[function(e,t){t.exports={Model:e("./resource_reference.js"),View:e("./resource_reference_view.js")}},{"./resource_reference.js":96,"./resource_reference_view.js":97}],96:[function(e,t){var n=e("substance-document"),r=e("../annotation/annotation"),o=function(e,t){r.call(this,e,t)};o.type={id:"resource_reference",parent:"annotation",properties:{target:"node"}},o.Prototype=function(){},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,o.fragmentation=r.NEVER,n.Node.defineProperties(o),t.exports=o},{"../annotation/annotation":8,"substance-document":162}],97:[function(e,t){"use strict";var n=e("../annotation/annotation_view"),r=function(e,t){n.call(this,e,t),this.$el.addClass("resource-reference")};r.Prototype=function(){this.createElement=function(){var e=document.createElement("a");return e.setAttribute("href",""),e}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,t.exports=r},{"../annotation/annotation_view":9}],98:[function(e,t){t.exports={Model:e("./strong.js"),View:e("../annotation/annotation_view.js")}},{"../annotation/annotation_view.js":9,"./strong.js":99}],99:[function(e,t){var n=e("../annotation/annotation"),r=function(e,t){n.call(this,e,t)};r.type={id:"strong",parent:"annotation",properties:{}},r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,r.fragmentation=n.DONT_CARE,t.exports=r},{"../annotation/annotation":8}],100:[function(e,t){t.exports={Model:e("./subscript.js"),View:e("../annotation/annotation_view.js")}},{"../annotation/annotation_view.js":9,"./subscript.js":101}],101:[function(e,t){var n=e("../annotation/annotation"),r=function(e,t){n.call(this,e,t)};r.type={id:"subscript",parent:"annotation",properties:{}},r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,r.fragmentation=n.DONT_CARE,t.exports=r},{"../annotation/annotation":8}],102:[function(e,t){t.exports={Model:e("./superscript.js"),View:e("../annotation/annotation_view.js")}},{"../annotation/annotation_view.js":9,"./superscript.js":103}],103:[function(e,t){var n=e("../annotation/annotation"),r=function(e,t){n.call(this,e,t)};r.type={id:"superscript",parent:"annotation",properties:{}},r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,r.fragmentation=n.DONT_CARE,t.exports=r},{"../annotation/annotation":8}],104:[function(e,t){"use strict";t.exports={Model:e("./supplement"),View:e("./supplement_view")}},{"./supplement":105,"./supplement_view":106}],105:[function(e,t){var n=(e("underscore"),e("substance-document")),r=function(e,t){n.Composite.call(this,e,t)};r.type={id:"supplement",parent:"content",properties:{source_id:"string",label:"string",url:"string",caption:"caption"}},r.description={name:"Supplement",remarks:["A Supplement entity."],properties:{source_id:"Supplement id as it occurs in the source NLM file",label:"Supplement label",caption:"References a caption node, that has all the content",url:"URL of downloadable file"}},r.example={id:"supplement_1",source_id:"SD1-data",type:"supplement",label:"Supplementary file 1.",url:"http://myserver.com/myfile.pdf",caption:"caption_supplement_1"},r.Prototype=function(){this.getChildrenIds=function(){var e=[];return this.properties.caption&&e.push(this.properties.caption),e},this.getCaption=function(){return this.properties.caption?this.document.get(this.properties.caption):null},this.getHeader=function(){return this.properties.label}},r.Prototype.prototype=n.Composite.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.Node.defineProperties(r),t.exports=r},{"substance-document":162,underscore:177}],106:[function(e,t){"use strict";var n=e("underscore"),r=e("../composite").View,o=e("substance-application").$$,i=e("../../resource_view"),s=function(e,t,n){r.call(this,e,t),i.call(this,n)};s.Prototype=function(){n.extend(this,i.prototype),this.renderBody=function(){this.renderChildren();var e=o("div.file",{children:[o("a",{href:this.node.url,html:'<i class="fa fa-download"/> Download'})]});this.content.appendChild(e)}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,s.prototype.constructor=s,t.exports=s},{"../../resource_view":118,"../composite":31,"substance-application":151,underscore:177}],107:[function(e,t){"use strict";t.exports={Model:e("./text_node"),View:e("./text_view")}},{"./text_node":108,"./text_view":110}],108:[function(e,t){"use strict";var n=e("substance-document");t.exports=n.TextNode},{"substance-document":162}],109:[function(e,t){"use strict";var n=e("substance-util"),r=n.Fragmenter,o=e("substance-application").View,i=function(e,t,n,r){r=r||{},r.elementType=r.elementType||"span",o.call(this,r),this.path=t,this.document=e,this.viewFactory=n,this.options=r||{},this.property=e.resolve(this.path),this.$el.addClass("text"),this.options.classes&&this.$el.addClass(this.options.classes)};i.Prototype=function(){this.render=function(){return this.el.innerHTML="",i.renderAnnotatedText(this.document,this.property,this.el,this.viewFactory),this},this.dispose=function(){this.stopListening()},this.renderWithAnnotations=function(e){var t=this,n=this.property.get(),o=document.createDocumentFragment(),i=this.document,s=[],a=new r;a.onText=function(e,t){e.appendChild(document.createTextNode(t))},a.onEnter=function(e,n){var r=i.get(e.id),o=t.viewFactory.createView(r);return n.appendChild(o.el),s.push(o),o.el},a.start(o,n,e);for(var c=0;c<s.length;c++)s[c].render();this.el.innerHTML="",this.el.appendChild(o)}},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,i.renderAnnotatedText=function(e,t,n,o){var i=window.document.createDocumentFragment(),s=t.get(),a=e.getIndex("annotations").get(t.path),c=[],u=new r;u.onText=function(e,t){e.appendChild(window.document.createTextNode(t))},u.onEnter=function(t,n){var r=e.get(t.id),i=o.createView(r);return n.appendChild(i.el),c.push(i),i.el},u.start(i,s,a);for(var l=0;l<c.length;l++)c[l].render();n.appendChild(i)},t.exports=i},{"substance-application":151,"substance-util":169}],110:[function(e,t){"use strict";var n=e("substance-util"),r=n.Fragmenter,o=e("../node/node_view"),i=e("substance-application").$$,s=function(e,t,n){o.call(this,e,t),n=this.options=n||{},this.path=n.path||[e.id,"content"],this.property=e.document.resolve(this.path),this.$el.addClass("text"),n.classes&&this.$el.addClass(n.classes),n.path&&this.$el.removeClass("content-node"),this._annotations={}};s.Prototype=function(){this.render=function(){return o.prototype.render.call(this),this.renderContent(),this},this.dispose=function(){o.prototype.dispose.call(this)},this.renderContent=function(){this.content.innerHTML="",this._annotations=this.node.document.getIndex("annotations").get(this.path),this.renderWithAnnotations(this._annotations)},this.createAnnotationElement=function(e){if(this.options.createAnnotationElement)return this.options.createAnnotationElement.call(this,e);var t;return t="link"===e.type?i("a.annotation."+e.type,{id:e.id,href:this.node.document.get(e.id).url}):i("span.annotation."+e.type,{id:e.id})},this.renderWithAnnotations=function(e){var t=this,n=this.property.get(),o=document.createDocumentFragment(),i=this.node.document,s=[],a=new r;a.onText=function(e,t){e.appendChild(document.createTextNode(t))},a.onEnter=function(e,n){var r=i.get(e.id),o=t.viewFactory.createView(r);return n.appendChild(o.el),s.push(o),o.el},a.start(o,n,e);for(var c=0;c<s.length;c++)s[c].render();this.content.innerHTML="",this.content.appendChild(o)}},s.Prototype.prototype=o.prototype,s.prototype=new s.Prototype,t.exports=s},{"../node/node_view":88,"substance-application":151,"substance-util":169}],111:[function(e,t){t.exports={Model:e("./underline.js"),View:e("../annotation/annotation_view.js")}},{"../annotation/annotation_view.js":9,"./underline.js":112}],112:[function(e,t){var n=e("../annotation/annotation"),r=function(e,t){n.call(this,e,t)};r.type={id:"underline",parent:"annotation",properties:{}},r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,r.fragmentation=n.DONT_CARE,t.exports=r},{"../annotation/annotation":8}],113:[function(e,t){"use strict";t.exports={Model:e("./video"),View:e("./video_view")}},{"./video":114,"./video_view":115}],114:[function(e,t){var n=e("substance-document"),r=function(e,t){n.Node.call(this,e,t)};r.type={id:"video",parent:"content",properties:{source_id:"string",label:"string",url:"string",url_webm:"string",url_ogv:"string",caption:"caption",poster:"string"}},r.config={zoomable:!0},r.description={name:"Video",remarks:["A video type intended to refer to video resources.","MP4, WebM and OGV formats are supported."],properties:{label:"Label shown in the resource header.",url:"URL to mp4 version of the video.",url_webm:"URL to WebM version of the video.",url_ogv:"URL to OGV version of the video.",poster:"Video poster image.",caption:"References a caption node, that has all the content"}},r.example={id:"video_1",type:"video",label:"Video 1.",url:"http://cdn.elifesciences.org/video/eLifeLensIntro2.mp4",url_webm:"http://cdn.elifesciences.org/video/eLifeLensIntro2.webm",url_ogv:"http://cdn.elifesciences.org/video/eLifeLensIntro2.ogv",poster:"http://cdn.elifesciences.org/video/eLifeLensIntro2.png",caption:"caption_25"},r.Prototype=function(){this.getHeader=function(){return this.properties.label},this.getCaption=function(){return this.properties.caption?this.document.get(this.properties.caption):""}},r.Prototype.prototype=n.Node.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.Node.defineProperties(r),t.exports=r},{"substance-document":162}],115:[function(e,t){"use strict";var n=e("underscore"),r=e("substance-application").$$,o=e("../node").View,i=e("../../resource_view"),s=function(e,t,n){o.call(this,e,t),i.call(this,n)};s.Prototype=function(){n.extend(this,i.prototype),this.isZoomable=!0,this.renderBody=function(){var e=this.node,t=[r("source",{src:e.url,type:"video/mp4; codecs=&quot;avc1.42E01E, mp4a.40.2&quot;"})];e.url_ogv&&t.push(r("source",{src:e.url_ogv,type:"video/ogg; codecs=&quot;theora, vorbis&quot;"})),e.url_webm&&t.push(r("source",{src:e.url_webm,type:"video/webm; codecs=&quot;vp8, vorbis%quot;"}));var n=r(".video-wrapper",{children:[r("video",{controls:"controls",poster:e.poster,preload:"none",children:t})]});if(this.content.appendChild(n),e.title&&this.content.appendChild(r(".title",{text:e.title})),this.node.caption){var o=this.createView(this.node.caption);this.content.appendChild(o.render().el),this.captionView=o}e.doi&&this.content.appendChild(r(".doi",{children:[r("b",{text:"DOI: "}),r("a",{href:e.doi,target:"_new",text:e.doi})]}))}},s.Prototype.prototype=o.prototype,s.prototype=new s.Prototype,t.exports=s},{"../../resource_view":118,"../node":86,"substance-application":151,underscore:177}],116:[function(e,t){"use strict";t.exports={Model:e("./web_resource"),View:e("../node").View}},{"../node":86,"./web_resource":117}],117:[function(e,t){"use strict";var n=e("substance-document").Node,r=function(e,t){n.call(this,e,t)};r.type={id:"webresource",parent:"content",properties:{source_id:"string",url:"string"}},r.description={name:"WebResource",description:"A resource which can be accessed via URL",remarks:["This element is a parent for several other nodes such as Image."],properties:{url:"URL to a resource"}},r.example={type:"webresource",id:"webresource_3",url:"http://elife.elifesciences.org/content/elife/1/e00311/F3.medium.gif"},r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.defineProperties(r.prototype,["url"]),t.exports=r},{"substance-document":162}],118:[function(e,t){"use strict";var n=e("underscore"),r=e("./nodes/node").View,o=e("substance-application").$$,i={header:!1,zoom:!1},s=function(e){this.options=n.extend({},i,e)};s.Prototype=function(){this.isResourceView=!0,this.render=function(){return r.prototype.render.call(this),this.renderHeader(),this.renderBody(),this},this.renderHeader=function(){this.node;if(this.options.header){var e=o(".resource-header");e.appendChild(this.renderLabel()),this.options.zoom&&e.appendChild(o("a.toggle-fullscreen",{href:"#",html:'<i class="fa fa-expand"></i><i class="fa fa-compress"></i>'})),e.appendChild(o("a.toggle-res.action-toggle-resource",{href:"#",html:'<i class="fa fa-eye"></i><i class="fa fa-eye-slash"></i>'})),this.headerEl=e,this.el.insertBefore(e,this.content)}},this.renderLabel=function(){var e=o("a.name.action-toggle-resource",{href:"#",html:this.getHeader()});return e},this.renderBody=function(){},this.getHeader=function(){return this.node.getHeader()}},s.prototype=new s.Prototype,t.exports=s},{"./nodes/node":86,"substance-application":151,underscore:177}],119:[function(e,t){var n=function(e,t){this.nodeTypes=e,this.options=t||{}};n.Prototype=function(){this.getNodeViewClass=function(e,t){t=t||e.type;var n=this.nodeTypes[t];if(!n)throw new Error("No node registered for type "+t+".");var r=n.View;if(!r)throw new Error('No view registered for type "'+e.type+'".');return r},this.createView=function(e,t,n){var r=this.getNodeViewClass(e,n),o=new r(e,this,t);return o}},n.prototype=new n.Prototype,t.exports=n},{}],120:[function(e,t){"use strict";var n=e("substance-util"),r=e("underscore"),o=e("lens-converter"),i=function(e){o.call(this,e)};i.Prototype=function(){var e=o.prototype;this.test=function(e){var t=e.querySelector("publisher-name").textContent;return"eLife Sciences Publications, Ltd"===t},this.__ignoreCustomMetaNames=["elife-xml-version"],this.enhanceArticle=function(e,t){var r,o,i=[],s=e.doc,a=t.querySelector("#SA1");a&&(r={id:e.nextId("heading"),type:"heading",level:1,content:"Article Commentary"},s.create(r),i.push(r),r={id:e.nextId("heading"),type:"heading",level:2,content:"Decision letter"},s.create(r),i.push(r),o=a.querySelector("body"),i=i.concat(this.bodyNodes(e,n.dom.getChildren(o))));var c=t.querySelector("#SA2");c&&(r={id:e.nextId("heading"),type:"heading",level:2,content:"Author response"},s.create(r),i.push(r),o=c.querySelector("body"),i=i.concat(this.bodyNodes(e,n.dom.getChildren(o)))),i.length>0&&this.show(e,i)},this.enhanceCover=function(e,t,n){var r,o=n.querySelector("subj-group[subj-group-type=display-channel] subject").textContent;try{r=n.querySelector("subj-group[subj-group-type=heading] subject").textContent}catch(i){r=null}t.breadcrumbs=[{name:"eLife",url:"http://elifesciences.org/",image:"http://lens.elifesciences.org/lens-elife/styles/elife.png"},{name:o,url:"http://elifesciences.org/category/"+o.replace(/ /g,"-").toLowerCase()}],r&&t.breadcrumbs.push({name:r,url:"http://elifesciences.org/category/"+r.replace(/ /g,"-").toLowerCase()})},this.enhanceFigure=function(e,t,n){var r=n.querySelector("graphic"),o=r.getAttribute("xlink:href");t.url=this.resolveURL(e,o)},this.enhanceVideo=function(e,t,n){var r=n.getAttribute("xlink:href").split("."),o=r[0];t.url="http://static.movie-usa.glencoesoftware.com/mp4/10.7554/"+o+".mp4",t.url_ogv="http://static.movie-usa.glencoesoftware.com/ogv/10.7554/"+o+".ogv",t.url_webm="http://static.movie-usa.glencoesoftware.com/webm/10.7554/"+o+".webm",t.poster="http://static.movie-usa.glencoesoftware.com/jpg/10.7554/"+o+".jpg"},this.resolveURL=function(e,t){if(t.match(/http:\/\//))return t;var n=this.getBaseURL(e);return n?[n,t].join(""):["http://cdn.elifesciences.org/elife-articles/",e.doc.id,"/jpg/",t,".jpg"].join("")},this.enhanceSupplement=function(e,t){var n=this.getBaseURL(e);return n?[n,t.url].join(""):void(t.url=["http://cdn.elifesciences.org/elife-articles/",e.doc.id,"/suppl/",t.url].join(""))},this.enhancePublicationInfo=function(e){var t=e.xmlDoc.querySelector("article"),n=t.querySelector("article-meta"),o=e.doc.get("publication_info"),i=n.querySelectorAll("kwd-group[kwd-group-type=research-organism] kwd"),s=n.querySelectorAll("kwd-group[kwd-group-type=author-keywords] kwd"),a=n.querySelectorAll("subj-group[subj-group-type=heading] subject"),c=n.querySelector("subj-group[subj-group-type=display-channel] subject"),u=t.querySelector("self-uri[content-type=pdf]"),l=["http://cdn.elifesciences.org/elife-articles/",e.doc.id,"/pdf/",u?u.getAttribute("xlink:href"):"#"].join(""),p=[];l&&p.push({url:l,name:"PDF",type:"pdf"}),p.push({url:"https://s3.amazonaws.com/elife-cdn/elife-articles/"+e.doc.id+"/elife"+e.doc.id+".xml",name:"Source XML",type:"xml"}),p.push({url:"",name:"Lens JSON",type:"json"}),o.research_organisms=r.pluck(i,"textContent"),o.keywords=r.pluck(s,"textContent"),o.subjects=r.pluck(a,"textContent"),o.article_type=c?c.textContent:"",o.links=p,o.related_article&&(o.related_article="http://dx.doi.org/"+o.related_article)},this.enhanceSupplement=function(e,t){var n=this.getBaseURL(e);return n?[n,t.url].join(""):void(t.url=["http://cdn.elifesciences.org/elife-articles/",e.doc.id,"/suppl/",t.url].join(""))},this.enhanceVideo=function(e,t,n){var r=n.getAttribute("xlink:href").split("."),o=r[0];t.url="http://static.movie-usa.glencoesoftware.com/mp4/10.7554/"+o+".mp4",t.url_ogv="http://static.movie-usa.glencoesoftware.com/ogv/10.7554/"+o+".ogv",t.url_webm="http://static.movie-usa.glencoesoftware.com/webm/10.7554/"+o+".webm",t.poster="http://static.movie-usa.glencoesoftware.com/jpg/10.7554/"+o+".jpg"},this.resolveURL=function(e,t){if(t.match(/http:\/\//))return t;var n=this.getBaseURL(e);return n?[n,t].join(""):["http://cdn.elifesciences.org/elife-articles/",e.doc.id,"/jpg/",t,".jpg"].join("")};var t=/author-callout-style/;this.enhanceAnnotationData=function(e,n,r,o){if("named-content"===o){var i=r.getAttribute("content-type");t.test(i)&&(n.type="author_callout",n.style=i)}},this.showNode=function(t,n){switch(n.type){case"box":n.label&&t.doc.show("figures",n.id);break;default:e.showNode.apply(this,arguments)}}},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,i.prototype.constructor=i,t.exports=i},{"lens-converter":121,"substance-util":169,underscore:177}],121:[function(e,t){"use strict";var n=e("./lens_converter");t.exports=n},{"./lens_converter":122}],122:[function(e,t){"use strict";var n=e("underscore"),r=e("substance-util"),o=r.errors,i=o.define("ImporterError"),s=function(e){this.options=e||s.DefaultOptions};s.Prototype=function(){this._annotationTypes={bold:"strong",italic:"emphasis",monospace:"code",sub:"subscript",sup:"superscript",sc:"custom_annotation",underline:"underline","ext-link":"link",xref:"",email:"link","named-content":"","inline-formula":"inline-formula",uri:"link"},this._refTypeMapping={bibr:"citation_reference",fig:"figure_reference",table:"figure_reference","supplementary-material":"figure_reference",other:"figure_reference",list:"definition_reference"},this._contribTypeMapping={author:"Author","author non-byline":"Author",autahor:"Author",auther:"Author",editor:"Editor","guest-editor":"Guest Editor","group-author":"Group Author",collab:"Collaborator","reviewed-by":"Reviewer","nominated-by":"Nominator",corresp:"Corresponding Author",other:"Other","assoc-editor":"Associate Editor","associate editor":"Associate Editor","series-editor":"Series Editor",contributor:"Contributor",chairman:"Chairman","monographs-editor":"Monographs Editor","contrib-author":"Contributing Author",organizer:"Organizer",chair:"Chair",discussant:"Discussant",presenter:"Presenter","guest-issue-editor":"Guest Issue Editor",participant:"Participant",translator:"Translator"},this.test=function(){return!0
},this.isAnnotation=function(e){return void 0!==this._annotationTypes[e]},this.isParagraphish=function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType!==Node.TEXT_NODE&&!this.isAnnotation(n.tagName.toLowerCase()))return!1}return!0},this.test=function(){},this.getName=function(e){if(!e)return"N/A";var t=[],n=e.querySelector("surname"),r=e.querySelector("given-names"),o=e.querySelector("suffix");return r&&t.push(r.textContent),n&&t.push(n.textContent),o?[t.join(" "),o.textContent].join(", "):t.join(" ")},this.toHtml=function(e){if(!e)return"";var t=document.createElement("DIV");return t.appendChild(e.cloneNode(!0)),t.innerHTML},this.mmlToHtmlString=function(e){var t=this.toHtml(e);return t=t.replace(/<(\/)?mml:([^>]+)>/g,"<$1$2>")},this.selectDirectChildren=function(e,t){for(var n=[],r=e.querySelectorAll(t),o=0;o<r.length;o++){var i=r[o];i.parentElement===e&&n.push(i)}return n},this["import"]=function(e){var t;if(n.isString(e)){var r=new DOMParser;t=r.parseFromString(e,"text/xml")}else t=e;this.sanitizeXML(t);var o=this.createDocument();window.doc=o;var i=this.createState(t,o);return this.document(i,t)},this.sanitizeXML=function(){},this.createState=function(e,t){return new s.State(this,e,t)},this.createDocument=function(){var t=e("lens-article"),n=new t;return n},this.show=function(e,t){n.each(t,function(t){this.showNode(e,t)},this)},this.extractDate=function(e){if(!e)return null;var t=e.querySelector("year"),n=e.querySelector("month"),r=e.querySelector("day"),o=[t.textContent];return n&&o.push(n.textContent),r&&o.push(r.textContent),o.join("-")},this.extractPublicationInfo=function(e,t){for(var n=e.doc,r=t.querySelector("article-meta"),o=r.querySelector("pub-date"),i=r.querySelectorAll("history date"),s=t.querySelector("journal-title"),a=t.querySelector("article-id[pub-id-type=doi]"),c=t.querySelector("related-article"),u=this.extractArticleInfo(e,t),l={id:"publication_info",type:"publication_info",published_on:this.extractDate(o),journal:s?s.textContent:"",related_article:c?c.getAttribute("xlink:href"):"",doi:a?a.textContent:"",article_info:u.id,article_type:"",keywords:[],links:[],subjects:[],supplements:[],history:[],research_organisms:[],provider:""},p=0;p<i.length;p++){var h=i[p],d={type:h.getAttribute("date-type"),date:this.extractDate(h)};l.history.push(d)}n.create(l),n.show("info",l.id,0),this.enhancePublicationInfo(e,l)},this.extractArticleInfo=function(e,t){var n={id:"articleinfo",type:"paragraph"},r=e.doc,o=[];return o=o.concat(this.extractEditor(e,t)),o=o.concat(this.extractDatasets(e,t)),o=o.concat(this.extractCustomMetaGroup(e,t)),o=o.concat(this.extractAcknowledgements(e,t)),o=o.concat(this.extractCopyrightAndLicense(e,t)),o=o.concat(this.extractNotes(e,t)),n.children=o,r.create(n),n},this.extractEditor=function(e,t){var n=[],r=e.doc,o=t.querySelector("contrib[contrib-type=editor]");if(o){var i=[],s=this.getName(o.querySelector("name"));s&&i.push(s);var a=o.querySelector("institution");a&&i.push(a.textContent);var c=o.querySelector("country");c&&i.push(c.textContent);var u={type:"heading",id:e.nextId("heading"),level:3,content:"Reviewing Editor"};r.create(u),n.push(u.id);var l={type:"text",id:e.nextId("text"),content:i.join(", ")};r.create(l),n.push(l.id)}return n},this.extractDatasets=function(e,t){for(var n=[],o=e.doc,i=t.querySelectorAll("sec"),s=0;s<i.length;s++){var a=i[s],c=a.getAttribute("sec-type");if("datasets"===c){var u={type:"heading",id:e.nextId("heading"),level:3,content:"Major Datasets"};o.create(u),n.push(u.id);for(var l=this.datasets(e,r.dom.getChildren(a)),p=0;p<l.length;p++)l[p]&&n.push(l[p])}}return n};var t=function(e,n){return n?e.split(" ").map(function(e){return t(e)}).join(" "):e.charAt(0).toUpperCase()+e.slice(1)};this.capitalized=function(e,n){return t(e,n)},this.extractAcknowledgements=function(e,t){var o=[],i=e.doc,s=t.querySelectorAll("ack");return s&&s.length>0&&n.each(s,function(t){var s=t.querySelector("title"),a={type:"heading",id:e.nextId("heading"),level:3,content:s?this.capitalized(s.textContent.toLowerCase(),"all"):"Acknowledgements"};i.create(a),o.push(a.id);var c=this.bodyNodes(e,r.dom.getChildren(t),{ignore:["title"]});n.each(c,function(e){o.push(e.id)})},this),o},this.extractNotes=function(){var e=[];return e},this.__ignoreCustomMetaNames=[],this.extractCustomMetaGroup=function(e,t){var r=[],o=e.doc,i=t.querySelectorAll("article-meta-group custom-meta");if(0===i.length)return r;for(var s=0;s<i.length;s++){var a=i[s],c=a.querySelector("meta-name"),u=a.querySelector("meta-value");if(!n.include(this.__ignoreCustomMetaNames,c.textContent)){var l={type:"heading",id:e.nextId("heading"),level:3,content:""};l.content=this.annotatedText(e,c,[l.id,"content"]),o.create(l);var p=this.paragraphGroup(e,u);r.push(l.id),r=r.concat(n.pluck(p,"id"))}}return r},this.extractCopyrightAndLicense=function(e,t){var o=[],i=e.doc,s=t.querySelector("permissions");if(s){var a={type:"heading",id:e.nextId("heading"),level:3,content:"Copyright & License"};i.create(a),o.push(a.id);var c,u=s.querySelector("copyright-statement");if(u&&(c=this.paragraphGroup(e,u),c&&c.length&&(o=o.concat(n.map(c,function(e){return e.id})),"."!==u.textContent.trim().slice(-1)))){var l=n.last(n.last(c).children);i.nodes[l].content+=". "}var p=s.querySelector("license");if(p)for(var h=p.firstElementChild;h;h=h.nextElementSibling){var d=r.dom.getNodeType(h);("p"===d||"license-p"===d)&&(c=this.paragraphGroup(e,h),c&&c.length&&(o=o.concat(n.pluck(c,"id"))))}}return o},this.extractCover=function(e,t){var r=e.doc,o=r.get("document"),i={id:"cover",type:"cover",title:o.title,authors:[],"abstract":o["abstract"]};n.each(o.authors,function(t){var n=r.get(t),o={id:"text_"+t+"_reference",type:"text",content:n.name};r.create(o),i.authors.push(o.id);var s={id:e.nextId("contributor_reference"),type:"contributor_reference",path:["text_"+t+"_reference","content"],range:[0,n.name.length],target:t};r.create(s)},this),this.enhanceCover(e,i,t),r.create(i),r.show("content",i.id,0)},this.contribGroup=function(e,t){var n,r=t.querySelectorAll("contrib");for(n=0;n<r.length;n++)this.contributor(e,r[n]);var o=e.doc,i=t.querySelector("on-behalf-of");i&&(o.on_behalf_of=i.textContent.trim())},this.affiliation=function(e,t){var n=e.doc,r=t.querySelector("institution"),o=t.querySelector("country"),i=t.querySelector("label"),s=t.querySelector("addr-line named-content[content-type=department]"),a=t.querySelector("addr-line named-content[content-type=city]"),c={id:e.nextId("affiliation"),type:"affiliation",source_id:t.getAttribute("id"),label:i?i.textContent:null,department:s?s.textContent:null,city:a?a.textContent:null,institution:r?r.textContent:null,country:o?o.textContent:null};n.create(c)},this.contributor=function(e,t){var o=e.doc,i=e.nextId("contributor"),s={id:i,source_id:t.getAttribute("id"),type:"contributor",name:"",affiliations:[],fundings:[],bio:[],image:"",deceased:!1,emails:[],contribution:"",members:[]},a=t.getAttribute("contrib-type");s.contributor_type=this._contribTypeMapping[a];var c=t.querySelector("role");c&&(s.role=c.textContent);var u=t.querySelector("bio");u&&n.each(r.dom.getChildren(u),function(t){var n=t.querySelector("graphic");if(n){var r=n.getAttribute("xlink:href");s.image=r}else{var o=this.paragraphGroup(e,t);o.length>0&&(s.bio=[o[0].id])}},this),"yes"===t.getAttribute("deceased")&&(s.deceased=!0);var l=t.querySelector("uri[content-type=orcid]");l&&(s.orcid=l.getAttribute("xlink:href"));var p=t.querySelector("name");if(p)s.name=this.getName(p);else{var h=t.querySelector("collab");s.name=h?h.textContent:"N/A"}this.extractContributorProperties(e,t,s),0===s.affiliations.length&&(s.affiliations=e.affiliations),s.competing_interests.length>1&&(s.competing_interests=n.filter(s.competing_interests,function(e){return e.indexOf("no competing")<0})),"author"===t.getAttribute("contrib-type")&&o.nodes.document.authors.push(i),o.create(s),o.show("info",s.id)},this._getEqualContribs=function(e,t,r){var o=[],i=e.xmlDoc.querySelectorAll("xref[rid="+r+"]");return n.each(i,function(e){var n=e.parentNode;n!==t&&o.push(this.getName(n.querySelector("name")))},this),o},this.extractContributorProperties=function(e,t,r){var o=e.doc,i=[],s=[],a=t.querySelectorAll("xref");n.each(a,function(n){if("aff"===n.getAttribute("ref-type")){var a=n.getAttribute("rid"),c=o.getNodeBySourceId(a);c&&(r.affiliations.push(c.id),e.used[a]=!0)}else if("other"===n.getAttribute("ref-type")){console.log("FIXME: please add documentation about using 'other' as indicator for extracting an awardGroup.");var u=e.xmlDoc.getElementById(n.getAttribute("rid"));if(!u)return;var l=u.querySelector("funding-source");if(!l)return;var p=u.querySelector("award-id");p=p?", "+p.textContent:"";var h=l.childNodes[0].textContent;r.fundings.push([h,p].join(""))}else if("corresp"===n.getAttribute("ref-type")){var d=n.getAttribute("rid"),f=e.xmlDoc.getElementById(d);if(!f)return;var g=f.querySelector("email");if(!g)return;r.emails.push(g.textContent)}else if("fn"===n.getAttribute("ref-type")){var y=n.getAttribute("rid"),m=e.xmlDoc.getElementById(y),v=!0;if(m){var b=m.getAttribute("fn-type");switch(b){case"con":r.contribution=m.textContent;break;case"conflict":s.push(m.textContent.trim());break;case"present-address":r.present_address=m.querySelector("p").textContent;break;case"equal":console.log("FIXME: isn't fnElem.getAttribute(id) === fnId?"),i=this._getEqualContribs(e,t,m.getAttribute("id"));break;case"other":console.log("FIXME: isn't fnElem.getAttribute(id) === fnId?"),m.getAttribute("id").indexOf("equal-contrib")>=0?i=this._getEqualContribs(e,t,m.getAttribute("id")):v=!1;break;default:v=!1}v&&(e.used[y]=!0)}}else console.log("Skipping contrib's xref",n.textContent)},this),s.length>1&&(s=n.filter(s,function(e){return e.indexOf("no competing")<0})),r.competing_interests=s;var c=t.querySelector("xref[ref-type=other]");if(c){var u=c.getAttribute("rid"),l=e.xmlDoc.querySelectorAll("#"+u+" contrib");r.members=n.map(l,function(e){return this.getName(e.querySelector("name"))},this)}r.equal_contrib=i,r.competing_interests=s},this.document=function(e,t){var r=e.doc,o=t.querySelector("article");if(!o)throw new i("Expected to find an 'article' element.");return this.article(e,o),this.postProcessAnnotations(e),n.each(r.containers,function(e){e.rebuild()}),r},this.postProcessAnnotations=function(e){for(var t=0;t<e.annotations.length;t++){var n=e.annotations[t];if(n.target){var r=e.doc.getNodeBySourceId(n.target);r&&(n.target=r.id)}e.doc.create(e.annotations[t])}},this.article=function(e,t){var n=e.doc,o=t.querySelector("article-id");n.id=o?o.textContent:r.uuid(),this.extractDefinitions(e,t),this.extractAffilitations(e,t),this.extractContributors(e,t),this.extractCitations(e,t),this.extractFigures(e,t),this.extractCover(e,t),this.extractArticleMeta(e,t),this.extractPublicationInfo(e,t);var i=t.querySelector("body");i&&this.body(e,i),this.enhanceArticle(e,t)},this.extractDefinitions=function(e){var t=e.xmlDoc.querySelectorAll("def-item");n.each(t,function(t){var n=t.querySelector("term"),r=t.querySelector("def"),o=r.id||r.getAttribute("hwp:id")||e.nextId("definition"),i={id:o,type:"definition",title:n.textContent,description:r.textContent};e.doc.create(i),e.doc.show("definitions",i.id)})},this.extractArticleMeta=function(e,t){var n=t.querySelector("article-meta");if(!n)throw new i("Expected element: 'article-meta'");var r=n.querySelectorAll("article-id");this.articleIds(e,r);var o=n.querySelector("title-group");o&&this.titleGroup(e,o);var s=n.querySelectorAll("pub-date");this.pubDates(e,s),this.abstracts(e,n)},this.extractAffilitations=function(e,t){for(var n=t.querySelectorAll("aff"),r=0;r<n.length;r++)this.affiliation(e,n[r])},this.extractContributors=function(e,t){var n=t.querySelector("article-meta contrib-group");n&&this.contribGroup(e,n)},this.extractFigures=function(e,t){for(var n,o=t.querySelector("body"),i=o.querySelectorAll("fig, table-wrap, supplementary-material, media[mimetype=video]"),s=[],a=0;a<i.length;a++){var c=i[a],u=r.dom.getNodeType(c);"fig"===u?(n=this.figure(e,c),n&&s.push(n)):"table-wrap"===u?(n=this.tableWrap(e,c),n&&s.push(n)):"media"===u?(n=this.video(e,c),n&&s.push(n)):"supplementary-material"===u&&(n=this.supplement(e,c),n&&s.push(n))}s.length>0&&this.show(e,s)},this.extractCitations=function(e,t){var n=t.querySelector("ref-list");n&&this.refList(e,n)},this.articleIds=function(e,t){var n=e.doc;n.id=t.length>0?t[0].textContent:r.uuid()},this.titleGroup=function(e,t){var n=e.doc,r=t.querySelector("article-title");r&&(n.title=this.annotatedText(e,r,["document","title"],{ignore:["xref"]}))},this.pubDates=function(e,t){var n=e.doc;if(t.length>0){var r=this.pubDate(e,t[0]);n.created_at=r.date}},this.pubDate=function(e,t){var o=-1,i=-1,s=-1;n.each(r.dom.getChildren(t),function(e){var t=r.dom.getNodeType(e),n=e.textContent;"day"===t?o=parseInt(n,10):"month"===t?i=parseInt(n,10):"year"===t&&(s=parseInt(n,10))},this);var a=new Date(s,i,o);return{date:a}},this.abstracts=function(e,t){var r=t.querySelectorAll("abstract");n.each(r,function(t){this["abstract"](e,t)},this)},this["abstract"]=function(e,t){var n=e.doc,o=[],i=t.querySelector("title"),s={id:e.nextId("heading"),type:"heading",level:1,content:i?i.textContent:"Abstract"};n.create(s),o.push(s),o=o.concat(this.bodyNodes(e,r.dom.getChildren(t),{ignore:["title","object-id"]})),o.length>0&&this.show(e,o)},this.body=function(e,t){var n=e.doc,o={id:e.nextId("heading"),type:"heading",level:1,content:"Main Text"};n.create(o);var i=[o].concat(this.bodyNodes(e,r.dom.getChildren(t)));i.length>0&&this.show(e,i)},this._ignoredBodyNodes={fig:!0,"table-wrap":!0},this._bodyNodes={},this.bodyNodes=function(e,t,o){for(var i,s=[],a=0;a<t.length;a++){var c=t[a],u=r.dom.getNodeType(c);if(this._bodyNodes[u]){var l=this._bodyNodes[u].call(this,e,c);n.isArray(l)?s=s.concat(l):l&&s.push(l)}else this._ignoredBodyNodes[u]||o&&o.ignore&&o.ignore.indexOf(u)>=0?(i=this.ignoredNode(e,c,u),i&&s.push(i)):console.error("Node not yet supported as top-level node: "+u)}return s},this._bodyNodes.p=function(e,t){return this.paragraphGroup(e,t)},this._bodyNodes.sec=function(e,t){return this.section(e,t)},this._bodyNodes.list=function(e,t){return this.list(e,t)},this._bodyNodes["disp-formula"]=function(e,t){return this.formula(e,t)},this._bodyNodes.caption=function(e,t){return this.caption(e,t)},this._bodyNodes["boxed-text"]=function(e,t){return this.boxedText(e,t)},this._bodyNodes["disp-quote"]=function(e,t){return this.boxedText(e,t)},this._bodyNodes.attrib=function(e,t){return this.paragraphGroup(e,t)},this._bodyNodes.comment=function(e,t){return this.comment(e,t)},this.ignoredNode=function(){},this.comment=function(){return null},this.boxedText=function(e,t){var o=e.doc,i=this.bodyNodes(e,r.dom.getChildren(t)),s=e.nextId("box"),a={type:"box",id:s,source_id:t.getAttribute("id"),label:"",children:n.pluck(i,"id")};return o.create(a),a},this.datasets=function(e,t){for(var n=[],o=0;o<t.length;o++){var i=t[o],s=r.dom.getNodeType(i);if("p"===s){var a=i.querySelector("related-object");if(a)n=n.concat(this.indivdata(e,a));else{var c=this.paragraphGroup(e,i);c.length>0&&n.push(c[0].id)}}}return n},this.indivdata=function(e,t){var n=e.doc,o={type:"paragraph",id:e.nextId("paragraph"),children:[]},i={type:"text",id:e.nextId("text"),content:""};o.children.push(i.id);for(var s=r.dom.getChildren(t),a=0;a<s.length;a++){var c,u=s[a],l=r.dom.getNodeType(u);if("name"===l)for(var p=r.dom.getChildren(u),h=0;h<p.length;h++){var d=p[h];if(0===h)c=this.paragraphGroup(e,d),o.children.push(c[0].children[0]);else{var f={type:"text",id:e.nextId("text"),content:", "};n.create(f),o.children.push(f.id),c=this.paragraphGroup(e,d),o.children.push(c[0].children[0])}}else c=this.paragraphGroup(e,u),c&&c[0]&&c[0].children&&o.children.push(c[0].children[0])}return n.create(o),n.create(i),o.id},this.section=function(e,t){e.sectionLevel++;var n=e.doc,o=r.dom.getChildren(t),i=[],s=this.selectDirectChildren(t,"label")[0],a=this.selectDirectChildren(t,"title")[0];if(a||console.error("FIXME: every section should have a title",this.toHtml(t)),i=i.concat(this.bodyNodes(e,o,{ignore:["title","label"]})),i.length>0&&a){var c=e.nextId("heading"),u={id:c,source_id:t.getAttribute("id"),type:"heading",level:e.sectionLevel,content:a?this.annotatedText(e,a,[c,"content"]):""};s&&(u.label=s.textContent),u.content.length>0&&(n.create(u),i.unshift(u))}else 0===i.length&&console.info("NOTE: skipping section without content:",a?a.innerHTML:"no title");return e.sectionLevel--,i},this.ignoredParagraphElements={comment:!0,"supplementary-material":!0,fig:!0,"fig-group":!0,"table-wrap":!0,media:!0},this.acceptedParagraphElements={"boxed-text":{handler:"boxedText"},list:{handler:"list"},"disp-formula":{handler:"formula"}},this.inlineParagraphElements={"inline-graphic":!0,"inline-formula":!0},this.segmentParagraphElements=function(e){for(var t=[],o="",i=new r.dom.ChildNodeIterator(e);i.hasNext();){var s=i.next(),a=r.dom.getNodeType(s);this.ignoredParagraphElements[a]||("text"===a||this.isAnnotation(a)||this.inlineParagraphElements[a]?("paragraph"!==o&&(t.push({handler:"paragraph",nodes:[]}),o="paragraph"),n.last(t).nodes.push(s)):(this.acceptedParagraphElements[a]&&t.push(n.extend({node:s},this.acceptedParagraphElements[a])),o=a))}return t},this.paragraphGroup=function(e,t){for(var n=[],r=this.segmentParagraphElements(t),o=0;o<r.length;o++){var i,s=r[o];"paragraph"===s.handler?(i=this.paragraph(e,s.nodes),i&&(i.source_id=t.getAttribute("id"))):i=this[s.handler](e,s.node),i&&n.push(i)}return n},this.paragraph=function(e,t){var o=e.doc;e.skipWS=!0;for(var i={id:e.nextId("paragraph"),type:"paragraph",children:null},s=[],a=new r.dom.ChildNodeIterator(t);a.hasNext();){var c=a.next(),u=r.dom.getNodeType(c);if("text"===u||this.isAnnotation(u)){var l={id:e.nextId("text"),type:"text",content:null};e.stack.push({path:[l.id,"content"]});var p=this._annotatedText(e,a.back(),{offset:0,breakOnUnknown:!0});p.length>0&&(l.content=p,o.create(l),s.push(l)),e.stack.pop()}else if("inline-graphic"===u){var h=c.getAttribute("xlink:href"),d={id:e.nextId("image"),type:"image",url:this.resolveURL(e,h)};o.create(d),s.push(d)}else if("inline-formula"===u){var f=this.formula(e,c,"inline");f&&s.push(f)}}return 0===s.length?null:(i.children=n.map(s,function(e){return e.id}),o.create(i),i)},this.list=function(e,t){var n=e.doc,o={id:e.nextId("list"),source_id:t.getAttribute("id"),type:"list",items:[],ordered:!1};"ordered"===t.getAttribute("list-type")&&(o.ordered=!0);for(var i=t.querySelectorAll("list-item"),s=0;s<i.length;s++)for(var a=i[s],c=this.bodyNodes(e,r.dom.getChildren(a)),u=0;u<c.length;u++)o.items.push(c[u].id);return n.create(o),o},this.figure=function(e,t){var n=e.doc,r={type:"figure",id:e.nextId("figure"),source_id:t.getAttribute("id"),label:"Figure",url:"",caption:null},o=t.querySelector("label");o&&(r.label=this.annotatedText(e,o,[r.id,"label"]));var i=t.querySelector("caption");if(i){var s=this.caption(e,i);s&&(r.caption=s.id)}var a=t.querySelector("attrib");return a&&(r.attrib=a.textContent),this.enhanceFigure(e,r,t),n.create(r),r},this.supplement=function(e,t){var n=e.doc,r=t.querySelector("label"),o=t.querySelector("media"),i=o?o.getAttribute("xlink:href"):null,s=t.querySelector("object-id[pub-id-type='doi']");s=s?"http://dx.doi.org/"+s.textContent:"";var a={id:e.nextId("supplement"),source_id:t.getAttribute("id"),type:"supplement",label:r?r.textContent:"",url:i,caption:null},c=t.querySelector("caption");if(c){var u=this.caption(e,c);u&&(a.caption=u.id)}return this.enhanceSupplement(e,a,t),n.create(a),a},this.caption=function(e,t){var r=e.doc,o={id:e.nextId("caption"),source_id:t.getAttribute("id"),type:"caption",title:"",children:[]},i=t.querySelector("title");if(i){var s=this.paragraph(e,i);s&&(o.title=s.id)}var a=[],c=t.querySelectorAll("p");return n.each(c,function(n){if(n.parentNode===t){var r=this.paragraph(e,n);r&&a.push(r.id)}},this),o.children=a,r.create(o),o},this.video=function(e,t){var n=e.doc,r=t.querySelector("label").textContent,o=e.nextId("video"),i={id:o,source_id:t.getAttribute("id"),type:"video",label:r,title:"",caption:null,poster:""},s=t.querySelector("caption");if(s){var a=this.caption(e,s);a&&(i.caption=a.id)}return this.enhanceVideo(e,i,t),n.create(i),i},this.tableWrap=function(e,t){var n=e.doc,r=t.querySelector("label"),o={id:e.nextId("html_table"),source_id:t.getAttribute("id"),type:"html_table",title:"",label:r?r.textContent:"Table",content:"",caption:null,footers:[]},i=t.querySelector("table");return i&&(o.content=this.toHtml(i)),this.extractTableCaption(e,o,t),this.enhanceTable(e,o,t),n.create(o),o},this.extractTableCaption=function(e,t,n){var r=n.querySelector("caption");if(r){var o=this.caption(e,r);o&&(t.caption=o.id)}else console.error("caption node not found for",n)},this._getFormulaData=function(e){for(var t=[],n=e.firstElementChild;n;n=n.nextElementSibling){var o=r.dom.getNodeType(n);switch(o){case"graphic":case"inline-graphic":t.push({format:"image",data:n.getAttribute("xlink:href")});break;case"svg":t.push({format:"svg",data:this.toHtml(n)});break;case"mml:math":case"math":t.push({format:"mathml",data:this.mmlToHtmlString(n)});break;case"tex-math":t.push({format:"latex",data:n.textContent});break;case"label":break;default:console.error("Unsupported formula element of type "+o)}}return t},this.formula=function(e,t,n){var r=e.doc,o={id:e.nextId("formula"),source_id:t.getAttribute("id"),type:"formula",label:"",inline:!!n,data:[],format:[]},i=t.querySelector("label");i&&(o.label=i.textContent);for(var s=this._getFormulaData(t,n),a=0;a<s.length;a++)o.format.push(s[a].format),o.data.push(s[a].data);return r.create(o),o},this.citationTypes={"mixed-citation":!0,"element-citation":!0},this.refList=function(e,t){for(var n=t.querySelectorAll("ref"),r=0;r<n.length;r++)this.ref(e,n[r])},this.ref=function(e,t){for(var n=r.dom.getChildren(t),o=0;o<n.length;o++){var i=n[o],s=r.dom.getNodeType(i);this.citationTypes[s]?this.citation(e,t,i):"label"===s||console.error("Not supported in 'ref': ",s)}},this.citation=function(e,t,n){var r,o,i=e.doc,s=e.nextId("article_citation"),a=n.querySelector("person-group");if(!a)return void console.error("FIXME: there is one of those 'mixed-citation' without any structure. Skipping ...",n);r={id:s,source_id:t.getAttribute("id"),type:"citation",title:"N/A",label:"",authors:[],doi:"",source:"",volume:"",fpage:"",lpage:"",citation_urls:[]};var c=a.querySelectorAll("name");for(o=0;o<c.length;o++)r.authors.push(this.getName(c[o]));var u=a.querySelectorAll("collab");for(o=0;o<u.length;o++)r.authors.push(u[o].textContent);var l=n.querySelector("source");l&&(r.source=l.textContent);var p=n.querySelector("article-title");if(p)r.title=this.annotatedText(e,p,[s,"title"]);else{var h=n.querySelector("comment");h?r.title=this.annotatedText(e,h,[s,"title"]):l?r.title=this.annotatedText(e,l,[s,"title"]):console.error("FIXME: this citation has no title",n)}var d=n.querySelector("volume");d&&(r.volume=d.textContent);var f=n.querySelector("publisher-loc");f&&(r.publisher_location=f.textContent);var g=n.querySelector("publisher-name");g&&(r.publisher_name=g.textContent);var y=n.querySelector("fpage");y&&(r.fpage=y.textContent);var m=n.querySelector("lpage");m&&(r.lpage=m.textContent);var v=n.querySelector("year");v&&(r.year=v.textContent);var b=t.querySelector("label");b&&(r.label=b.textContent);var w=n.querySelector("pub-id[pub-id-type='doi'], ext-link[ext-link-type='doi']");return w&&(r.doi="http://dx.doi.org/"+w.textContent),i.create(r),i.show("citations",s),r},this.back=function(){return null},this.createAnnotation=function(e,t,r,o){if(r!==o){var i=t.tagName.toLowerCase(),s={type:"annotation",path:n.last(e.stack).path,range:[r,o]};this.addAnnotationData(e,s,t,i),this.enhanceAnnotationData(e,s,t,i),s.id=e.nextId(s.type),e.annotations.push(s)}},this.addAnnotationData=function(e,t,n,r){if(t.type=this._annotationTypes[r]||"annotation","xref"===r)this.addAnnotationDataForXref(e,t,n);else if("ext-link"===r||"uri"===r){t.url=n.getAttribute("xlink:href");var o=n.getAttribute("ext-link-type")||"";"uri"!==r&&"uri"!==o.toLowerCase()||/^\w+:\/\//.exec(t.url)||/^\//.exec(t.url)?"doi"===o.toLowerCase()&&(t.url=["http://dx.doi.org/",t.url].join("")):t.url="http://"+t.url}else if("email"===r)t.url="mailto:"+n.textContent.trim();else if("inline-graphic"===r)t.url=n.getAttribute("xlink:href");else if("inline-formula"===r){var i=this.formula(e,n,"inline");t.target=i.id}},this.addAnnotationDataForXref=function(e,t,n){var r=n.getAttribute("ref-type"),o=n.getAttribute("rid");t.type=this._refTypeMapping[r]||"cross_reference",o&&(t.target=o.split(" ")[0])},this.annotatedText=function(e,t,n,o){o=o||{},e.stack.push({path:n,ignore:o.ignore});var i=new r.dom.ChildNodeIterator(t),s=this._annotatedText(e,i,o);return e.stack.pop(),s},this._annotatedText=function(e,t,n){for(var o="",i=void 0===n.offset?0:n.offset,s=!!n.nested,a=!!n.breakOnUnknown;t.hasNext();){var c=t.next();if(c.nodeType===Node.TEXT_NODE){var u=e.acceptText(c.textContent);o+=u,i+=u.length}else{var l,p=r.dom.getNodeType(c);if(this.isAnnotation(p)){if(e.top().ignore.indexOf(p)<0){var h=i;l=this._annotationTextHandler[p]?this._annotationTextHandler[p].call(this,e,c,p,i):this._getAnnotationText(e,c,p,i),o+=l,i+=l.length,e.ignoreAnnotations||this.createAnnotation(e,c,h,i)}}else if(a){if(!s){t.back();break}console.error("Node not yet supported in annoted text: "+p)}else e.top().ignore.indexOf(p)<0&&(l=this._getAnnotationText(e,c,p,i),o+=l,i+=l.length)}}return o},this._annotationTextHandler={},this._getAnnotationText=function(e,t,n,o){var i=new r.dom.ChildNodeIterator(t),s=this._annotatedText(e,i,{offset:o,nested:!0});return s},this._annotationTextHandler["ext-link"]=function(e,t,n,r){var o=this._getAnnotationText(e,t,r);return"ext-link"===n&&t.getAttribute("xlink:href")===o.trim()&&(o=this.shortenLinkLabel(e,o)),o},this._annotationTextHandler["inline-formula"]=function(e){return e.acceptText("{{inline-formula}}")},this.shortenLinkLabel=function(e,t){var n=50,r=10;if(t.length>n){var o=/((?:\w+:\/\/)?[\/]?[^\/]+[\/]?)(.*)/.exec(t);if(o){var i=o[1]||"",s=o[2]||"";if(i.length>n-r)t=i.substring(0,n-r)+"..."+s.substring(s.length-r-3);else{var a=Math.max(n-i.length-3,r-3);t=i+"..."+s.substring(s.length-a)}}else t=t.substring(0,n-r)+"..."+t.substring(t.length-r-3)}return t},this.getBaseURL=function(e){var t=e.xmlDoc.querySelector("article").getAttribute("xml:base");return t||e.options.baseURL},this.enhanceArticle=function(){},this.enhanceCover=function(){},this.enhanceFigure=function(e,t,n){var r=n.querySelector("graphic"),o=r.getAttribute("xlink:href");t.url=this.resolveURL(e,o)},this.enhancePublicationInfo=function(){},this.enhanceSupplement=function(){},this.enhanceTable=function(){},this.enhanceVideo=function(e,t,n){var r,o=(n.querySelector("media")||n,n.getAttribute("xlink:href"));if(o.match(/http:/)){var i=o.lastIndexOf(".");return r=o.substring(0,i),t.url=r+".mp4",t.url_ogv=r+".ogv",t.url_webm=r+".webm",void(t.poster=r+".png")}var s=this.getBaseURL(e);r=o.split(".")[0],t.url=s+r+".mp4",t.url_ogv=s+r+".ogv",t.url_webm=s+r+".webm",t.poster=s+r+".png"},this.resolveURL=function(e,t){return t.match(/http:/)?t:[e.options.baseURL,t].join("")},this.viewMapping={box:"content",supplement:"figures",figure:"figures",html_table:"figures",video:"figures"},this.enhanceAnnotationData=function(){},this.showNode=function(e,t){var n=this.viewMapping[t.type]||"content";e.doc.show(n,t.id)}},s.State=function(e,t,r){var o=this;this.xmlDoc=t,this.doc=r,this.options=e.options,this.annotations=[],this.stack=[],this.sectionLevel=1,this.affiliations=[];var i={};this.nextId=function(e){return i[e]=i[e]||0,i[e]++,e+"_"+i[e]},this.used={};var s=/^\s+/g,a=/^\s*/g,c=/\s+$/g,u=/\s+/g,l=" ",p=/[\t\n\r]+/g;this.lastChar="",this.skipWS=!1,this.acceptText=function(e){return this.options.TRIM_WHITESPACES?(e=e.replace(p,""),e=this.lastChar===l||this.skipWS?e.replace(a,""):e.replace(s,l),this.skipWS=!1,e=e.replace(c,l),this.options.REMOVE_INNER_WS&&(e=e.replace(u,l)),this.lastChar=e[e.length-1]||this.lastChar,e):e},this.top=function(){var e=n.last(o.stack);return e=e||{},e.ignore=e.ignore||[],e}},s.prototype=new s.Prototype,s.prototype.constructor=s,s.DefaultOptions={TRIM_WHITESPACES:!0,REMOVE_INNER_WS:!0},t.exports=s},{"lens-article":5,"substance-util":169,underscore:177}],123:[function(e,t){"use strict";var n=(e("substance-util"),e("underscore"),e("./lens_converter")),r=function(e){n.call(this,e)};r.Prototype=function(){n.prototype;this.test=function(e){var t=e.querySelector("publisher-name").textContent;return"Public Library of Science"===t},this.enhanceFigure=function(e,t,n){var r=n.querySelector("graphic"),o=r.getAttribute("xlink:href");o=["http://www.plosone.org/article/fetchObject.action?uri=",o,"&representation=PNG_L"].join(""),t.url=o}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,t.exports=r},{"./lens_converter":122,"substance-util":169,underscore:177}],124:[function(e,t){t.exports=e("./src/lens")},{"./src/lens":127}],125:[function(e,t){var n=e("./panels/container_panel"),r=new n({type:"resource",name:"figures",container:"figures",title:"Figures",icon:"fa-picture-o",references:["figure_reference"],zoom:!0}),o=new n({type:"resource",name:"citations",container:"citations",title:"References",icon:"fa-link",references:["citation_reference"]}),i=new n({type:"resource",name:"definitions",container:"definitions",title:"Glossary",icon:"fa-book",references:["definition_reference"]}),s=new n({type:"resource",name:"info",container:"info",title:"Info",icon:"fa-info",references:["contributor_reference"]});t.exports=[r,o,i,s]},{"./panels/container_panel":131}],126:[function(e,t){var n=e("./workflows/toggle_resource_reference"),r=e("./workflows/follow_crossrefs"),o=e("./workflows/jump_to_top"),i=[new n,new r,new o];t.exports=i},{"./workflows/follow_crossrefs":147,"./workflows/jump_to_top":148,"./workflows/toggle_resource_reference":149}],127:[function(e,t){"use strict";var n=e("substance-application"),r=e("./lens_controller"),o=e("lens-converter"),i=e("lens-article"),s=e("./panels/resource_panel_viewfactory"),a=e("./reader_controller"),c=e("./reader_view"),u=e("./panels/panel"),l=e("./panels/panel_controller"),p=e("./panels/panel_view"),h=e("./panels/container_panel"),d=e("./panels/container_panel_controller"),f=e("./panels/container_panel_view"),g=e("./workflows/workflow"),y=e("./default_panels"),m=e("./default_workflows"),v=function(e){e=e||{},e.routes=e.routes||this.getRoutes(),e.panels=e.panels||this.getPanels(),e.workflows=e.workflows||this.getWorkflows(),e.converters=this.getConverters(e.converterOptions),n.call(this,e),this.controller=e.controller||this.createController(e)};v.Prototype=function(){this.determineDevice=function(){function e(){var e=null!=navigator.userAgent.match(/iPad/i),t=null!=navigator.userAgent.match(/iPhone/i);return e||t}function t(){null!=navigator.userAgent.match(/iPhone/i);return!0}function n(){return"ontouchstart"in document.documentElement}n()&&$("#container").addClass("touchable"),e()&&$("#container").addClass("ios"),t()&&$("#container").addClass("iphone")},this.start=function(){n.prototype.start.call(this)},this.render=function(){this.view=this.controller.createView(),this.$el.html(this.view.render().el),this.determineDevice()},this.getRoutes=function(){return v.getDefaultRoutes()},this.getPanels=function(){return v.getDefaultPanels()},this.getWorkflows=function(){return v.getDefaultWorkflows()},this.getConverters=function(e){return[v.getDefaultConverter(e)]},this.createController=function(e){return new r(e)}},v.Prototype.prototype=n.prototype,v.prototype=new v.Prototype,v.prototype.constructor=v,v.DEFAULT_ROUTES=[{route:":context/:focussedNode/:fullscreen",name:"document-focussed-fullscreen",command:"openReader"},{route:":context/:focussedNode",name:"document-focussed",command:"openReader"},{route:":context",name:"document-context",command:"openReader"},{route:"url/:url",name:"document",command:"openReader"},{route:"",name:"document",command:"openReader"}],v.getDefaultRoutes=function(){return v.DEFAULT_ROUTES
},v.getDefaultPanels=function(){return y.slice(0)},v.getDefaultWorkflows=function(){return m.slice(0)},v.getDefaultConverter=function(e){return new o(e)},v.Article=i,v.ReaderController=a,v.ReaderView=c,v.Controller=r,v.LensController=r,v.Panel=u,v.PanelController=l,v.PanelView=p,v.ContainerPanel=h,v.ContainerPanelController=d,v.ContainerPanelView=f,v.ResourcePanelViewFactory=s,v.Workflow=g,t.exports=v},{"./default_panels":125,"./default_workflows":126,"./lens_controller":128,"./panels/container_panel":131,"./panels/container_panel_controller":132,"./panels/container_panel_view":133,"./panels/panel":140,"./panels/panel_controller":141,"./panels/panel_view":142,"./panels/resource_panel_viewfactory":143,"./reader_controller":145,"./reader_view":146,"./workflows/workflow":150,"lens-article":5,"lens-converter":121,"substance-application":151}],128:[function(e,t){"use strict";var n=e("underscore"),r=e("substance-util"),o=e("substance-application").Controller,i=e("./lens_view"),s=e("./reader_controller"),a=e("lens-article"),c=e("lens-converter"),u=function(e){o.call(this),this.config=e,this.Article=e.articleClass||a,this.converter=e.converter,this.converters=e.converters,this.converterOptions=n.extend({},c.DefaultOptions,e.converterOptions),this.on("open:reader",this.openReader)};u.Prototype=function(){this.createView=function(){var e=new i(this);return this.view=e,e},this.importXML=function(){var e=this.convertDocument(xml);this.createReader(e,{panel:"toc"})},this.updatePath=function(e){var t=[];t.push(e.panel),e.focussedNode&&t.push(e.focussedNode),e.fullscreen&&t.push("fullscreen"),window.app.router.navigate(t.join("/"),{trigger:!1,replace:!1})},this.createReader=function(e,t){var n=this;this.reader=new s(e,t,this.config),this.reader.on("state-changed",function(){n.updatePath(n.reader.state)}),this.modifyState({context:"reader"})},this.convertDocument=function(e){for(var t,n=0;!t&&n<this.converters.length;){var r=this.converters[n];r.test(e,this.config.document_url)&&(t=r["import"](e)),n+=1}if(!t)throw new Error("No suitable converter found for this document",e);return t},this.openReader=function(e,t,n){var r=this,o={panel:e||"toc",focussedNode:t,fullscreen:!!n};if(this.reader)this.reader.modifyState(o);else if("lens_article.xml"===this.config.document_url){var i=this.Article.describe();r.createReader(i,o)}else this.trigger("loading:started","Loading article"),$.get(this.config.document_url).done(function(e){var t;$.isXMLDoc(e)?t=r.convertDocument(e):("string"==typeof e&&(e=$.parseJSON(e)),t=r.Article.fromSnapshot(e)),"toc"===o.panel&&t.getHeadings().length<=2&&(o.panel="info"),r.createReader(t,o)}).fail(function(e){r.view.startLoading("Error during loading. Please try again."),console.error(e)})}},u.Prototype.prototype=o.prototype,u.prototype=new u.Prototype,n.extend(u.prototype,r.Events),t.exports=u},{"./lens_view":130,"./reader_controller":145,"lens-article":5,"lens-converter":121,"substance-application":151,"substance-util":169,underscore:177}],129:[function(e,t){var n=e("underscore"),r=e("substance-application"),o=r.View,i=function(e,t){o.call(this,t),this.docCtrl=e,this.options=t,this.document=e.getDocument(),this.viewFactory=this.options.viewFactory?this.options.viewFactory:new this.document.constructor.ViewFactory(this.document.nodeTypes),this.$el.addClass("surface"),this.$nodes=$("<div>").addClass("nodes"),this.$el.append(this.$nodes)};i.Prototype=function(){this.render=function(){return this.$nodes.html(this.build()),this},this.findNodeView=function(e){return this.el.querySelector("*[data-id="+e+"]")},this.build=function(){var e=document.createDocumentFragment();n.each(this.nodes,function(e){e.dispose()}),this.nodes={};var t=this.docCtrl.container.getTopLevelNodes();return n.each(t,function(t){var n=this.renderNodeView(t);this.nodes[t.id]=n,e.appendChild(n.el)},this),e},this.renderNodeView=function(e){var t=this.viewFactory.createView(e,{topLevel:!0});return t.render(),t}},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,i.prototype.constructor=i,t.exports=i},{"substance-application":151,underscore:177}],130:[function(e,t){"use strict";var n=e("underscore"),r=e("substance-application").View,o=e("substance-application").$$,i=function(e){r.call(this),this.controller=e,this.$el.attr({id:"container"}),this.listenTo(this.controller,"state-changed",this.onStateChanged),this.listenTo(this.controller,"loading:started",this.startLoading),$(document).on("dragover",function(){return!1}),$(document).on("ondragend",function(){return!1}),$(document).on("drop",this.handleDroppedFile.bind(this))};i.Prototype=function(){this.handleDroppedFile=function(){var e=this.controller,t=event.dataTransfer.files,n=t[0],r=new FileReader;return r.onload=function(t){e.importXML(t.target.result)},r.readAsText(n),!1},this.onStateChanged=function(){var e=this.controller.state;"reader"===e.context?this.openReader():console.log("Unknown application state: "+e)},this.startLoading=function(e){e||(e="Loading article"),$(".spinner-wrapper .message").html(e),$("body").addClass("loading")},this.stopLoading=function(){$("body").removeClass("loading")},this.openReader=function(){var e=this.controller.reader.createView(),t=this;t.replaceMainView("reader",e),t.startLoading("Typesetting"),this.$("#main").css({opacity:0}),n.delay(function(){t.stopLoading(),t.$("#main").css({opacity:1})},1e3)},this.replaceMainView=function(e,t){$("body").removeClass().addClass("current-view "+e),this.mainView&&this.mainView!==t&&this.mainView.dispose(),this.mainView=t,this.$("#main").html(t.render().el)},this.render=function(){return this.el.innerHTML="",this.el.appendChild(o(".browser-not-supported",{text:"Sorry, your browser is not supported.",style:"display: none;"})),this.el.appendChild(o(".spinner-wrapper",{children:[o(".spinner"),o(".message",{html:"Loading article"})]})),this.el.appendChild(o("#main")),this},this.dispose=function(){this.stopListening(),this.mainView&&this.mainView.dispose()}},i.Prototype.prototype=r.prototype,i.prototype=new i.Prototype,t.exports=i},{"substance-application":151,underscore:177}],131:[function(e,t){"use strict";var n=e("./panel"),r=e("./container_panel_controller"),o=function(e){n.call(this,e)};o.Prototype=function(){this.createController=function(e){return new r(e,this.config)}},o.Prototype.prototype=n.prototype,o.prototype=new o.Prototype,t.exports=o},{"./container_panel_controller":132,"./panel":140}],132:[function(e,t){"use strict";var n=e("substance-document"),r=e("./panel_controller"),o=e("./resource_panel_viewfactory"),i=e("./container_panel_view"),s=function(e,t){r.call(this,e,t),this.docCtrl=new n.Controller(e,{view:t.container})};s.Prototype=function(){this.createView=function(){var e,t=this.getDocument();if("resource"===this.config.type)e=this.config.createViewFactory?this.config.createViewFactory(t,this.config):new o(t.nodeTypes,this.config);else{var n=t.constructor.ViewFactory;e=new n(t.nodeTypes,this.config)}return new i(this,e,this.config)},this.getContainer=function(){return this.docCtrl.getContainer()}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,t.exports=s},{"./container_panel_view":133,"./panel_controller":141,"./resource_panel_viewfactory":143,"substance-document":162}],133:[function(e,t){"use strict";var n=e("underscore"),r=e("./surface_scrollbar"),o=e("../lens_surface"),i=e("./panel_view"),s=function(e,t,s){i.call(this,e,s),this.surface=new o(e.docCtrl,{editable:!1,viewFactory:t}),this.docCtrl=e.docCtrl,this.scrollbar=new r(this.surface),this._onScroll=n.bind(this.onScroll,this),this.surface.$el.on("scroll",this._onScroll),this.surface.$el.addClass("resource-view").addClass(s.container),this.el.appendChild(this.surface.el),this.el.appendChild(this.scrollbar.el),this.$activeResource=null,this.lastScrollPos=0};s.Prototype=function(){this.render=function(){return 0===this.getContainer().getLength()?(this.hideToggle(),this.hide()):(this.surface.render(),this.scrollbar.render()),this},this.getContainer=function(){return this.docCtrl.container},this.onScroll=function(){this.scrollbar.onScroll()},this.hasScrollbar=function(){return!0},this.scrollTo=function(e){var t=this.findNodeView(e);if(t){var n,r=$(t),o=$(window).height(),i=this.surface.$el.height(),s=i>o;if(s){n=$(document).scrollTop();var a,c=r.position().top,u=r.height();if(c>n&&n+o>c)return;a=c,$(document).scrollTop(a)}else{n=this.surface.$el.scrollTop();var a,c=r.offset().top,u=r.height();if(c>0&&i>c+u||c>=0&&i>c)return;a=n+c,this.surface.$el.scrollTop(a)}this.scrollbar.update()}else console.info("ContainerPanelView.scrollTo(): Unknown resource '%s'",e)},this.findNodeView=function(e){return this.surface.findNodeView(e)},this.addHighlight=function(e,t){i.prototype.addHighlight.call(this,e,t);var n=this.getDocument().get(e);n&&this.scrollbar.addHighlight(e,t+" "+n.type)},this.removeHighlights=function(){i.prototype.removeHighlights.call(this),this.scrollbar.removeHighlights(),this.scrollbar.update()},this.update=function(){this.scrollbar.update()},this.hide=function(){this.hidden||(this.lastScrollPos=$(document).scrollTop(),i.prototype.hide.call(this))},this.show=function(){this.scrollbar.update(),i.prototype.show.call(this),$(document).scrollTop(this.lastScrollPos)}},s.Prototype.prototype=i.prototype,s.prototype=new s.Prototype,s.prototype.constructor=s,t.exports=s},{"../lens_surface":129,"./panel_view":142,"./surface_scrollbar":144,underscore:177}],134:[function(e,t){"use strict";var n=e("../container_panel"),r=e("./content_panel_controller"),o=function(){n.call(this,{name:"content",type:"document",container:"content",label:"Content",title:"Content",icon:"fa-align-left"})};o.Prototype=function(){this.createController=function(e){return new r(e,this.config)}},o.Prototype.prototype=n.prototype,o.prototype=new o.Prototype,t.exports=o},{"../container_panel":131,"./content_panel_controller":135}],135:[function(e,t){"use strict";var n=e("../container_panel_controller"),r=e("./content_panel_view"),o=function(e,t){n.call(this,e,t)};o.Prototype=function(){this.createView=function(){if(!this.view){var e=this.getDocument(),t=e.constructor.ViewFactory,n=new t(e.nodeTypes,this.config);this.view=new r(this,n,this.config)}return this.view}},o.Prototype.prototype=n.prototype,o.prototype=new o.Prototype,t.exports=o},{"../container_panel_controller":132,"./content_panel_view":136}],136:[function(e,t){"use strict";var n=e("underscore"),r=e("../container_panel_view"),o=e("./toc_panel_view"),i=e("substance-data"),s=(i.Graph.Index,0),a=function(e,t,i){r.call(this,e,t,i),this.tocView=new o(e,t,n.extend({},i,{type:"resource",name:"toc"})),this._onTocItemSelected=n.bind(this.onTocItemSelected,this),this.resources=e.getDocument().addIndex("referenceByTarget",{types:["resource_reference"],property:"target"}),this.tocView.toc.on("toc-item-selected",this._onTocItemSelected),this.$el.addClass("document")};a.Prototype=function(){this.dispose=function(){this.tocView.toc.off("toc-item-selected",this._onTocItemSelected),this.stopListening()},this.getTocView=function(){return this.tocView},this.onScroll=function(){var e=this.surface.$el.scrollTop();this.scrollbar.update(),this.markActiveHeading(e)},this.onTocItemSelected=function(e){var t=this.findNodeView(e);if(t){var n=$(t).position().top+s;this.surface.$el.scrollTop(n)}},this.markActiveHeading=function(e){var t=$(".nodes").height(),r=this.getDocument().getHeadings();if(0!==r.length){var o=n.first(r).id;this.$(".content-node.heading").each(function(){e>=$(this).position().top+s&&(o=this.dataset.id)}),e+this.$el.height()>=t&&(o=n.last(r).id),this.tocView.setActiveNode(o)}},this.markReferencesTo=function(e){var t=this.resources.get(e);n.each(t,function(e){$(this.findNodeView(e.id)).addClass("active")},this)},this.removeHighlights=function(){r.prototype.removeHighlights.call(this),this.$el.find(".content-node.active").removeClass("active"),this.$el.find(".annotation.active").removeClass("active")}},a.Prototype.prototype=r.prototype,a.prototype=new a.Prototype,a.prototype.constructor=a,t.exports=a},{"../container_panel_view":133,"./toc_panel_view":138,"substance-data":157,underscore:177}],137:[function(e,t){t.exports=e("./content_panel")},{"./content_panel":134}],138:[function(e,t){"use strict";var n=e("./toc_view"),r=e("../panel_view"),o=function(e,t,o){r.call(this,e,o),this.toc=new n(e.getDocument(),t)};o.Prototype=function(){this.render=function(){return this.el.appendChild(this.toc.render().el),this},this.setActiveNode=function(e){this.toc.setActiveNode(e)},this.onToggle=function(e){this.trigger("toggle","toc"),e.preventDefault(),e.stopPropagation()}},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,t.exports=o},{"../panel_view":142,"./toc_view":139}],139:[function(e,t){"use strict";var n=e("substance-application").View,r=(e("substance-application").$$,e("substance-data")),o=(r.Graph.Index,e("underscore")),i=function(e,t){n.call(this),this.doc=e,this.viewFactory=t,this.$el.addClass("toc")};i.Prototype=function(){this.render=function(){var e=-1,t=this.doc.getTocNodes();return t.length<2?this:(o.each(t,function(t){var n=this.viewFactory.createView(t),r=t.getLevel();-1===r?r=e+1:e=r;var i=n.renderTocItem(),s=$(i);i.id="toc_"+t.id,s.addClass("heading-ref"),s.addClass("level-"+r),s.click(o.bind(this.onClick,this,t.id)),this.el.appendChild(i)},this),this)},this.setActiveNode=function(e){this.$(".heading-ref.active").removeClass("active"),this.$("#toc_"+e).addClass("active")},this.onClick=function(e){this.trigger("toc-item-selected",e)}},i.Prototype.prototype=n.prototype,i.prototype=new i.Prototype,t.exports=i},{"substance-application":151,"substance-data":157,underscore:177}],140:[function(e,t){"use strict";var n=function(e){this.config=e,this.config.label=e.title};n.Prototype=function(){this.createController=function(){throw new Error("this method is abstract")},this.getName=function(){return this.config.name},this.getConfig=function(){return this.config}},n.prototype=new n.Prototype,n.prototype.constructor=n,t.exports=n},{}],141:[function(e,t){"use strict";var n=e("substance-application").Controller,r=(e("underscore"),e("substance-util"),function(e,t){this.document=e,this.config=t});r.Prototype=function(){n.prototype;this.createView=function(){throw new Error("this is an abstract method")},this.getConfig=function(){return this.config},this.getName=function(){return this.config.name},this.getDocument=function(){return this.document}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,t.exports=r},{"substance-application":151,"substance-util":169,underscore:177}],142:[function(e,t){var n=e("underscore"),r=e("substance-application"),o=r.$$,i=r.View,s=function(e,t){i.call(this),this.controller=e,this.config=t,this.doc=e.getDocument(),this.name=t.name,this.toggleEl=o("a.context-toggle."+this.name,{title:this.config.title,html:'<i class="fa '+this.config.icon+'"></i><div class="label">'+this.config.label+"</div><span> "+this.config.label+"</span>"}),this.$toggleEl=$(this.toggleEl),this.$el.addClass("panel").addClass(this.name),"resource"===this.config.type&&this.$el.addClass("resource-view"),this._onToggle=n.bind(this.onToggle,this),this._onToggleResource=n.bind(this.onToggleResource,this),this._onToggleResourceReference=n.bind(this.onToggleResourceReference,this),this._onToggleFullscreen=n.bind(this.onToggleFullscreen,this),this.$toggleEl.click(this._onToggle),this.$el.on("click",".action-toggle-resource",this._onToggleResource),this.$el.on("click",".toggle-fullscreen",this._onToggleFullscreen),this.$el.on("click",".annotation.resource-reference",this._onToggleResourceReference),this.highlightedNodes=[]};s.Prototype=function(){this.dispose=function(){this.$toggleEl.off("click",this._onClick),this.$el.off("scroll",this._onScroll),this.$el.off("click",".a.action-toggle-resource",this._onToggleResource),this.$el.off("click",".a.toggle-fullscreen",this._onToggleFullscreen),this.$el.off("click",".annotation.reference",this._onToggleResourceReference),this.stopListening()},this.onToggle=function(e){this.trigger("toggle",this.name),e.preventDefault(),e.stopPropagation()},this.getToggleControl=function(){return this.toggleEl},this.hasScrollbar=function(){return!1},this.show=function(){this.$el.removeClass("hidden"),this.hidden=!1},this.hide=function(){this.hidden||(this.$el.addClass("hidden"),this.$toggleEl.removeClass("active"),this.hidden=!0)},this.isHidden=function(){return this.hidden},this.activate=function(){this.show(),$("#main .article")[0].dataset.context=this.name,this.$toggleEl.addClass("active")},this.addHighlight=function(e,t){var n=this.findNodeView(e);if(n){var r=$(n);r.addClass(t),this.highlightedNodes.push({$el:r,cssClass:t})}},this.removeHighlights=function(){for(var e=0;e<this.highlightedNodes.length;e++){var t=this.highlightedNodes[e];t.$el.removeClass(t.cssClass)}this.highlightedNodes=[]},this.showToggle=function(){this.$toggleEl.removeClass("hidden")},this.hideToggle=function(){this.$toggleEl.addClass("hidden")},this.getDocument=function(){return this.doc},this.findNodeView=function(e){return this.el.querySelector("*[data-id="+e+"]")},this.onToggleResource=function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget).parents(".content-node")[0],n=t.dataset.id;this.trigger("toggle-resource",this.name,n,t)},this.onToggleResourceReference=function(e){e.preventDefault(),e.stopPropagation();var t=e.currentTarget,n=e.currentTarget.dataset.id;this.trigger("toggle-resource-reference",this.name,n,t)},this.onToggleFullscreen=function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget).parents(".content-node")[0],n=t.dataset.id;this.trigger("toggle-fullscreen",this.name,n,t)}},s.Prototype.prototype=i.prototype,s.prototype=new s.Prototype,s.prototype.constructor=s,t.exports=s},{"substance-application":151,underscore:177}],143:[function(e,t){var n=e("lens-article").ViewFactory,r=function(e,t){n.call(this,e),this.options=t||{},void 0===this.options.header&&(this.options.header=!0),void 0===this.options.zoom&&(this.options.zoom=r.enableZoom)};r.Prototype=function(){this.createView=function(e,t,n){t=t||{};var r=this.getNodeViewClass(e,n);t.topLevel&&r.prototype.isResourceView&&this.options.header&&(t.header=!0,r.prototype.isZoomable&&this.options.zoom&&(t.zoom=!0));var o=new r(e,this,t);return o}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.enableZoom=!1,t.exports=r},{"lens-article":5}],144:[function(e,t){"use strict";var n=e("substance-application").View,r=e("substance-application").$$,o=e("underscore"),i=function(e){n.call(this),this.surface=e,this.$nodes=this.surface.$nodes,this.$el.addClass("surface-scrollbar"),this.$el.addClass(e.docCtrl.getContainer().id),this.overlays=[],o.bindAll(this,"mouseDown","mouseUp","mouseMove","updateVisibleArea"),this.$el.mousedown(this.mouseDown),$(window).mousemove(this.mouseMove),$(window).mouseup(this.mouseUp)};i.Prototype=function(){this.render=function(){var e=this.$nodes.height(),t=this.surface.$el.height();return this.factor=e/t,this.visibleArea=r(".visible-area"),this.scrollTop=this.surface.$el.scrollTop(),this.el.innerHTML="",this.el.appendChild(this.visibleArea),this.updateVisibleArea(),this},this.updateVisibleArea=function(){$(this.visibleArea).css({top:this.scrollTop/this.factor,height:this.surface.$el.height()/this.factor})},this.addOverlay=function(e){var t=$("<div>").addClass("node overlay");return this.overlays.push({el:e,$overlay:t}),this.$el.append(t),t},this.updateOverlay=function(e,t){var n=$(e),r=n.outerHeight(!0)/this.factor,o=(n.offset().top-this.surfaceTop)/this.factor;r<i.OverlayMinHeight&&(r=i.OverlayMinHeight,o-=.5*i.OverlayMinHeight),t.css({height:r,top:o})},this.addHighlight=function(e,t){var n=this.surface.findNodeView(e);if(n){var r=this.addOverlay(n);return this.updateOverlay(n,r),r.addClass(t),r[0]}},this.addHighlights=function(e,t){for(var n=[],r=0;r<e.length;r++){var o=this.addHighlight(e[r],t);n.push(o)}return this.update(),n},this.removeHighlights=function(){for(var e=0;e<this.overlays.length;e++){var t=this.overlays[e];t.$overlay.remove()}},this.update=function(){var e=this.$nodes.height(),t=this.surface.$el.height();e>t?$(this.el).removeClass("hidden"):$(this.el).addClass("hidden"),this.factor=e/t,this.surfaceTop=this.$nodes.offset().top,this.scrollTop=this.surface.$el.scrollTop(),this.updateVisibleArea();for(var n=0;n<this.overlays.length;n++){var r=this.overlays[n];this.updateOverlay(r.el,r.$overlay)}},this.mouseDown=function(e){this._mouseDown=!0;var t=e.pageY;return e.target!==this.visibleArea?(this.offset=$(this.visibleArea).height()/2,this.mouseMove(e)):this.offset=t-$(this.visibleArea).position().top,!1},this.mouseUp=function(){this._mouseDown=!1},this.mouseMove=function(e){if(this._mouseDown){var t=e.pageY,n=(t-this.offset)*this.factor;this.scrollTop=this.surface.$el.scrollTop(n),this.updateVisibleArea()}},this.onScroll=function(){this.surface&&(this.scrollTop=this.surface.$el.scrollTop(),this.updateVisibleArea())}},i.Prototype.prototype=n.prototype,i.prototype=new i.Prototype,i.OverlayMinHeight=5,t.exports=i},{"substance-application":151,underscore:177}],145:[function(e,t){"use strict";var n=e("underscore"),r=e("substance-application").Controller,o=e("./reader_view"),i=e("./panels/content"),s=function(e,t,r){this.__document=e,this.options=r||{},this.panels=r.panels,this.contentPanel=new i(e),this.panelCtrls={},this.panelCtrls.content=this.contentPanel.createController(e),n.each(this.panels,function(t){this.panelCtrls[t.getName()]=t.createController(e)},this),this.workflows=r.workflows||[],this.state=t,this.currentPanel="toc"};s.Prototype=function(){this.createView=function(){return this.view||(this.view=new o(this)),this.view},this.switchPanel=function(e){this.currentPanel=e,this.modifyState({panel:e,focussedNode:null,fullscreen:!1})},this.getDocument=function(){return this.__document}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,t.exports=s},{"./panels/content":137,"./reader_view":146,"substance-application":151,underscore:177}],146:[function(e,t){"use strict";var n=e("underscore"),r=e("substance-application").View,o=e("substance-data"),i=o.Graph.Index,s=e("substance-application").$$,a=function(e){r.call(this),this.readerCtrl=e,this.doc=this.readerCtrl.getDocument(),this.$el.addClass("article"),this.$el.addClass(this.doc.schema.id),this.bodyScroll={},this.contentView=e.panelCtrls.content.createView(),this.tocView=this.contentView.getTocView(),this.panelViews={},this.panelForRef={},n.each(e.panels,function(t){var r=t.getName(),o=e.panelCtrls[r];this.panelViews[r]=o.createView(),n.each(t.config.references,function(e){this.panelForRef[e]=r},this)},this),this.panelViews.toc=this.tocView,this.resources=new i(this.readerCtrl.getDocument(),{types:["resource_reference"],property:"target"}),this.lastWorkflow=null,this.lastPanel="toc",this._onTogglePanel=n.bind(this.switchPanel,this),this.listenTo(this.readerCtrl,"state-changed",this.updateState),this.listenTo(this.tocView,"toggle",this._onTogglePanel),n.each(this.panelViews,function(e){this.listenTo(e,"toggle",this._onTogglePanel),this.listenTo(e,"toggle-resource",this.onToggleResource),this.listenTo(e,"toggle-resource-reference",this.onToggleResourceReference),this.listenTo(e,"toggle-fullscreen",this.onToggleFullscreen)},this),this.listenTo(this.contentView,"toggle",this._onTogglePanel),this.listenTo(this.contentView,"toggle-resource",this.onToggleResource),this.listenTo(this.contentView,"toggle-resource-reference",this.onToggleResourceReference),this.listenTo(this.contentView,"toggle-fullscreen",this.onToggleFullscreen),n.each(this.readerCtrl.workflows,function(e){e.attach(this.readerCtrl,this)},this),$(window).resize(n.debounce(n.bind(function(){this.contentView.scrollbar.update();var e=this.panelViews[this.readerCtrl.state.panel];e&&e.hasScrollbar()&&e.scrollbar.update(),this.detectRenderMode()},this),1))};a.Prototype=function(){this.detectRenderMode=function(){this.renderMode=$(window).width()<=850?"mobile":"desktop"},this.render=function(){var e=document.createDocumentFragment();e.appendChild(this.contentView.render().el);var t=s(".context-toggles");t.appendChild(this.tocView.getToggleControl()),this.tocView.on("toggle",this._onClickPanel),n.each(this.readerCtrl.panels,function(e){var n=this.panelViews[e.getName()],r=n.getToggleControl();t.appendChild(r),n.on("toggle",this._onClickPanel)},this);var r=s(".medial-strip");r.appendChild(s(".separator-line")),r.appendChild(t),e.appendChild(r);var o=s(".resources");return o.appendChild(this.tocView.render().el),n.each(this.readerCtrl.panels,function(e){var t=this.panelViews[e.getName()];o.appendChild(t.render().el)},this),e.appendChild(o),this.el.appendChild(e),n.delay(n.bind(function(){this.updateState();var e=this;window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub]),window.MathJax.Hub.Queue(function(){console.log("Updating after MathJax has finished."),e.updateState()})},this),1),this.detectRenderMode(),this},this.dispose=function(){n.each(this.workflows,function(e){e.detach()}),this.contentView.dispose(),n.each(this.panelViews,function(e){e.off("toggle",this._onClickPanel),e.dispose()}),this.resources.dispose(),this.stopListening()},this.getState=function(){return this.readerCtrl.state},this.switchPanel=function(e){this.readerCtrl.switchPanel(e),this.lastPanel=e},this.updateState=function(){var e,t=this,r=this.readerCtrl.state,o={focussedNode:r.focussedNode?this.doc.get(r.focussedNode):null},i="content"===r.panel?this.contentView:this.panelViews[r.panel];if(n.each(this.panelViews,function(e){e.isHidden()||e.hide()}),this.contentView.removeHighlights(),n.each(this.panelViews,function(e){e.removeHighlights()}),r.focussedNode){var s=["focussed","highlighted"];r.fullscreen&&s.push("fullscreen"),i.addHighlight(r.focussedNode,s.join(" ")),i.scrollTo(r.focussedNode)}if(this.lastWorkflow&&(e=this.lastWorkflow.handleStateUpdate(r,o)),!e)for(var a=0;a<this.readerCtrl.workflows.length;a++){var c=this.readerCtrl.workflows[a];if(c!==this.lastWorkflow&&c.handlesStateUpdate&&(e=c.handleStateUpdate(r,o))){this.lastWorkflow=c;break}}if(!e)if("content"!==r.panel){var u=this.panelViews[r.panel];if(this.showPanel(r.panel),r.focussedNode){var l=this.resources.get(r.focussedNode);n.each(l,function(e){this.contentView.addHighlight(e.id,"highlighted ")},this),u.hasScrollbar()&&u.scrollTo(r.focussedNode)}}else this.showPanel("toc");t.updateScrollbars(),n.delay(function(){t.updateScrollbars()},2e3)},this.updateScrollbars=function(){this.readerCtrl.state;this.contentView.scrollbar.update(),n.each(this.panelViews,function(e){e.hasScrollbar()&&e.scrollbar.update()})},this.showPanel=function(e){this.panelViews[e]?(this.panelViews[e].activate(),this.el.dataset.context=e):"content"===e&&(this.panelViews.toc.activate(),this.el.dataset.context=e)},this.getPanelView=function(e){return this.panelViews[e]},this.onToggleResource=function(e,t,n){this.readerCtrl.modifyState(n.classList.contains("highlighted")?{panel:this.lastPanel,focussedNode:null,fullscreen:!1}:{panel:e,focussedNode:t})},this.onToggleResourceReference=function(e,t,n){this.readerCtrl.modifyState(n.classList.contains("highlighted")?{panel:this.lastPanel,focussedNode:null,fullscreen:!1}:{panel:"content",focussedNode:t,fullscreen:!1})},this.onToggleFullscreen=function(e,t){var n=!this.readerCtrl.state.fullscreen;this.readerCtrl.modifyState({panel:e,focussedNode:t,fullscreen:n})}},a.Prototype.prototype=r.prototype,a.prototype=new a.Prototype,a.prototype.constructor=a,t.exports=a},{"substance-application":151,"substance-data":157,underscore:177}],147:[function(e,t){"use strict";var n=e("underscore"),r=e("./workflow"),o=function(){r.apply(this,arguments),this._followCrossReference=n.bind(this.followCrossReference,this)};o.Prototype=function(){this.registerHandlers=function(){this.readerView.$el.on("click",".annotation.cross_reference",this._followCrossReference)},this.unRegisterHandlers=function(){this.readerView.$el.off("click",".annotation.cross_reference",this._followCrossReference)},this.followCrossReference=function(e){e.preventDefault(),e.stopPropagation();var t=e.currentTarget.dataset.id,n=this.readerCtrl.getDocument().get(t);this.readerView.contentView.scrollTo(n.target)}},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,t.exports=o},{"./workflow":150,underscore:177}],148:[function(t,n){"use strict";var r=t("underscore"),o=t("./workflow"),i=function(){o.apply(this,arguments),this._gotoTop=r.bind(this.gotoTop,this)};i.Prototype=function(){this.registerHandlers=function(){this.readerView.$el.on("click",".document .content-node.heading .top",this._gotoTop)},this.unRegisterHandlers=function(){this.readerView.$el.off("click",".document .content-node.heading .top",this._gotoTop)},this.gotoTop=function(){e.preventDefault(),e.stopPropagation(),this.readerCtrl.contentView.jumpToNode("cover"),$(document).scrollTop(0)}},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,n.exports=i},{"./workflow":150,underscore:177}],149:[function(e,t){"use strict";var n=e("underscore"),r=e("./workflow"),o=function(){r.apply(this,arguments)};o.Prototype=function(){this.registerHandlers=function(){},this.unRegisterHandlers=function(){},this.handlesStateUpdate=!0,this.handleStateUpdate=function(e,t){if(t.focussedNode&&this.readerView.panelForRef[t.focussedNode.type]){var r=t.focussedNode,o=this.readerView.panelForRef[r.type],i=this.readerView.panelViews[o],s=this.readerView.contentView,a=r.target;i.activate();var c=["highlighted"];i.addHighlight(a,c.join(" ")),i.scrollTo(a);var u=this.readerView.resources.get(a);return delete u[r.id],n.each(u,function(e){s.addHighlight(e.id,"highlighted")},this),!0}return!1}},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,t.exports=o},{"./workflow":150,underscore:177}],150:[function(e,t){"use strict";var n=function(){this.readerController=null,this.readerView=null};n.Prototype=function(){this.attach=function(e,t){this.readerCtrl=e,this.readerView=t,this.registerHandlers()},this.detach=function(){this.unRegisterHandlers(),this.readerView=null,this.readerController=null},this.registerHandlers=function(){throw new Error("This method is abstract")},this.unRegisterHandlers=function(){throw new Error("This method is abstract")},this.handlesStateUpdate=!1,this.handleStateUpdate=function(){throw new Error("This method is abstract")}},n.prototype=new n.Prototype,t.exports=n},{}],151:[function(e,t){"use strict";var n=e("./src/application");n.View=e("./src/view"),n.Router=e("./src/router"),n.Controller=e("./src/controller"),n.ElementRenderer=e("./src/renderers/element_renderer"),n.$$=n.ElementRenderer.$$,t.exports=n},{"./src/application":152,"./src/controller":153,"./src/renderers/element_renderer":154,"./src/router":155,"./src/view":156}],152:[function(e,t){"use strict";var n=e("./view"),r=e("./router"),o=(e("substance-util"),e("underscore")),i=function(e){n.call(this),this.config=e};i.Prototype=function(){this.initRouter=function(){this.router=new r,o.each(this.config.routes,function(e){this.router.route(e.route,e.name,o.bind(this.controller[e.command],this.controller))},this),r.history.start()},this.start=function(){this.$el=$("body"),this.el=this.$el[0],this.render(),this.initRouter()}},i.Prototype.prototype=n.prototype,i.prototype=new i.Prototype,t.exports=i},{"./router":155,"./view":156,"substance-util":169,underscore:177}],153:[function(e,t){"use strict";var n=e("substance-util"),r=e("underscore"),o=function(){this.state={},this.context=null};o.Prototype=function(){this.updateState=function(e,t){console.error("updateState is deprecated, use modifyState. State is now a rich object where context replaces the old state variable");var n=this.context;this.context=e,this.state=t,this.trigger("state-changed",this.context,n,t)},this.modifyState=function(e){var t=this.state.context;r.extend(this.state,e),e.context&&e.context!==t&&this.trigger("context-changed",e.context),this.trigger("state-changed",this.state.context)}},o.Prototype.prototype=n.Events,o.prototype=new o.Prototype,t.exports=o
},{"substance-util":169,underscore:177}],154:[function(e,t){"use strict";var n=e("substance-util"),r=n.RegExp,o=function(e){return this.attributes=e,this.tagName=e.tag,this.children=e.children||[],this.text=e.text||"",this.html=e.html,delete e.children,delete e.text,delete e.html,delete e.tag,this.render()};o.Prototype=function(){this.render=function(){var e=document.createElement(this.tagName);this.html?e.innerHTML=this.html:e.textContent=this.text;for(var t in this.attributes){var n=this.attributes[t];e.setAttribute(t,n)}for(var r=0;r<this.children.length;r++){var o=this.children[r];e.appendChild(o)}return this.el=e,e}};var i=function(e,t){var t=t||{},n=/^([a-zA-Z0-9]*)/.exec(e);t.tag=n&&n[1]?n[1]:"div";var i=/#([a-zA-Z0-9_]*)/.exec(e);i&&i[1]&&(t.id=i[1]);var s=new r(/\.([a-zA-Z0-9_-]*)/g);return t["class"]||(t["class"]=s.match(e).map(function(e){return e.match[1]}).join(" ")),new o(t)};o.$$=i,o.Prototype.prototype=n.Events,o.prototype=new o.Prototype,t.exports=o},{"substance-util":169}],155:[function(e,t){"use strict";var n=e("substance-util"),r=e("underscore"),o=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},i=/\((.*?)\)/g,s=/(\(\?)?:\w+/g,a=/\*\w+/g,c=/[\-{}\[\]+?.,\\\^$|#\s]/g;r.extend(o.prototype,n.Events,{initialize:function(){},route:function(e,t,n){r.isRegExp(e)||(e=this._routeToRegExp(e)),r.isFunction(t)&&(n=t,t=""),n||(n=this[t]);var i=this;return o.history.route(e,function(r){var s=i._extractParameters(e,r);n&&n.apply(i,s),i.trigger.apply(i,["route:"+t].concat(s)),i.trigger("route",t,s),o.history.trigger("route",i,t,s)}),this},navigate:function(e,t){return o.history.navigate(e,t),this},_bindRoutes:function(){if(this.routes){this.routes=r.result(this,"routes");for(var e,t=r.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(c,"\\$&").replace(i,"(?:$1)?").replace(s,function(e,t){return t?e:"([^/]+)"}).replace(a,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return r.map(n,function(e){return e?decodeURIComponent(e):null})}});var u=o.History=function(){this.handlers=[],r.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},l=/^[#\/]|\s+$/g,p=/^\/+|\/+$/g,h=/msie [\w.]+/,d=/\/$/;u.started=!1,r.extend(u.prototype,n.Events,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(d,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(l,"")},start:function(e){if(u.started)throw new Error("Router.history has already been started");u.started=!0,this.options=r.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,o=h.exec(navigator.userAgent.toLowerCase())&&(!n||7>=n);this.root=("/"+this.root+"/").replace(p,"/"),o&&this._wantsHashChange&&(this.iframe=$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!o?$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=this.location,s=i.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&s&&i.hash&&(this.fragment=this.getHash().replace(l,""),this.history.replaceState({},document.title,this.root+this.fragment+i.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),u.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=r.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0});return n},navigate:function(e,t){if(!u.started)return!1;if(t&&t!==!0||(t={trigger:t}),e=this.getFragment(e||""),this.fragment!==e){this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)}},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),o.history=new u,t.exports=o},{"substance-util":169,underscore:177}],156:[function(e,t){"use strict";var n=e("substance-util"),r=function(e){e=e||{};this.el=e.el||window.document.createElement(e.elementType||"div"),this.$el=$(this.el),this.dispatchDOMEvents()};r.Prototype=function(){this.$=function(e){return this.$el.find(e)},this.render=function(){return this},this.dispatchDOMEvents=function(){function e(e){var t=/(\w+)\((.*)\)/.exec(e);if(!t)throw new Error("Invalid click handler '"+e+"'");return{method:t[1],args:t[2].split(",")}}var t=this;this.$el.delegate("[sbs-click]","click",function(n){console.error("FIXME: sbs-click is deprecated. Use jquery handlers with selectors instead.");var r=e($(n.currentTarget).attr("sbs-click")),o=t[r.method];return o?(n.stopPropagation(),n.preventDefault(),o.apply(t,r.args),!1):void 0})}},r.Prototype.prototype=n.Events,r.prototype=new r.Prototype,t.exports=r},{"substance-util":169}],157:[function(e,t){"use strict";var n={};n.VERSION="0.8.0",n.Graph=e("./src/graph"),t.exports=n},{"./src/graph":158}],158:[function(e,t){"use strict";var n=e("underscore"),r=e("substance-util"),o=r.errors,i=e("./schema"),s=e("./property"),a=e("./graph_index"),c=o.define("GraphError"),u=["object","array","string","number","boolean","date"],l=function(e){return n.isArray(e)&&(e=e[0]),u.indexOf(e)>=0},p=function(e,t){if(t=t||{},this.schema=new i(e),this.schema.id&&t.seed&&t.seed.schema&&!n.isEqual(t.seed.schema,[this.schema.id,this.schema.version]))throw new c(["Graph does not conform to schema. Expected: ",this.schema.id+"@"+this.schema.version," Actual: ",t.seed.schema[0]+"@"+t.seed.schema[1]].join(""));this.nodes={},this.indexes={},this.__seed__=t.seed,this.init()};p.Prototype=function(){n.extend(this,r.Events),this.create=function(e){this.nodes[e.id]=e,this._updateIndexes({type:"create",path:[e.id],val:e})},this["delete"]=function(e){var t=this.nodes[e];delete this.nodes[e],this._updateIndexes({type:"delete",path:[e],val:t})},this.set=function(e,t){var n=this.resolve(e);if(!n)throw new c("Could not resolve property with path "+JSON.stringify(e));var r=n.get();n.set(t),this._updateIndexes({type:"set",path:e,val:t,original:r})},this.get=function(e){if(!n.isArray(e)&&!n.isString(e))throw new c("Invalid argument path. Must be String or Array");if(arguments.length>1&&(e=n.toArray(arguments)),n.isString(e))return this.nodes[e];var t=this.resolve(e);return t.get()},this.query=function(e){var t=this.resolve(e),n=t.type,r=t.baseType,o=t.get();return"array"===r?this._queryArray.call(this,o,n):l(r)?o:this.get(o)},this.toJSON=function(){return{id:this.id,schema:[this.schema.id,this.schema.version],nodes:r.deepclone(this.nodes)}},this.contains=function(e){return!!this.nodes[e]},this.resolve=function(e){return new s(this,e)},this.reset=function(){this.init(),this.trigger("graph:reset")},this.init=function(){this.__is_initializing__=!0,this.nodes=this.__seed__?r.clone(this.__seed__.nodes):{},n.each(this.indexes,function(e){e.reset()}),delete this.__is_initializing__},this.addIndex=function(e,t){if(this.indexes[e])throw new c("Index with name "+e+"already exists.");var n=new a(this,t);return this.indexes[e]=n,n},this.removeIndex=function(e){delete this.indexes[e]},this._updateIndexes=function(e){n.each(this.indexes,function(t){e?t.onGraphChange(e):t.rebuild()},this)},this._queryArray=function(e,t){if(!n.isArray(t))throw new c("Illegal argument: array types must be specified as ['array'(, 'array')*, <type>]");var r,o;if("array"===t[1])for(r=[],o=0;o<e.length;o++)r.push(this._queryArray(e[o],t.slice(1)));else if(l(t[1]))r=e;else for(r=[],o=0;o<e.length;o++)r.push(this.get(e[o]));return r}},p.STRICT_INDEXING=2,p.DEFAULT_MODE=p.STRICT_INDEXING,p.prototype=new p.Prototype,p.Schema=i,p.Property=s,p.Index=a,t.exports=p},{"./graph_index":159,"./property":160,"./schema":161,"substance-util":169,underscore:177}],159:[function(e,t){var n=e("underscore"),r=e("substance-util"),o=function(e,t){t=t||{},this.graph=e,this.nodes={},this.scopes={},t.filter?this.filter=t.filter:t.types&&(this.filter=o.typeFilter(e.schema,t.types)),t.property&&(this.property=t.property),this.createIndex()};o.Prototype=function(){var e=function(e){var t=this;if(null!==e)for(var n=0;n<e.length;n++){var r=e[n];t.scopes[r]=t.scopes[r]||{nodes:{},scopes:{}},t=t.scopes[r]}return t},t=function(e){if(!this.property)return null;var t=e[this.property]?e[this.property]:null;return n.isString(t)&&(t=[t]),t},r=function(e){var t=n.extend({},e.nodes);return n.each(e.scopes,function(e,o){"nodes"!==o&&n.extend(t,r(e))}),t};this.onGraphChange=function(e){this.applyOp(e)},this._add=function(n){if(!this.filter||this.filter(n)){var r=t.call(this,n),o=e.call(this,r);o.nodes[n.id]=n.id}},this._remove=function(n){if(!this.filter||this.filter(n)){var r=t.call(this,n),o=e.call(this,r);delete o.nodes[n.id]}},this._update=function(t,r,o,i){if(this.property===r&&(!this.filter||this.filter(t))){var s=i;n.isString(s)&&(s=[s]);var a=e.call(this,s);delete a.nodes[t.id],s=o,a.nodes[t.id]=t.id}},this.applyOp=function(e){if("create"===e.type)this._add(e.val);else if("delete"===e.type)this._remove(e.val);else{var t,n=this.graph.resolve(this,e.path),r=n.get();if(void 0===r)return;"set"===e.type?t=e.original:console.error("Operational updates are not supported in this implementation"),this._update(n.node,n.key,r,t)}},this.createIndex=function(){this.reset();var r=this.graph.nodes;n.each(r,function(n){if(!this.filter||this.filter(n)){var r=t.call(this,n),o=e.call(this,r);o.nodes[n.id]=n.id}},this)},this.get=function(t){0===arguments.length?t=null:n.isString(t)&&(t=[t]);var i=e.call(this,t),s=r(i),a=new o.Result;return n.each(s,function(e){a[e]=this.graph.get(e)},this),a},this.reset=function(){this.nodes={},this.scopes={}},this.dispose=function(){this.stopListening()},this.rebuild=function(){this.reset(),this.createIndex()}},o.prototype=n.extend(new o.Prototype,r.Events.Listener),o.typeFilter=function(e,t){return function(n){for(var r=e.typeChain(n.type),o=0;o<t.length;o++)if(r.indexOf(t[o])>=0)return!0;return!1}},o.Result=function(){},o.Result.prototype.asList=function(){var e=[];for(var t in this)e.push(this[t])},o.Result.prototype.getLength=function(){return Object.keys(this).length},t.exports=o},{"substance-util":169,underscore:177}],160:[function(e,t){"use strict";var n=e("underscore"),r=function(e,t){if(!t)throw new Error("Illegal argument: path is null/undefined.");this.graph=e,this.schema=e.schema,n.extend(this,this.resolve(t))};r.Prototype=function(){this.resolve=function(e){for(var t,n,r=this.graph,o=r,i="graph",s=0;s<e.length;s++)if("graph"===i||void 0!==this.schema.types[i]){if(o=this.graph.get(e[s]),void 0===o)return void 0;r=o,i=this.schema.properties(o.type),n=r,t=void 0}else{if(void 0===o)return void 0;t=e[s];var a=e[s];i=i[a],n=o[t],s<e.length-1&&(o=o[a])}return{node:r,parent:o,type:i,key:t,value:n}},this.get=function(){return void 0!==this.key?this.parent[this.key]:this.node},this.set=function(e){if(void 0===this.key)throw new Error("'set' is only supported for node properties.");this.parent[this.key]=this.schema.parseValue(this.baseType,e)}},r.prototype=new r.Prototype,Object.defineProperties(r.prototype,{baseType:{get:function(){return n.isArray(this.type)?this.type[0]:this.type}},path:{get:function(){return[this.node.id,this.key]}}}),t.exports=r},{underscore:177}],161:[function(e,t){"use strict";var n=e("underscore"),r=e("substance-util"),o=function(e){n.extend(this,e)};o.Prototype=function(){this.defaultValue=function(e){return"object"===e?{}:"array"===e?[]:"string"===e?"":"number"===e?0:"boolean"===e?!1:"date"===e?new Date:null},this.parseValue=function(e,t){if(null===t)return t;if(n.isString(t)){if("object"===e)return JSON.parse(t);if("array"===e)return JSON.parse(t);if("string"===e)return t;if("number"===e)return parseInt(t,10);if("boolean"===e){if("true"===t)return!0;if("false"===t)return!1;throw new Error("Can not parse boolean value from: "+t)}return"date"===e?new Date(t):t}if("array"===e){if(!n.isArray(t))throw new Error("Illegal value type: expected array.");t=r.deepclone(t)}else if("string"===e){if(!n.isString(t))throw new Error("Illegal value type: expected string.")}else if("object"===e){if(!n.isObject(t))throw new Error("Illegal value type: expected object.");t=r.deepclone(t)}else if("number"===e){if(!n.isNumber(t))throw new Error("Illegal value type: expected number.")}else if("boolean"===e){if(!n.isBoolean(t))throw new Error("Illegal value type: expected boolean.")}else{if("date"!==e)throw new Error("Unsupported value type: "+e);t=new Date(t)}return t},this.type=function(e){return this.types[e]},this.typeChain=function(e){var t=this.types[e];if(!t)throw new Error("Type "+e+" not found in schema");var n=t.parent?this.typeChain(t.parent):[];return n.push(e),n},this.isInstanceOf=function(e,t){var n=this.typeChain(e);return n&&n.indexOf(t)>=0?!0:!1},this.baseType=function(e){return this.typeChain(e)[0]},this.properties=function(e){e=n.isObject(e)?e:this.type(e);var t=e.parent?this.properties(e.parent):{};return n.extend(t,e.properties),t},this.propertyType=function(e,t){var r=this.properties(e),o=r[t];if(!o)throw new Error("Property not found for"+e+"."+t);return n.isArray(o)?o:[o]},this.propertyBaseType=function(e,t){return this.propertyType(e,t)[0]}},o.prototype=new o.Prototype,t.exports=o},{"substance-util":169,underscore:177}],162:[function(e,t){"use strict";var n=(e("underscore"),e("./src/document"));n.Container=e("./src/container"),n.Controller=e("./src/controller"),n.Node=e("./src/node"),n.Composite=e("./src/composite"),n.TextNode=e("./src/text_node"),t.exports=n},{"./src/composite":163,"./src/container":164,"./src/controller":165,"./src/document":166,"./src/node":167,"./src/text_node":168,underscore:177}],163:[function(e,t){var n=e("./node"),r=function(e,t){n.call(this,e,t)};r.type={id:"composite",parent:"content",properties:{}},r.description={name:"Composite",remarks:["A file reference to an external resource."],properties:{}},r.example={no_example:"yet"},r.Prototype=function(){this.getLength=function(){throw new Error("Composite.getLength() is abstract.")},this.getNodes=function(){return this.getChildrenIds()},this.getChildrenIds=function(){throw new Error("Composite.getChildrenIds() is abstract.")},this.isMutable=function(){return!1},this.insertOperation=function(){return null},this.deleteOperation=function(){return null},this.insertChild=function(){throw new Error("This composite is immutable.")},this.deleteChild=function(){throw new Error("This composite is immutable.")},this.getChangePosition=function(){return 0}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,t.exports=r},{"./node":167}],164:[function(e,t){"use strict";var n=e("underscore"),r=e("substance-util"),o=e("./composite"),i=function(e,t){this.document=e,this.view=t,this.treeView=[],this.listView=[],this.__parents={},this.__composites={},this.rebuild()};i.Prototype=function(){var e=function(e,t){var n,r=[];for(n=this.treeView.length-1;n>=0;n--)r.unshift({id:this.treeView[n],parent:null});for(var i,s;r.length>0;){if(i=r.shift(),s=this.document.get(i.id),s instanceof o){var a=s.getNodes();for(n=a.length-1;n>=0;n--)r.unshift({id:a[n],parent:s.id})}e.call(t,s,i.parent)}};this.rebuild=function(){this.treeView.splice(0,this.treeView.length),this.listView.splice(0,this.listView.length),this.treeView=n.clone(this.view.nodes);for(var t=0;t<this.view.length;t++)this.treeView.push(this.view[t]);this.__parents={},this.__composites={},e.call(this,function(e,t){if(e instanceof o)this.__parents[e.id]=t,this.__composites[t]=t;else{if(this.listView.push(e.id),this.__parents[e.id])throw new Error("Nodes must be unique in one view.");this.__parents[e.id]=t,this.__composites[t]=t}},this)},this.getTopLevelNodes=function(){return n.map(this.treeView,function(e){return this.document.get(e)},this)},this.getNodes=function(e){var t=this.listView;if(e)return n.clone(t);for(var r=[],o=0;o<t.length;o++)r.push(this.document.get(t[o]));return r},this.getPosition=function(e){var t=this.listView;return t.indexOf(e)},this.getNodeFromPosition=function(e){var t=this.listView,n=t[e];return void 0!==n?this.document.get(n):null},this.getParent=function(e){return this.__parents[e]},this.getRoot=function(e){for(var t=e;t;)e=t,t=this.getParent(e);return e},this.update=function(e){var t=e.path,n=t[0]===this.view.id||void 0!==this.__composites[t[0]];n&&this.rebuild()},this.getLength=function(){return this.listView.length},this.hasSuccessor=function(e){var t=this.getLength();return t-1>e},this.hasPredecessor=function(e){return e>0},this.getPredecessor=function(e){var t=this.getPosition(e);return 0>=t?null:this.getNodeFromPosition(t-1)},this.getSuccessor=function(e){var t=this.getPosition(e);return t>=this.getLength()-1?null:this.getNodeFromPosition(t+1)},this.firstChild=function(e){if(e instanceof o){var t=this.document.get(e.getNodes()[0]);return this.firstChild(t)}return e},this.lastChild=function(e){if(e instanceof o){var t=this.document.get(n.last(e.getNodes()));return this.lastChild(t)}return e},this.before=function(e){var t=this.firstChild(e),n=this.getPosition(t.id);return[n,0]},this.after=function(e){var t=this.lastChild(e),n=this.getPosition(t.id),r=t.getLength();return[n,r]}},i.prototype=n.extend(new i.Prototype,r.Events.Listener),Object.defineProperties(i.prototype,{id:{get:function(){return this.view.id}},type:{get:function(){return this.view.type}},nodes:{get:function(){return this.view.nodes},set:function(e){this.view.nodes=e}}}),t.exports=i},{"./composite":163,"substance-util":169,underscore:177}],165:[function(e,t){"use strict";var n=e("underscore"),r=e("substance-util"),o=function(e,t){t=t||{},this.view=t.view||"content",this.__document=e,this.container=e.get(this.view)};o.Prototype=function(){this.getNodes=function(e){return this.container.getNodes(e)},this.getContainer=function(){return this.container},this.getPosition=function(e,t){return this.container.getPosition(e,t)},this.getNodeFromPosition=function(e){return this.container.getNodeFromPosition(e)},this.getAnnotations=function(e){return e=e||{},e.view=this.view,this.annotator.getAnnotations(e)},this.get=function(){return this.__document.get.apply(this.__document,arguments)},this.on=function(){return this.__document.on.apply(this.__document,arguments)},this.off=function(){return this.__document.off.apply(this.__document,arguments)},this.getDocument=function(){return this.__document}},o.prototype=n.extend(new o.Prototype,r.Events.Listener),Object.defineProperties(o.prototype,{id:{get:function(){return this.__document.id},set:function(){throw"immutable property"}},nodeTypes:{get:function(){return this.__document.nodeTypes},set:function(){throw"immutable property"}},title:{get:function(){return this.__document.get("document").title},set:function(){throw"immutable property"}},updated_at:{get:function(){return this.__document.get("document").updated_at},set:function(){throw"immutable property"}},creator:{get:function(){return this.__document.get("document").creator},set:function(){throw"immutable property"}}}),t.exports=o},{"substance-util":169,underscore:177}],166:[function(e,t){"use strict";var n=e("underscore"),r=e("substance-util"),o=r.errors,i=e("substance-data"),s=e("./container"),a=o.define("DocumentError"),c=function(e){i.Graph.call(this,e.schema,e),this.containers={},this.addIndex("annotations",{types:["annotation"],property:"path"})};c.schema={indexes:{},types:{content:{properties:{}},view:{properties:{nodes:["array","content"]}}}},c.Prototype=function(){var e=r.prototype(this);this.getIndex=function(e){return this.indexes[e]},this.getSchema=function(){return this.schema},this.create=function(t){return e.create.call(this,t),this.get(t.id)},this.get=function(t){var n=e.get.call(this,t);if(!n)return n;if("view"===n.type)return this.containers[n.id]||(this.containers[n.id]=new s(this,n)),this.containers[n.id];var r=this.nodeTypes[n.type],o=void 0!==r?r.Model:null;return!o||n instanceof o||(n=new o(n,this),this.nodes[n.id]=n),n},this.toJSON=function(){var t=e.toJSON.call(this);return t.id=this.id,t},this.hide=function(e,t){var r=this.get(e);if(!r)throw new a("Invalid view id: "+e);n.isString(t)&&(t=[t]);var o=[];if(n.each(t,function(e){var t=r.nodes.indexOf(e);t>=0&&o.push(t)},this),0!==o.length){o=o.sort().reverse(),o=n.uniq(o);for(var i=this.nodes[e],s=0;s<o.length;s++)i.nodes.splice(o[s],1)}},this.show=function(e,t,n){void 0===n&&(n=-1);var r=this.get(e);if(!r)throw new a("Invalid view id: "+e);var o=r.nodes.length;n=Math.min(n,o),0>n&&(n=Math.max(0,o+n+1)),r.nodes.splice(n,0,t)},this.fromSnapshot=function(e,t){return c.fromSnapshot(e,t)},this.uuid=function(e){return e+"_"+r.uuid()}},c.Prototype.prototype=i.Graph.prototype,c.prototype=new c.Prototype,c.fromSnapshot=function(e,t){return t=t||{},t.seed=e,new c(t)},c.DocumentError=a,t.exports=c},{"./container":164,"substance-data":157,"substance-util":169,underscore:177}],167:[function(e,t){"use strict";var n=e("underscore"),r=function(e,t){this.document=t,this.properties=e};r.type={parent:"content",properties:{}},r.properties={"abstract":!0,immutable:!0,mergeableWith:[],preventEmpty:!0,allowedAnnotations:[]},r.Prototype=function(){this.toJSON=function(){return n.clone(this.properties)},this.getLength=function(){throw new Error("Node.getLength() is abstract.")},this.getChangePosition=function(){throw new Error("Node.getCharPosition() is abstract.")},this.insertOperation=function(){throw new Error("Node.insertOperation() is abstract.")},this.deleteOperation=function(){throw new Error("Node.deleteOperation() is abstract.")},this.canJoin=function(){return!1},this.join=function(){throw new Error("Node.join() is abstract.")},this.isBreakable=function(){return!1},this["break"]=function(){throw new Error("Node.split() is abstract.")},this.getAnnotations=function(){return this.document.getIndex("annotations").get(this.properties.id)},this.includeInToc=function(){return!1}},r.prototype=new r.Prototype,r.prototype.constructor=r,r.defineProperties=function(e,t,r){var o=e;if(1===arguments.length){var i=e;if(o=i.prototype,!o||!i.type)throw new Error("Illegal argument: expected NodeClass");t=Object.keys(i.type.properties)}n.each(t,function(e){var t={get:function(){return this.properties[e]}};r||(t.set=function(t){return this.properties[e]=t,this}),Object.defineProperty(o,e,t)})},r.defineProperties(r.prototype,["id","type"]),t.exports=r},{underscore:177}],168:[function(e,t){"use strict";var n=e("./node"),r=function(e,t){n.call(this,e,t)};r.type={id:"text",parent:"content",properties:{source_id:"Text element source id",content:"string"}},r.description={name:"Text",remarks:["A simple text fragement that can be annotated. Usually text nodes are combined in a paragraph."],properties:{content:"Content"}},r.example={type:"paragraph",id:"paragraph_1",content:"Lorem ipsum dolor sit amet, adipiscing elit."},r.Prototype=function(){this.getLength=function(){return this.properties.content.length}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.defineProperties(r.prototype,["content"]),t.exports=r},{"./node":167}],169:[function(e,t){"use strict";var n=e("./src/util");n.async=e("./src/async"),n.errors=e("./src/errors"),n.html=e("./src/html"),n.dom=e("./src/dom"),n.RegExp=e("./src/regexp"),n.Fragmenter=e("./src/fragmenter"),t.exports=n},{"./src/async":170,"./src/dom":171,"./src/errors":172,"./src/fragmenter":173,"./src/html":174,"./src/regexp":175,"./src/util":176}],170:[function(e,t){"use strict";function n(e,t){function n(e){var t=a[c];if(!t)return l.length>0?r(new Error("Multiple errors occurred.",e)):r(null,e);var s=o.once(function(e,t){if(e){if(u)return r(e,null);l.push(e)}c+=1,n(t)});try{0===t.length?(t(),s(null,e)):1===t.length?t(s):t(e,s)}catch(p){console.log("util.async caught error:",p),i.printStackTrace(p),r(p)}}var r=e["finally"]||function(e,n){t(e,n)};r=o.once(r);var s=e.data||{},a=e.functions;if(!o.isFunction(t))return t("Illegal arguments: a callback function must be provided");var c=0,u=void 0===e.stopOnError?!0:e.stopOnError,l=[];n(s)}function r(e){return function(t,r){function i(e,t){return function(n,r){2===p.length?p(e,r):3===p.length?p(e,t,r):p(e,t,n,r)}}function s(e,t){return function(n,r){2===p.length?p(e,r):3===p.length?p(e,t,r):p(e,t,n,r)}}var a=e.selector?e.selector(t):e.items,c=e["finally"]||function(e,t){r(e,t)};if(c=o.once(c),!a)return c(null,t);var u=o.isArray(a);e.before&&e.before(t);var l=[],p=e.iterator;if(u)for(var h=0;h<a.length;h++)l.push(i(a[h],h));else for(var d in a)l.push(s(a[d],d));var f={functions:l,data:t,"finally":c,stopOnError:e.stopOnError};n(f,r)}}var o=e("underscore"),i=e("./util.js"),s={};s.sequential=function(e,t){o.isArray(e)&&(e={functions:e}),n(e,t)},s.iterator=function(e,t){var n;return n=1==arguments.length?e:{items:e,iterator:t},r(n)},s.each=function(e,t){var n=r(e);n(null,t)},t.exports=s},{"./util.js":176,underscore:177}],171:[function(e,t){"use strict";var n=e("underscore"),r={};r.ChildNodeIterator=function(e){this.nodes=n.isArray(e)?e:e.childNodes,this.length=this.nodes.length,this.pos=-1},r.ChildNodeIterator.prototype={hasNext:function(){return this.pos<this.length-1},next:function(){return this.pos+=1,this.nodes[this.pos]},back:function(){return this.pos>=0&&(this.pos-=1),this}},r.getChildren=function(e){if(void 0!==e.children)return e.children;for(var t=[],n=e.firstElementChild;n;)t.push(n),n=n.nextElementSibling;return t},r.getNodeType=function(e){return e.nodeType===window.Node.TEXT_NODE?"text":e.nodeType===window.Node.COMMENT_NODE?"comment":e.tagName?e.tagName.toLowerCase():(console.error("Can't get node type for ",e),"unknown")},t.exports=r},{underscore:177}],172:[function(e,t){"use strict";var n=e("./util"),r={},o=function(e,t){t?(Error.call(this,e,t.fileName,t.lineNumber),this.__stack=t instanceof o?t.__stack:t.stack?n.parseStackTrace(t):n.callstack(1)):(Error.call(this,e),this.__stack=n.callstack(1)),this.message=e};o.Prototype=function(){this.name="SubstanceError",this.code=-1,this.toString=function(){return this.name+":"+this.message},this.toJSON=function(){return{name:this.name,message:this.message,code:this.code,stack:this.stack}},this.printStackTrace=function(){n.printStackTrace(this)}},o.Prototype.prototype=Error.prototype,o.prototype=new o.Prototype,Object.defineProperty(o.prototype,"stack",{get:function(){for(var e=[],t=0;t<this.__stack.length;t++){var n=this.__stack[t];e.push(n.file+":"+n.line+":"+n.col+" ("+n.func+")")}return e.join("\n")},set:function(){throw new Error("SubstanceError.stack is read-only.")}}),r.SubstanceError=o;var i=function(e,t,n){return function(r){e.call(this,r),this.name=t,this.code=n}};r.define=function(e,t,n){if(!e)throw new o("Name is required.");void 0===t&&(t=-1),n=n||o;var s=i(n,e,t),a=function(){};return a.prototype=n.prototype,s.prototype=new a,s.prototype.constructor=s,r[e]=s,s},t.exports=r},{"./util":176}],173:[function(e,t){"use strict";var n=e("underscore"),r=1,o=-1,i=function(e){this.levels=e||{}};i.Prototype=function(){var e=function(e,t){if(e.pos<t.pos)return-1;if(e.pos>t.pos)return 1;if(e.mode<t.mode)return-1;if(e.mode>t.mode)return 1;if(e.mode===r){if(e.level<t.level)return-1;if(e.level>t.level)return 1}if(e.mode===o){if(e.level>t.level)return-1;if(e.level<t.level)return 1}return 0},t=function(e){var t=[];return n.each(e,function(e){var n=this.levels[e.type]||1e3;void 0!==n&&(t.push({pos:e.range[0],mode:r,level:n,id:e.id,type:e.type,node:e}),t.push({pos:e.range[1],mode:o,level:n,id:e.id,type:e.type,node:e}))},this),t};this.onText=function(){},this.onEnter=function(){return null},this.onExit=function(){},this.enter=function(e,t){return this.onEnter(e,t)},this.exit=function(e,t){this.onExit(e,t)},this.createText=function(e,t){this.onText(e,t)},this.start=function(n,i,s){var a=t.call(this,s);a.sort(e.bind(this));for(var c=[{context:n,entry:null}],u=0,l=0;l<a.length;l++){var p=a[l];this.createText(c[c.length-1].context,i.substring(u,p.pos)),u=p.pos;var h,d=1;if(p.mode===r){for(;d<c.length&&!(p.level<c[d].entry.level);d++);c.splice(d,0,{entry:p})}else if(p.mode===o){for(;d<c.length&&c[d].entry.id!==p.id;d++);for(h=d;h<c.length;h++)this.exit(c[h].entry,c[h-1].context);c.splice(d,1)}for(h=d;h<c.length;h++)c[h].context=this.enter(c[h].entry,c[h-1].context)}this.createText(n,i.substring(u))}},i.prototype=new i.Prototype,t.exports=i},{underscore:177}],174:[function(e,t){"use strict";var n={},r=e("underscore");n.templates={},n.renderTemplate=function(e,t){return n.templates[e](t)},"undefined"!=typeof window&&(window.console||(window.console={log:function(){}})),n.tpl=function(e,t){t=t||{};var n=window.$("script[name="+e+"]").html();return r.template(n,t)},t.exports=n},{underscore:177}],175:[function(e,t){"use strict";var n=function(e){this.index=e.index,this.match=[];for(var t=0;t<e.length;t++)this.match.push(e[t])};n.Prototype=function(){this.captures=function(){return this.match.slice(1)},this.toString=function(){return this.match[0]}},n.prototype=new n.Prototype;var r=function(e){this.exp=e};r.Prototype=function(){this.match=function(e){if(void 0===e)throw new Error("No string given");if(this.exp.global){var t,r=[];for(this.exp.compile(this.exp);null!==(t=this.exp.exec(e));)r.push(new n(t));return r}return this.exp.exec(e)}},r.prototype=new r.Prototype,r.Match=n,t.exports=r},{}],176:[function(e,t){"use strict";var n=e("underscore"),r={};r.uuid=function(e,t){var n,r="0123456789abcdefghijklmnopqrstuvwxyz".split(""),o=[],i=16;if(t=t||32)for(n=0;t>n;n++)o[n]=r[0|Math.random()*i];else{var s;for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",n=0;36>n;n++)o[n]||(s=0|16*Math.random(),o[n]=r[19==n?3&s|8:s])}return(e?e:"")+o.join("")},r.uuidGen=function(e){var t=1;return e=void 0!==e?e:"uuid_",function(n){return n=n||e,n+t++}};var o=function(e,t){var n,r=-1,o=e.length,i=t[0],s=t[1],a=t[2];switch(t.length){case 0:for(;++r<o;)(n=e[r]).callback.call(n.ctx);return;case 1:for(;++r<o;)(n=e[r]).callback.call(n.ctx,i);return;case 2:for(;++r<o;)(n=e[r]).callback.call(n.ctx,i,s);return;case 3:for(;++r<o;)(n=e[r]).callback.call(n.ctx,i,s,a);return;default:for(;++r<o;)(n=e[r]).callback.apply(n.ctx,t)}},i=/\s+/,s=function(e,t,n,r){if(!n)return!0;if("object"==typeof n){for(var o in n)e[t].apply(e,[o,n[o]].concat(r));return!1}if(i.test(n)){for(var s=n.split(i),a=0,c=s.length;c>a;a++)e[t].apply(e,[s[a]].concat(r));return!1}return!0};r.Events={on:function(e,t,n){if(!s(this,"on",e,[t,n])||!t)return this;this._events=this._events||{};var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,r){if(!s(this,"once",e,[t,r])||!t)return this;var o=this,i=n.once(function(){o.off(e,i),t.apply(this,arguments)
});return i._callback=t,this.on(e,i,r)},off:function(e,t,r){var o,i,a,c,u,l,p,h;if(!this._events||!s(this,"off",e,[t,r]))return this;if(!e&&!t&&!r)return this._events={},this;for(c=e?[e]:n.keys(this._events),u=0,l=c.length;l>u;u++)if(e=c[u],a=this._events[e]){if(this._events[e]=o=[],t||r)for(p=0,h=a.length;h>p;p++)i=a[p],(t&&t!==i.callback&&t!==i.callback._callback||r&&r!==i.context)&&o.push(i);o.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=Array.prototype.slice.call(arguments,1);if(!s(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&o(n,t),r&&o(r,arguments),this},triggerLater:function(){var e=this,t=arguments;window.setTimeout(function(){e.trigger.apply(e,t)},0)},stopListening:function(e,t,n){var r=this._listeners;if(!r)return this;var o=!t&&!n;"object"==typeof t&&(n=this),e&&((r={})[e._listenerId]=e);for(var i in r)r[i].off(t,n,this),o&&delete this._listeners[i];return this}};var a={listenTo:"on",listenToOnce:"once"};n.each(a,function(e,t){r.Events[t]=function(t,r,o){var i=this._listeners||(this._listeners={}),s=t._listenerId||(t._listenerId=n.uniqueId("l"));return i[s]=t,"object"==typeof r&&(o=this),t[e](r,o,this),this}}),r.Events.bind=r.Events.on,r.Events.unbind=r.Events.off,r.Events.Listener={listenTo:function(e,t,r){if(!n.isFunction(r))throw new Error("Illegal argument: expecting function as callback, was: "+r);return this._handlers=this._handlers||[],e.on(t,r,this),this._handlers.push({unbind:function(){e.off(t,r)}}),this},stopListening:function(){if(this._handlers)for(var e=0;e<this._handlers.length;e++)this._handlers[e].unbind()}},r.propagate=function(e,t){if(!n.isFunction(t))throw"Illegal argument: provided callback is not a function";return function(n){return n?t(n):void t(null,e)}};var c=function(){};r.inherits=function(e,t,r){var o;return o=t&&t.hasOwnProperty("constructor")?t.constructor:function(){e.apply(this,arguments)},n.extend(o,e),c.prototype=e.prototype,o.prototype=new c,t&&n.extend(o.prototype,t),r&&n.extend(o,r),o.prototype.constructor=o,o.__super__=e.prototype,o},r.getJSON=function(t,n){if("undefined"==typeof window||"undefined"!=typeof nwglobal){var r=e("fs"),o=JSON.parse(r.readFileSync(t,"utf8"));n(null,o)}else{var i=window.$;i.getJSON(t).done(function(e){n(null,e)}).error(function(e){n(e,null)})}},r.prototype=function(e){return Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__},r.inherit=function(e,t){var r,o=n.isFunction(e)?new e:e;if(n.isFunction(t))t.prototype=o,r=new t;else{var i=function(){};i.prototype=o,r=n.extend(new i,t)}return r},r.pimpl=function(e){var t=function(e){this.self=e};return t.prototype=e,function(e){return e=e||this,new t(e)}},r.parseStackTrace=function(e){var t,n=/([^@]*)@(.*):(\d+)/,r=/\s*at ([^(]*)[(](.*):(\d+):(\d+)[)]/,o=e.stack.split("\n"),i=[];for(t=0;t<o.length;t++){var s=n.exec(o[t]);s||(s=r.exec(o[t]));var a;s?(a={func:s[1],file:s[2],line:s[3],col:s[4]||0},""===a.func&&(a.func="<anonymous>")):a={func:"",file:o[t],line:"",col:""},i.push(a)}return i},r.callstack=function(e){var t;try{throw new Error}catch(n){t=n}var o=r.parseStackTrace(t);return e=e||0,o.splice(e+1)},r.stacktrace=function(e){var t=0===arguments.length?r.callstack().splice(1):r.parseStackTrace(e),o=[];return n.each(t,function(e){o.push(e.file+":"+e.line+":"+e.col+" ("+e.func+")")}),o.join("\n")},r.printStackTrace=function(e,t){if(e.stack){var o;if(void 0!==e.__stack)o=e.__stack;else{if(!n.isString(e.stack))return;o=r.parseStackTrace(e)}t=t||o.length,t=Math.min(t,o.length);for(var i=0;t>i;i++){var s=o[i];console.log(s.file+":"+s.line+":"+s.col,"("+s.func+")")}}},r.diff=function(e,t){var o;return n.isArray(e)&&n.isArray(t)?(o=n.difference(t,e),0===o.length?null:o):n.isObject(e)&&n.isObject(t)?(o={},n.each(Object.keys(t),function(n){var i=r.diff(e[n],t[n]);i&&(o[n]=i)}),n.isEmpty(o)?null:o):e!==t?t:void 0},r.deepclone=function(e){return void 0===e?void 0:null===e?null:JSON.parse(JSON.stringify(e))},r.clone=function(e){return null===e||void 0===e?e:n.isFunction(e.clone)?e.clone():r.deepclone(e)},r.freeze=function(e){var t;if(n.isObject(e)){if(Object.isFrozen(e))return e;var o=Object.keys(e);for(t=0;t<o.length;t++){var i=o[t];e[i]=r.freeze(e[i])}return Object.freeze(e)}if(n.isArray(e)){var s=e;for(t=0;t<s.length;t++)s[t]=r.freeze(s[t]);return Object.freeze(s)}return e},r.later=function(e,t){return function(){var n=arguments;window.setTimeout(function(){e.apply(t,n)},0)}},r.isEmpty=function(e){return!e.match(/\w/)},r.slug=function(e){e=e.replace(/^\s+|\s+$/g,""),e=e.toLowerCase();for(var t="/_,:;",n="aaaaeeeeiiiioooouuuunc------",r=0,o=t.length;o>r;r++)e=e.replace(new RegExp(t.charAt(r),"g"),n.charAt(r));return e=e.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")},r.getReadableFileSizeString=function(e){var t=-1,n=[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"];do e/=1024,t++;while(e>1024);return Math.max(e,.1).toFixed(1)+n[t]},t.exports=r},{fs:186,underscore:177}],177:[function(e,t,n){(function(){var e=this,r=e._,o={},i=Array.prototype,s=Object.prototype,a=Function.prototype,c=i.push,u=i.slice,l=i.concat,p=s.toString,h=s.hasOwnProperty,d=i.forEach,f=i.map,g=i.reduce,y=i.reduceRight,m=i.filter,v=i.every,b=i.some,w=i.indexOf,x=i.lastIndexOf,_=Array.isArray,C=Object.keys,P=a.bind,T=function(e){return e instanceof T?e:this instanceof T?void(this._wrapped=e):new T(e)};"undefined"!=typeof n?("undefined"!=typeof t&&t.exports&&(n=t.exports=T),n._=T):e._=T,T.VERSION="1.5.2";var k=T.each=T.forEach=function(e,t,n){if(null!=e)if(d&&e.forEach===d)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,i=e.length;i>r;r++)if(t.call(n,e[r],r,e)===o)return}else for(var s=T.keys(e),r=0,i=s.length;i>r;r++)if(t.call(n,e[s[r]],s[r],e)===o)return};T.map=T.collect=function(e,t,n){var r=[];return null==e?r:f&&e.map===f?e.map(t,n):(k(e,function(e,o,i){r.push(t.call(n,e,o,i))}),r)};var N="Reduce of empty array with no initial value";T.reduce=T.foldl=T.inject=function(e,t,n,r){var o=arguments.length>2;if(null==e&&(e=[]),g&&e.reduce===g)return r&&(t=T.bind(t,r)),o?e.reduce(t,n):e.reduce(t);if(k(e,function(e,i,s){o?n=t.call(r,n,e,i,s):(n=e,o=!0)}),!o)throw new TypeError(N);return n},T.reduceRight=T.foldr=function(e,t,n,r){var o=arguments.length>2;if(null==e&&(e=[]),y&&e.reduceRight===y)return r&&(t=T.bind(t,r)),o?e.reduceRight(t,n):e.reduceRight(t);var i=e.length;if(i!==+i){var s=T.keys(e);i=s.length}if(k(e,function(a,c,u){c=s?s[--i]:--i,o?n=t.call(r,n,e[c],c,u):(n=e[c],o=!0)}),!o)throw new TypeError(N);return n},T.find=T.detect=function(e,t,n){var r;return S(e,function(e,o,i){return t.call(n,e,o,i)?(r=e,!0):void 0}),r},T.filter=T.select=function(e,t,n){var r=[];return null==e?r:m&&e.filter===m?e.filter(t,n):(k(e,function(e,o,i){t.call(n,e,o,i)&&r.push(e)}),r)},T.reject=function(e,t,n){return T.filter(e,function(e,r,o){return!t.call(n,e,r,o)},n)},T.every=T.all=function(e,t,n){t||(t=T.identity);var r=!0;return null==e?r:v&&e.every===v?e.every(t,n):(k(e,function(e,i,s){return(r=r&&t.call(n,e,i,s))?void 0:o}),!!r)};var S=T.some=T.any=function(e,t,n){t||(t=T.identity);var r=!1;return null==e?r:b&&e.some===b?e.some(t,n):(k(e,function(e,i,s){return r||(r=t.call(n,e,i,s))?o:void 0}),!!r)};T.contains=T.include=function(e,t){return null==e?!1:w&&e.indexOf===w?-1!=e.indexOf(t):S(e,function(e){return e===t})},T.invoke=function(e,t){var n=u.call(arguments,2),r=T.isFunction(t);return T.map(e,function(e){return(r?t:e[t]).apply(e,n)})},T.pluck=function(e,t){return T.map(e,function(e){return e[t]})},T.where=function(e,t,n){return T.isEmpty(t)?n?void 0:[]:T[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},T.findWhere=function(e,t){return T.where(e,t,!0)},T.max=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&T.isEmpty(e))return-1/0;var r={computed:-1/0,value:-1/0};return k(e,function(e,o,i){var s=t?t.call(n,e,o,i):e;s>r.computed&&(r={value:e,computed:s})}),r.value},T.min=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&T.isEmpty(e))return 1/0;var r={computed:1/0,value:1/0};return k(e,function(e,o,i){var s=t?t.call(n,e,o,i):e;s<r.computed&&(r={value:e,computed:s})}),r.value},T.shuffle=function(e){var t,n=0,r=[];return k(e,function(e){t=T.random(n++),r[n-1]=r[t],r[t]=e}),r},T.sample=function(e,t,n){return arguments.length<2||n?e[T.random(e.length-1)]:T.shuffle(e).slice(0,Math.max(0,t))};var A=function(e){return T.isFunction(e)?e:function(t){return t[e]}};T.sortBy=function(e,t,n){var r=A(t);return T.pluck(T.map(e,function(e,t,o){return{value:e,index:t,criteria:r.call(n,e,t,o)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return e.index-t.index}),"value")};var E=function(e){return function(t,n,r){var o={},i=null==n?T.identity:A(n);return k(t,function(n,s){var a=i.call(r,n,s,t);e(o,a,n)}),o}};T.groupBy=E(function(e,t,n){(T.has(e,t)?e[t]:e[t]=[]).push(n)}),T.indexBy=E(function(e,t,n){e[t]=n}),T.countBy=E(function(e,t){T.has(e,t)?e[t]++:e[t]=1}),T.sortedIndex=function(e,t,n,r){n=null==n?T.identity:A(n);for(var o=n.call(r,t),i=0,s=e.length;s>i;){var a=i+s>>>1;n.call(r,e[a])<o?i=a+1:s=a}return i},T.toArray=function(e){return e?T.isArray(e)?u.call(e):e.length===+e.length?T.map(e,T.identity):T.values(e):[]},T.size=function(e){return null==e?0:e.length===+e.length?e.length:T.keys(e).length},T.first=T.head=T.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:u.call(e,0,t)},T.initial=function(e,t,n){return u.call(e,0,e.length-(null==t||n?1:t))},T.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},T.rest=T.tail=T.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},T.compact=function(e){return T.filter(e,T.identity)};var j=function(e,t,n){return t&&T.every(e,T.isArray)?l.apply(n,e):(k(e,function(e){T.isArray(e)||T.isArguments(e)?t?c.apply(n,e):j(e,t,n):n.push(e)}),n)};T.flatten=function(e,t){return j(e,t,[])},T.without=function(e){return T.difference(e,u.call(arguments,1))},T.uniq=T.unique=function(e,t,n,r){T.isFunction(t)&&(r=n,n=t,t=!1);var o=n?T.map(e,n,r):e,i=[],s=[];return k(o,function(n,r){(t?r&&s[s.length-1]===n:T.contains(s,n))||(s.push(n),i.push(e[r]))}),i},T.union=function(){return T.uniq(T.flatten(arguments,!0))},T.intersection=function(e){var t=u.call(arguments,1);return T.filter(T.uniq(e),function(e){return T.every(t,function(t){return T.indexOf(t,e)>=0})})},T.difference=function(e){var t=l.apply(i,u.call(arguments,1));return T.filter(e,function(e){return!T.contains(t,e)})},T.zip=function(){for(var e=T.max(T.pluck(arguments,"length").concat(0)),t=new Array(e),n=0;e>n;n++)t[n]=T.pluck(arguments,""+n);return t},T.object=function(e,t){if(null==e)return{};for(var n={},r=0,o=e.length;o>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},T.indexOf=function(e,t,n){if(null==e)return-1;var r=0,o=e.length;if(n){if("number"!=typeof n)return r=T.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,o+n):n}if(w&&e.indexOf===w)return e.indexOf(t,n);for(;o>r;r++)if(e[r]===t)return r;return-1},T.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(x&&e.lastIndexOf===x)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var o=r?n:e.length;o--;)if(e[o]===t)return o;return-1},T.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),o=0,i=new Array(r);r>o;)i[o++]=e,e+=n;return i};var D=function(){};T.bind=function(e,t){var n,r;if(P&&e.bind===P)return P.apply(e,u.call(arguments,1));if(!T.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(!(this instanceof r))return e.apply(t,n.concat(u.call(arguments)));D.prototype=e.prototype;var o=new D;D.prototype=null;var i=e.apply(o,n.concat(u.call(arguments)));return Object(i)===i?i:o}},T.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},T.bindAll=function(e){var t=u.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return k(t,function(t){e[t]=T.bind(e[t],e)}),e},T.memoize=function(e,t){var n={};return t||(t=T.identity),function(){var r=t.apply(this,arguments);return T.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},T.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},T.defer=function(e){return T.delay.apply(T,[e,1].concat(u.call(arguments,1)))},T.throttle=function(e,t,n){var r,o,i,s=null,a=0;n||(n={});var c=function(){a=n.leading===!1?0:new Date,s=null,i=e.apply(r,o)};return function(){var u=new Date;a||n.leading!==!1||(a=u);var l=t-(u-a);return r=this,o=arguments,0>=l?(clearTimeout(s),s=null,a=u,i=e.apply(r,o)):s||n.trailing===!1||(s=setTimeout(c,l)),i}},T.debounce=function(e,t,n){var r,o,i,s,a;return function(){i=this,o=arguments,s=new Date;var c=function(){var u=new Date-s;t>u?r=setTimeout(c,t-u):(r=null,n||(a=e.apply(i,o)))},u=n&&!r;return r||(r=setTimeout(c,t)),u&&(a=e.apply(i,o)),a}},T.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},T.wrap=function(e,t){return function(){var n=[e];return c.apply(n,arguments),t.apply(this,n)}},T.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},T.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},T.keys=C||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)T.has(e,n)&&t.push(n);return t},T.values=function(e){for(var t=T.keys(e),n=t.length,r=new Array(n),o=0;n>o;o++)r[o]=e[t[o]];return r},T.pairs=function(e){for(var t=T.keys(e),n=t.length,r=new Array(n),o=0;n>o;o++)r[o]=[t[o],e[t[o]]];return r},T.invert=function(e){for(var t={},n=T.keys(e),r=0,o=n.length;o>r;r++)t[e[n[r]]]=n[r];return t},T.functions=T.methods=function(e){var t=[];for(var n in e)T.isFunction(e[n])&&t.push(n);return t.sort()},T.extend=function(e){return k(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},T.pick=function(e){var t={},n=l.apply(i,u.call(arguments,1));return k(n,function(n){n in e&&(t[n]=e[n])}),t},T.omit=function(e){var t={},n=l.apply(i,u.call(arguments,1));for(var r in e)T.contains(n,r)||(t[r]=e[r]);return t},T.defaults=function(e){return k(u.call(arguments,1),function(t){if(t)for(var n in t)void 0===e[n]&&(e[n]=t[n])}),e},T.clone=function(e){return T.isObject(e)?T.isArray(e)?e.slice():T.extend({},e):e},T.tap=function(e,t){return t(e),e};var V=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof T&&(e=e._wrapped),t instanceof T&&(t=t._wrapped);var o=p.call(e);if(o!=p.call(t))return!1;switch(o){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var i=n.length;i--;)if(n[i]==e)return r[i]==t;var s=e.constructor,a=t.constructor;if(s!==a&&!(T.isFunction(s)&&s instanceof s&&T.isFunction(a)&&a instanceof a))return!1;n.push(e),r.push(t);var c=0,u=!0;if("[object Array]"==o){if(c=e.length,u=c==t.length)for(;c--&&(u=V(e[c],t[c],n,r)););}else{for(var l in e)if(T.has(e,l)&&(c++,!(u=T.has(t,l)&&V(e[l],t[l],n,r))))break;if(u){for(l in t)if(T.has(t,l)&&!c--)break;u=!c}}return n.pop(),r.pop(),u};T.isEqual=function(e,t){return V(e,t,[],[])},T.isEmpty=function(e){if(null==e)return!0;if(T.isArray(e)||T.isString(e))return 0===e.length;for(var t in e)if(T.has(e,t))return!1;return!0},T.isElement=function(e){return!(!e||1!==e.nodeType)},T.isArray=_||function(e){return"[object Array]"==p.call(e)},T.isObject=function(e){return e===Object(e)},k(["Arguments","Function","String","Number","Date","RegExp"],function(e){T["is"+e]=function(t){return p.call(t)=="[object "+e+"]"}}),T.isArguments(arguments)||(T.isArguments=function(e){return!(!e||!T.has(e,"callee"))}),"function"!=typeof/./&&(T.isFunction=function(e){return"function"==typeof e}),T.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},T.isNaN=function(e){return T.isNumber(e)&&e!=+e},T.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==p.call(e)},T.isNull=function(e){return null===e},T.isUndefined=function(e){return void 0===e},T.has=function(e,t){return h.call(e,t)},T.noConflict=function(){return e._=r,this},T.identity=function(e){return e},T.times=function(e,t,n){for(var r=Array(Math.max(0,e)),o=0;e>o;o++)r[o]=t.call(n,o);return r},T.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var $={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};$.unescape=T.invert($.escape);var q={escape:new RegExp("["+T.keys($.escape).join("")+"]","g"),unescape:new RegExp("("+T.keys($.unescape).join("|")+")","g")};T.each(["escape","unescape"],function(e){T[e]=function(t){return null==t?"":(""+t).replace(q[e],function(t){return $[e][t]})}}),T.result=function(e,t){if(null==e)return void 0;var n=e[t];return T.isFunction(n)?n.call(e):n},T.mixin=function(e){k(T.functions(e),function(t){var n=T[t]=e[t];T.prototype[t]=function(){var e=[this._wrapped];return c.apply(e,arguments),M.call(this,n.apply(T,e))}})};var L=0;T.uniqueId=function(e){var t=++L+"";return e?e+t:t},T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var I=/(.)^/,O={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},R=/\\|'|\r|\n|\t|\u2028|\u2029/g;T.template=function(e,t,n){var r;n=T.defaults({},n,T.templateSettings);var o=new RegExp([(n.escape||I).source,(n.interpolate||I).source,(n.evaluate||I).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(o,function(t,n,r,o,a){return s+=e.slice(i,a).replace(R,function(e){return"\\"+O[e]}),n&&(s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(s+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),o&&(s+="';\n"+o+"\n__p+='"),i=a+t.length,t}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{r=new Function(n.variable||"obj","_",s)}catch(a){throw a.source=s,a}if(t)return r(t,T);var c=function(e){return r.call(this,e,T)};return c.source="function("+(n.variable||"obj")+"){\n"+s+"}",c},T.chain=function(e){return T(e).chain()};var M=function(e){return this._chain?T(e).chain():e};T.mixin(T),k(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=i[e];T.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],M.call(this,n)}}),k(["concat","join","slice"],function(e){var t=i[e];T.prototype[e]=function(){return M.call(this,t.apply(this._wrapped,arguments))}}),T.extend(T.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},{}],178:[function(e,t){"use strict";var n=e("lens"),r=n.getDefaultPanels(),o=e("lens-converter"),i=e("./custom_converter"),s=e("lens-converter/elife_converter"),a=e("lens-converter/plos_converter"),c=e("./panels/altmetrics");r.splice(-1,0,c);var u=function(e){n.call(this,e)};u.Prototype=function(){this.getConverters=function(e){return[new i(e),new s(e),new a(e),new o(e)]},this.getPanels=function(){return r.slice(0)}},u.Prototype.prototype=n.prototype,u.prototype=new u.Prototype,u.prototype.constructor=u,t.exports=u},{"./custom_converter":179,"./panels/altmetrics":185,lens:124,"lens-converter":121,"lens-converter/elife_converter":120,"lens-converter/plos_converter":123}],179:[function(e,t){"use strict";var n=(e("substance-util"),e("underscore"),e("lens-converter")),r=e("lens-article"),o=e("./nodes"),i=e("jquery"),s=function(e){n.call(this,e)};s.Prototype=function(){n.prototype;this.test=function(){return!0},this.createDocument=function(){var e=new r({nodeTypes:o});return console.log(e),i.ajax({method:"POST",url:"/lensdocs/",data:JSON.stringify(e),success:function(e){console.log(e)}}),e},this.video=function(){},this.enhanceFigure=function(e,t,n){var r=n.querySelector("graphic"),o=r.getAttribute("xlink:href"),i=["http://www.ncbi.nlm.nih.gov/pmc/articles/",window.pmcId,"/bin/",o,".jpg"].join("");t.url=i}},s.Prototype.prototype=n.prototype,s.prototype=new s.Prototype,s.prototype.constructor=s,t.exports=s},{"./nodes":182,jquery:2,"lens-article":5,"lens-converter":121,"substance-util":169,underscore:177}],180:[function(e,t){var n=e("lens-article/nodes"),r=n.cover.View,o=e("substance-application").$$,i=function(e,t){r.call(this,e,t)};i.Prototype=function(){this.render=function(){r.prototype.render.call(this);var e=(encodeURIComponent(window.location.href),o(".intro.container",{children:[o(".intro-text",{html:'<i class="icon-info"></i>&nbsp;&nbsp;<b>Lens</b> provides a novel way of viewing research'}),o("a.send-feedback",{href:"mailto:ivan.grub@gmail.com",text:"Send feedback",target:"_blank"})]}));return this.content.insertBefore(e,this.content.firstChild),this}},i.Prototype.prototype=r.prototype,i.prototype=new i.Prototype,i.prototype.constructor=i,t.exports=i},{"lens-article/nodes":74,"substance-application":151}],181:[function(e,t){"use strict";var n=e("lens-article/nodes"),r=n.cover.Model;t.exports={Model:r,View:e("./cover_view")}},{"./cover_view":180,"lens-article/nodes":74}],182:[function(e,t){t.exports={cover:e("./cover")}},{"./cover":181}],183:[function(e,t){var n=e("lens").PanelController,r=e("./altmetrics_view"),o=function(e,t){n.call(this,e,t)};o.Prototype=function(){this.createView=function(){return new r(this,this.config)},this.getAltmetrics=function(e){var t=this.document.get("publication_info").doi;$.ajax({url:"http://api.altmetric.com/v1/doi/"+t,dataType:"json"}).done(function(t){e(null,t)})}},o.Prototype.prototype=n.prototype,o.prototype=new o.Prototype,t.exports=o},{"./altmetrics_view":184,lens:124}],184:[function(e,t){var n=e("lens").PanelView,r=function(e,t){n.call(this,e,t),this.$el.addClass("altmetrics-panel"),this.hideToggle()};r.Prototype=function(){this.render=function(){var e=this;return this.el.innerHTML="",this.controller.getAltmetrics(function(t,n){t?console.error("Could not retrieve altmetrics data:",t):e.renderAltmetrics(n)}),this},this.renderAltmetrics=function(e){this.showToggle();var t=$('<div class="altmetrics"></div>');t.append($('<div class="label">Altmetric.com Score</div>')),t.append($('<div class="value"></div>').text(e.score)),t.append($('<div class="label">Cited on Twitter</div>')),t.append($('<div class="value"></div>').text(e.cited_by_tweeters_count)),t.append($('<div class="label">Readers on Mendeley</div>')),t.append($('<div class="value"></div>').text(e.readers.mendeley)),t.append($('<div class="copyright">Data provided by <a href="http://altmetric.com">altmetrics.com</div>')),this.$el.append(t)}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,t.exports=r},{lens:124}],185:[function(e,t){"use strict";var n=e("lens").Panel,r=e("./altmetrics_controller"),o=new n({name:"altmetrics",type:"resource",title:"Altmetrics",icon:"fa-bar-chart-o"});o.createController=function(e){return new r(e,this.config)},t.exports=o},{"./altmetrics_controller":183,lens:124}],186:[function(){},{}]},{},[1]);
